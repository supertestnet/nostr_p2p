/*! For license information please see main.js.LICENSE.txt */
(()=>{var __webpack_modules__={7833:(t,e,n)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=n(736)(e);const{formatters:r}=t.exports;r.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},736:(t,e,n)=>{t.exports=function(t){function e(t){let n,i,s,o=null;function a(...t){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=e.formatters[i];if("function"==typeof s){const e=t[o];n=s.call(r,e),t.splice(o,1),o--}return n})),e.formatArgs.call(r,t),(r.log||e.log).apply(r,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=r,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function r(t,n){const r=e(this.namespace+(void 0===n?":":n)+t);return r.log=this.log,r}function i(t,e){let n=0,r=0,i=-1,s=0;for(;n<t.length;)if(r<e.length&&(e[r]===t[n]||"*"===e[r]))"*"===e[r]?(i=r,s=n,r++):(n++,r++);else{if(-1===i)return!1;r=i+1,s++,n=s}for(;r<e.length&&"*"===e[r];)r++;return r===e.length}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){const t=[...e.names,...e.skips.map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];const n=("string"==typeof t?t:"").trim().replace(" ",",").split(",").filter(Boolean);for(const t of n)"-"===t[0]?e.skips.push(t.slice(1)):e.names.push(t)},e.enabled=function(t){for(const n of e.skips)if(i(t,n))return!1;for(const n of e.names)if(i(t,n))return!0;return!1},e.humanize=n(6585),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}},4903:t=>{var e=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(t){return e()}try{return __global__||e()}finally{delete Object.prototype.__global__}}()},6705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(1746),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},h={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},l=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],d={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},f=BigInt("2100000000000000000"),p=BigInt(1e11),y={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},g={};for(let t=0,e=Object.keys(y);t<e.length;t++){const n=e[t],r=y[e[t]].toString();g[r]=n}const m={1:t=>i.encode(r.fromWordsUnsafe(t)),16:t=>i.encode(r.fromWordsUnsafe(t)),13:t=>s.encode(r.fromWordsUnsafe(t)),19:t=>i.encode(r.fromWordsUnsafe(t)),23:t=>i.encode(r.fromWordsUnsafe(t)),27:t=>i.encode(r.fromWordsUnsafe(t)),6:b,24:b,3:function(t){const e=[];let n,s,o,a,c,u=r.fromWordsUnsafe(t);for(;u.length>0;)n=i.encode(u.slice(0,33)),s=i.encode(u.slice(33,41)),o=parseInt(i.encode(u.slice(41,45)),16),a=parseInt(i.encode(u.slice(45,49)),16),c=parseInt(i.encode(u.slice(49,51)),16),u=u.slice(51),e.push({pubkey:n,short_channel_id:s,fee_base_msat:o,fee_proportional_millionths:a,cltv_expiry_delta:c});return e},5:function(t){const e=t.slice().reverse().map((t=>[!!(1&t),!!(2&t),!!(4&t),!!(8&t),!!(16&t)])).reduce(((t,e)=>t.concat(e)),[]);for(;e.length<2*l.length;)e.push(!1);const n={};l.forEach(((t,r)=>{let i;i=e[2*r]?"required":e[2*r+1]?"supported":"unsupported",n[t]=i}));const r=e.slice(2*l.length);return n.extra_bits={start_bit:2*l.length,bits:r,has_required:r.reduce(((t,e,n)=>n%2!=0?t||!1:t||e),!1)},n}};function w(t){return e=>({tagCode:parseInt(t),words:r.encode("unknown",e,Number.MAX_SAFE_INTEGER)})}function b(t){return t.reverse().reduce(((t,e,n)=>t+e*Math.pow(32,n)),0)}function v(t,e){let n,r;if(t.slice(-1).match(/^[munp]$/))n=t.slice(-1),r=t.slice(0,-1);else{if(t.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=t}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const i=BigInt(r),s=n?i*p/d[n]:i*p;if("p"===n&&i%BigInt(10)!==BigInt(0)||s>f)throw new Error("Amount is outside of valid range");return e?s.toString():s}t.exports={decode:function(t,e){if("string"!=typeof t)throw new Error("Lightning Payment Request must be string");if("ln"!==t.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],s=r.decode(t,Number.MAX_SAFE_INTEGER);t=t.toLowerCase();const l=s.prefix;let d=s.words,f=t.slice(l.length+1),p=d.slice(-104);d=d.slice(0,-104);let _=l.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(_&&!_[2]&&(_=l.match(/^ln(\S+)$/)),!_)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const E=_[1];let k;if(e){if(void 0===e.bech32||void 0===e.pubKeyHash||void 0===e.scriptHash||!Array.isArray(e.validWitnessVersions))throw new Error("Invalid network");k=e}else switch(E){case o.bech32:k=o;break;case a.bech32:k=a;break;case c.bech32:k=c;break;case u.bech32:k=u;break;case h.bech32:k=h}if(!k||k.bech32!==E)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:E,value:k});const x=_[2];let A;x?(A=v(x+_[3],!0),n.push({name:"amount",letters:_[2]+_[3],value:A})):A=null,n.push({name:"separator",letters:"1"});const S=b(d.slice(0,7));let C,O,T,R;for(d=d.slice(7),n.push({name:"timestamp",letters:f.slice(0,7),value:S}),f=f.slice(7);d.length>0;){const t=d[0].toString();C=g[t]||"unknown_tag",O=m[t]||w(t),d=d.slice(1),T=b(d.slice(0,2)),d=d.slice(2),R=d.slice(0,T),d=d.slice(T),n.push({name:C,tag:f[0],letters:f.slice(0,3+T),value:O(R)}),f=f.slice(3+T)}n.push({name:"signature",letters:f.slice(0,104),value:i.encode(r.fromWordsUnsafe(p))}),f=f.slice(104),n.push({name:"checksum",letters:f});let I={paymentRequest:t,sections:n,get expiry(){let t=n.find((t=>"expiry"===t.name));if(t)return N("timestamp")+t.value},get route_hints(){return n.filter((t=>"route_hint"===t.name)).map((t=>t.value))}};for(let t in y)"route_hint"!==t&&Object.defineProperty(I,t,{get:()=>N(t)});return I;function N(t){let e=n.find((e=>e.name===t));return e?e.value:void 0}},hrpToMillisat:v}},1746:(t,e)=>{"use strict";function n(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function r(...t){const e=(t,e)=>n=>t(e(n));return{encode:Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),decode:t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0)}}function i(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(n(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function s(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function o(t,e="="){if(n(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function a(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function c(t,e,r){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let i=0;const s=[],o=Array.from(t);for(o.forEach((t=>{if(n(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,n=!0;for(let s=i;s<o.length;s++){const a=o[s],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%r,o[s]=Math.floor(c/r),!Number.isSafeInteger(o[s])||o[s]*r+t!==c)throw new Error("convertRadix: carry overflow");n&&(o[s]?n=!1:i=s)}if(s.push(t),n)break}for(let e=0;e<t.length-1&&0===t[e];e++)s.push(0);return s.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const u=(t,e)=>e?u(e,t%e):t,h=(t,e)=>t+(e-u(t,e));function l(t,e,r,i){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(h(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${h(e,r)}`);let s=0,o=0;const a=2**r-1,c=[];for(const i of t){if(n(i),i>=2**e)throw new Error(`convertRadix2: invalid data word=${i} from=${e}`);if(s=s<<e|i,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=r;o-=r)c.push((s>>o-r&a)>>>0);s&=2**o-1}if(s=s<<r-o&a,!i&&o>=e)throw new Error("Excess padding");if(!i&&s)throw new Error(`Non-zero padding: ${s}`);return i&&o>0&&c.push(s>>>0),c}function d(t){return n(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(e,t,256))}}}function f(t,e=!1){if(n(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(h(8,t)>32||h(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return l(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(l(n,t,8,e))}}}function p(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}function y(t,e){if(n(t),"function"!=typeof e)throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=e(n).slice(0,t),i=new Uint8Array(n.length+t);return i.set(n),i.set(r,n.length),i},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-t),i=e(r).slice(0,t),s=n.slice(-t);for(let e=0;e<t;e++)if(i[e]!==s[e])throw new Error("Invalid checksum");return r}}}e.utils={alphabet:i,chain:r,checksum:y,radix:d,radix2:f,join:s,padding:o},e.base16=r(f(4),i("0123456789ABCDEF"),s("")),e.base32=r(f(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(f(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(f(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const g=t=>r(d(58),i(t),s(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const m=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let n="";for(let r=0;r<t.length;r+=8){const i=t.subarray(r,r+8);n+=e.base58.encode(i).padStart(m[i.length],"1")}return n},decode(t){let n=[];for(let r=0;r<t.length;r+=11){const i=t.slice(r,r+11),s=m.indexOf(i.length),o=e.base58.decode(i);for(let t=0;t<o.length-s;t++)if(0!==o[t])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(n)}},e.base58check=t=>r(y(4,(e=>t(t(e)))),e.base58);const w=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),b=[996825010,642813549,513874426,1027748829,705979059];function v(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<b.length;t++)1==(e>>t&1)&&(n^=b[t]);return n}function _(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=v(i)^n>>5}i=v(i);for(let e=0;e<r;e++)i=v(i)^31&t.charCodeAt(e);for(let t of e)i=v(i)^t;for(let t=0;t<6;t++)i=v(i);return i^=n,w.encode(l([i%2**30],30,5,!1))}function E(t){const e="bech32"===t?1:734539939,n=f(5),r=n.decode,i=n.encode,s=p(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(t=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=t.slice(0,i),o=t.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=w.decode(o).slice(0,-6),c=_(s,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=t.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${w.encode(n)}${_(t,n,e)}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:p(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}e.bech32=E("bech32"),e.bech32m=E("bech32m"),e.utf8={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)},e.hex=r(f(4),i("0123456789abcdef"),s(""),a((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const k={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},x=`Invalid encoding type. Available types: ${Object.keys(k).join(", ")}`;e.bytesToString=(t,e)=>{if("string"!=typeof t||!k.hasOwnProperty(t))throw new TypeError(x);if(!(e instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return k[t].encode(e)},e.str=e.bytesToString,e.stringToBytes=(t,e)=>{if(!k.hasOwnProperty(t))throw new TypeError(x);if("string"!=typeof e)throw new TypeError("stringToBytes() expects string");return k[t].decode(e)},e.bytes=e.stringToBytes},6585:t=>{var e=1e3,n=60*e,r=60*n,i=24*r,s=7*i;function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,a){a=a||{};var c,u,h=typeof t;if("string"===h&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(o){var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*s;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===h&&isFinite(t))return a.long?(c=t,(u=Math.abs(c))>=i?o(c,u,i,"day"):u>=r?o(c,u,r,"hour"):u>=n?o(c,u,n,"minute"):u>=e?o(c,u,e,"second"):c+" ms"):function(t){var s=Math.abs(t);return s>=i?Math.round(t/i)+"d":s>=r?Math.round(t/r)+"h":s>=n?Math.round(t/n)+"m":s>=e?Math.round(t/e)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},5030:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var i=n(9857),s=n(5372),o=n(4547);function a(t,e,n,r,i,s){var o=this.events[t];if(o){if(0===o.length)return!1;if(o.argsNum<6)o.call(e,n,r,i,s);else{for(var a=new Array(o.argsNum),c=0,u=a.length;c<u;++c)a[c]=arguments[c+1];o.call.apply(void 0,a)}return!0}return!1}function c(t,e,n,r,i,s){var o,a=this.events[t];if(void 0!==a){if(0===a.length)return!1;if(a.argsNum<6)a.call(e,n,r,i,s);else{for(var c=0,u=(o=new Array(a.argsNum)).length;c<u;++c)o[c]=arguments[c+1];a.call.apply(void 0,o)}}var h=this.onceEvents[t];if(h){if("function"==typeof h)if(this.onceEvents[t]=void 0,arguments.length<6)h(e,n,r,i,s);else{if(void 0===o)for(c=0,u=(o=new Array(arguments.length-1)).length;c<u;++c)o[c]=arguments[c+1];h.apply(void 0,o)}else{var l=h;if(this.onceEvents[t]=void 0,arguments.length<6)for(c=0;c<l.length;++c)l[c](e,n,r,i,s);else{if(void 0===o)for(c=0,u=(o=new Array(arguments.length-1)).length;c<u;++c)o[c]=arguments[c+1];for(c=0;c<l.length;++c)l[c].apply(void 0,o)}}return!0}return void 0!==a}var u=function(){function t(){this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(t.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),t}();function h(t,e,n){if(void 0===n&&(n=e.length),"function"!=typeof e)throw new TypeError("The listener must be a function");var r=this.events[t];return r?(r.push(e),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" event!'))):(this.events[t]=new i.TaskCollection(n,!0,e,!1),"symbol"==typeof t&&this._symbolKeys.add(t)),this}function l(t,e){var n=this.events[t];n&&n.removeLast(e);var r=this.onceEvents[t];return r&&("function"==typeof r?this.onceEvents[t]=void 0:"object"==typeof r&&(1===r.length&&r[0]===e?this.onceEvents[t]=void 0:(0,s._fast_remove_single)(r,r.lastIndexOf(e)))),this}e.EventEmitter=u,u.prototype.emit=a,u.prototype.on=h,u.prototype.once=function(t,e){switch(this.emit===a&&(this.emit=c),typeof this.onceEvents[t]){case"undefined":this.onceEvents[t]=e,"symbol"==typeof t&&this._symbolKeys.add(t);break;case"function":this.onceEvents[t]=[this.onceEvents[t],e];break;case"object":this.onceEvents[t].push(e)}return this},u.prototype.addListener=h,u.prototype.removeListener=l,u.prototype.addListenerBound=function(t,e,n,r){void 0===n&&(n=this),void 0===r&&(r=e.length),this.boundFuncs||(this.boundFuncs=new Map);var i=e.bind(n);return this.boundFuncs.set(e,i),this.addListener(t,i,r)},u.prototype.removeListenerBound=function(t,e){var n,r,i=null===(n=this.boundFuncs)||void 0===n?void 0:n.get(e);return null===(r=this.boundFuncs)||void 0===r||r.delete(e),this.removeListener(t,i)},u.prototype.hasListeners=function(t){return this.events[t]&&!!this.events[t].length},u.prototype.prependListener=function(t,e,n){if(void 0===n&&(n=e.length),"function"!=typeof e)throw new TypeError("The listener must be a function");var r=this.events[t];return r&&r instanceof i.TaskCollection?(r.insert(0,e),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" event!'))):(r=this.events[t]=new i.TaskCollection(n,!0,e,!1),"symbol"==typeof t&&this._symbolKeys.add(t)),this},u.prototype.prependOnceListener=function(t,e){this.emit===a&&(this.emit=c);var n=this.onceEvents[t];return n?"object"!=typeof n?(this.onceEvents[t]=[e,n],"symbol"==typeof t&&this._symbolKeys.add(t)):(n.unshift(e),this.maxListeners!==1/0&&this.maxListeners<=n.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" once event!'))):(this.onceEvents[t]=[e],"symbol"==typeof t&&this._symbolKeys.add(t)),this},u.prototype.off=l,u.prototype.removeAllListeners=function(t){return void 0===t?(this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set):(this.events[t]=void 0,this.onceEvents[t]=void 0,"symbol"==typeof t&&this._symbolKeys.delete(t)),this},u.prototype.setMaxListeners=function(t){return this.maxListeners=t,this},u.prototype.getMaxListeners=function(){return this.maxListeners},u.prototype.listeners=function(t){return this.emit===a?this.events[t]?this.events[t].tasksAsArray().slice():[]:this.events[t]&&this.onceEvents[t]?r(r([],this.events[t].tasksAsArray(),!0),"function"==typeof this.onceEvents[t]?[this.onceEvents[t]]:this.onceEvents[t],!0):this.events[t]?this.events[t].tasksAsArray():this.onceEvents[t]?"function"==typeof this.onceEvents[t]?[this.onceEvents[t]]:this.onceEvents[t]:[]},u.prototype.eventNames=function(){var t=this;if(this.emit===a){var e=Object.keys(this.events);return r(r([],e,!0),Array.from(this._symbolKeys),!0).filter((function(e){return e in t.events&&t.events[e]&&t.events[e].length}))}e=Object.keys(this.events).filter((function(e){return t.events[e]&&t.events[e].length}));var n=Object.keys(this.onceEvents).filter((function(e){return t.onceEvents[e]&&t.onceEvents[e].length}));return r(r(r([],e,!0),n,!0),Array.from(this._symbolKeys).filter((function(e){return e in t.events&&t.events[e]&&t.events[e].length||e in t.onceEvents&&t.onceEvents[e]&&t.onceEvents[e].length})),!0)},u.prototype.listenerCount=function(t){return this.emit===a?this.events[t]&&this.events[t].length||0:(this.events[t]&&this.events[t].length||0)+(this.onceEvents[t]&&this.onceEvents[t].length||0)}},706:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(335),e),i(n(5030),e)},1665:(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(t){var e="";if(0===t)return e;for(var n=0;n<t-1;++n)e+="arg"+String(n)+", ";return e+"arg"+String(t-1)}function generateBodyPartsCode(t,e){for(var n="",r="",i=0;i<e;++i)n+="var f".concat(i," = collection[").concat(i,"];\n"),r+="f".concat(i,"(").concat(t,")\n");return{funcDefCode:n,funcCallCode:r}}function generateBodyPartsVariadicCode(t){for(var e="",n="",r=0;r<t;++r)e+="var f".concat(r," = collection[").concat(r,"];\n"),n+="f".concat(r,".apply(undefined, arguments)\n");return{funcDefCode:e,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                ").concat(funcCallCode,"\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=collection.length%10==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 10) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                        collection[i+4](").concat(argsDefCode,");\n                        collection[i+5](").concat(argsDefCode,");\n                        collection[i+6](").concat(argsDefCode,");\n                        collection[i+7](").concat(argsDefCode,");\n                        collection[i+8](").concat(argsDefCode,");\n                        collection[i+9](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%4==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 4) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%3==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 3) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                    }\n                });\n            })"):"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; ++i) {\n                        collection[i](").concat(argsDefCode,");\n                    }\n                });\n            })")}var bakeCollection_1=void 0,fixedArgsNum_1=void 0,bakeCollectionVariadic_1=void 0,bakeCollectionAwait_1=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionAwait(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                return Promise.all([ ").concat(funcCallCode," ]);\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode="(function(collection) {\n            return (function(".concat(argsDefCode,") {\n                var promises = Array(collection.length);\n                for (var i = 0; i < collection.length; ++i) {\n                    promises[i] = collection[i](").concat(argsDefCode,");\n                }\n                return Promise.all(promises);\n            });\n        })")}var bakeCollection_2=void 0,fixedArgsNum_2=void 0,bakeCollectionVariadic_2=void 0,bakeCollectionAwait_2=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionVariadic(collection){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function() {\n                ").concat(funcCallCode,"\n            });\n        })")}else funcFactoryCode="(function(collection) {\n            return (function() {\n                for (var i = 0; i < collection.length; ++i) {\n                    collection[i].apply(undefined, arguments);\n                }\n            });\n        })";var bakeCollection_3=void 0,fixedArgsNum=void 0,bakeCollectionVariadic_3=void 0,bakeCollectionAwait_3=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}exports.bakeCollection=bakeCollection,exports.bakeCollectionAwait=bakeCollectionAwait,exports.bakeCollectionVariadic=bakeCollectionVariadic},9857:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(9369),e)},9369:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.TaskCollection=void 0;var i=n(5372),s=n(1665);function o(t,e){var n,r=this.length;if(r>1)e?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(t),this.length++);else if(e){var i;1===r?((i=Array(1+arguments.length)).push(i),i.push.apply(i,arguments),this._tasks=i):((i=Array(arguments.length)).push.apply(i,arguments),this._tasks=i),this.length+=arguments.length}else this._tasks=1===r?[this._tasks,t]:t,this.length++}function a(t,e){var n,r=this.length;if(r>1)e?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(t),this.length++);else if(e){var i;1===r?((i=Array(1+arguments.length)).push(i),i.push.apply(i,arguments),this._tasks=i):((i=Array(arguments.length)).push.apply(i,arguments),this._tasks=i),this.length+=arguments.length}else this._tasks=1===r?[this._tasks,t]:t,this.length++;this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function c(t){0!==this.length&&(1===this.length?this._tasks===t&&(this.length=0):((0,i._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(t)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function u(t){if(0!==this.length){if(1===this.length)return this._tasks===t&&(this.length=0),this.firstEmitBuildStrategy?void(this.call=s.BAKED_EMPTY_FUNC):void this.rebuild();(0,i._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(t)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length,this.firstEmitBuildStrategy?this.call=p:this.rebuild()}}function h(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,r([t,0],n,!1)),this.length=this._tasks.length)}function l(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,r([t,0],n,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function d(){0===this.length?this.call=s.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,s.bakeCollection)(this._tasks,this.argsNum)}function f(){0===this.length?this.call=s.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,s.bakeCollectionAwait)(this._tasks,this.argsNum)}function p(){this.rebuild(),this.call.apply(void 0,arguments)}var y=function(t,e,n,r){void 0===e&&(e=!0),void 0===n&&(n=null),void 0===r&&(r=!1),this.awaitTasks=r,this.call=s.BAKED_EMPTY_FUNC,this.argsNum=t,this.firstEmitBuildStrategy=!0,this.rebuild=r?f.bind(this):d.bind(this),this.setAutoRebuild(e),n?"function"==typeof n?(this._tasks=n,this.length=1):(this._tasks=n,this.length=n.length):(this._tasks=null,this.length=0),e&&this.rebuild()};e.TaskCollection=y,y.prototype.fastClear=function(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC},y.prototype.clear=function(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC},y.prototype.growArgsNum=function(t){this.argsNum<t&&(this.argsNum=t,this.firstEmitBuildStrategy?this.call=p:this.rebuild())},y.prototype.setAutoRebuild=function(t){t?(this.push=a.bind(this),this.insert=l.bind(this),this.removeLast=u.bind(this)):(this.push=o.bind(this),this.insert=h.bind(this),this.removeLast=c.bind(this))},y.prototype.tasksAsArray=function(){return 0===this.length?[]:1===this.length?[this._tasks]:this._tasks},y.prototype.setTasks=function(t){0===t.length?(this.length=0,this.call=s.BAKED_EMPTY_FUNC):1===t.length?(this.length=1,this.call=t[0],this._tasks=t[0]):(this.length=t.length,this._tasks=t,this.firstEmitBuildStrategy?this.call=p:this.rebuild())}},5372:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._fast_remove_single=void 0,e._fast_remove_single=function(t,e){-1!==e&&(0===e?t.shift():e===t.length-1?t.length=t.length-1:t.splice(e,1))}},335:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},4547:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.nullObj=void 0,e.nullObj=function(){return{__proto__:null}}},359:function(t,e,n){"use strict";var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var i=n(1559),s=function(){function t(){}return t.prototype.empty=function(){return 0===this.size()},t.prototype.rbegin=function(){return this.end().reverse()},t.prototype.rend=function(){return this.begin().reverse()},t.prototype[Symbol.iterator]=function(){return new i.ForOfAdaptor(this.begin(),this.end())},t.prototype.toJSON=function(){var t,e,n=[];try{for(var i=r(this),s=i.next();!s.done;s=i.next()){var o=s.value;n.push(o)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return n},t}();e.Container=s},8555:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.MapContainer=void 0;var s=n(359),o=n(3848),a=function(t){function e(e){var n=t.call(this)||this;return n.data_=e(n),n}return i(e,t),e.prototype.assign=function(t,e){this.clear(),this.insert(t,e)},e.prototype.clear=function(){this.data_.clear()},e.prototype.begin=function(){return this.data_.begin()},e.prototype.end=function(){return this.data_.end()},e.prototype.has=function(t){return!this.find(t).equals(this.end())},e.prototype.size=function(){return this.data_.size()},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=new o.NativeArrayIterator(t,0),r=new o.NativeArrayIterator(t,t.length);return this.insert(n,r),this.size()},e.prototype.insert=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length?this.emplace(t[0].first,t[0].second):t[0].next instanceof Function&&t[1].next instanceof Function?this._Insert_by_range(t[0],t[1]):this.emplace_hint(t[0],t[1].first,t[1].second)},e.prototype.erase=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1!==t.length||t[0]instanceof this.end().constructor!=0&&t[0].source()===this?1===t.length?this._Erase_by_range(t[0]):this._Erase_by_range(t[0],t[1]):this._Erase_by_key(t[0])},e.prototype._Erase_by_range=function(t,e){void 0===e&&(e=t.next());var n=this.data_.erase(t,e);return this._Handle_erase(t,e),n},e}(s.Container);e.MapContainer=a},9793:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.SetContainer=void 0;var s=n(359),o=n(3848),a=function(t){function e(e){var n=t.call(this)||this;return n.data_=e(n),n}return i(e,t),e.prototype.assign=function(t,e){this.clear(),this.insert(t,e)},e.prototype.clear=function(){this.data_.clear()},e.prototype.begin=function(){return this.data_.begin()},e.prototype.end=function(){return this.data_.end()},e.prototype.has=function(t){return!this.find(t).equals(this.end())},e.prototype.size=function(){return this.data_.size()},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return this.size();var n=new o.NativeArrayIterator(t,0),r=new o.NativeArrayIterator(t,t.length);return this._Insert_by_range(n,r),this.size()},e.prototype.insert=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length?this._Insert_by_key(t[0]):t[0].next instanceof Function&&t[1].next instanceof Function?this._Insert_by_range(t[0],t[1]):this._Insert_by_hint(t[0],t[1])},e.prototype.erase=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1!==t.length||t[0]instanceof this.end().constructor&&t[0].source()===this?1===t.length?this._Erase_by_range(t[0]):this._Erase_by_range(t[0],t[1]):this._Erase_by_val(t[0])},e.prototype._Erase_by_range=function(t,e){void 0===e&&(e=t.next());var n=this.data_.erase(t,e);return this._Handle_erase(t,e),n},e}(s.Container);e.SetContainer=a},1887:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},o=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.UniqueMap=void 0;var a=n(8555),c=n(719),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.count=function(t){return this.find(t).equals(this.end())?0:1},e.prototype.get=function(t){var e=this.find(t);if(!0===e.equals(this.end()))throw c.ErrorGenerator.key_nout_found(this,"get",t);return e.second},e.prototype.take=function(t,e){var n=this.find(t);return n.equals(this.end())?this.emplace(t,e()).first.second:n.second},e.prototype.set=function(t,e){this.insert_or_assign(t,e)},e.prototype.insert=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.prototype.insert.apply(this,o([],s(e),!1))},e.prototype._Insert_by_range=function(t,e){for(var n=t;!n.equals(e);n=n.next())this.emplace(n.value.first,n.value.second)},e.prototype.insert_or_assign=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 2===t.length?this._Insert_or_assign_with_key_value(t[0],t[1]):3===t.length?this._Insert_or_assign_with_hint(t[0],t[1],t[2]):void 0},e.prototype._Insert_or_assign_with_key_value=function(t,e){var n=this.emplace(t,e);return!1===n.second&&(n.first.second=e),n},e.prototype._Insert_or_assign_with_hint=function(t,e,n){var r=this.emplace_hint(t,e,n);return r.second!==n&&(r.second=n),r},e.prototype.extract=function(t){return t instanceof this.end().constructor?this._Extract_by_iterator(t):this._Extract_by_key(t)},e.prototype._Extract_by_key=function(t){var e=this.find(t);if(!0===e.equals(this.end()))throw c.ErrorGenerator.key_nout_found(this,"extract",t);var n=e.value;return this._Erase_by_range(e),n},e.prototype._Extract_by_iterator=function(t){return!0===t.equals(this.end())?this.end():(this._Erase_by_range(t),t)},e.prototype._Erase_by_key=function(t){var e=this.find(t);return!0===e.equals(this.end())?0:(this._Erase_by_range(e),1)},e.prototype.merge=function(t){for(var e=t.begin();!e.equals(t.end());)!1===this.has(e.first)?(this.insert(e.value),e=t.erase(e)):e=e.next()},e}(a.MapContainer);e.UniqueMap=u},6001:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},o=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.UniqueSet=void 0;var a=n(9793),c=n(719),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.count=function(t){return this.find(t).equals(this.end())?0:1},e.prototype.insert=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.prototype.insert.apply(this,o([],s(e),!1))},e.prototype._Insert_by_range=function(t,e){for(;!t.equals(e);t=t.next())this._Insert_by_key(t.value)},e.prototype.extract=function(t){return t instanceof this.end().constructor?this._Extract_by_iterator(t):this._Extract_by_val(t)},e.prototype._Extract_by_val=function(t){var e=this.find(t);if(!0===e.equals(this.end()))throw c.ErrorGenerator.key_nout_found(this,"extract",t);return this._Erase_by_range(e),t},e.prototype._Extract_by_iterator=function(t){return!0===t.equals(this.end())||!1===this.has(t.value)?this.end():(this._Erase_by_range(t),t)},e.prototype._Erase_by_val=function(t){var e=this.find(t);return!0===e.equals(this.end())?0:(this._Erase_by_range(e),1)},e.prototype.merge=function(t){for(var e=t.begin();!e.equals(t.end());)!1===this.has(e.value)?(this.insert(e.value),e=t.erase(e)):e=e.next()},e}(a.SetContainer);e.UniqueSet=u},1302:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},o=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.HashMap=void 0;var a=n(1887),c=n(5312),u=n(808),h=n(3624),l=n(2971),d=n(7627),f=function(t){function e(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=t.call(this,(function(t){return new u.MapElementList(t)}))||this;return c.IHashContainer.construct.apply(c.IHashContainer,o([i,e,function(t,e){i.buckets_=new h.MapHashBuckets(i,t,e)}],s(n),!1)),i}return i(e,t),e.prototype.clear=function(){this.buckets_.clear(),t.prototype.clear.call(this)},e.prototype.swap=function(t){var e,n;e=s([t.data_,this.data_],2),this.data_=e[0],t.data_=e[1],u.MapElementList._Swap_associative(this.data_,t.data_),h.MapHashBuckets._Swap_source(this.buckets_,t.buckets_),n=s([t.buckets_,this.buckets_],2),this.buckets_=n[0],t.buckets_=n[1]},e.prototype.find=function(t){return this.buckets_.find(t)},e.prototype.begin=function(e){return void 0===e&&(e=null),null===e?t.prototype.begin.call(this):this.buckets_.at(e)[0]},e.prototype.end=function(e){if(void 0===e&&(e=null),null===e)return t.prototype.end.call(this);var n=this.buckets_.at(e);return n[n.length-1].next()},e.prototype.rbegin=function(t){return void 0===t&&(t=null),this.end(t).reverse()},e.prototype.rend=function(t){return void 0===t&&(t=null),this.begin(t).reverse()},e.prototype.bucket_count=function(){return this.buckets_.length()},e.prototype.bucket_size=function(t){return this.buckets_.at(t).length},e.prototype.load_factor=function(){return this.buckets_.load_factor()},e.prototype.hash_function=function(){return this.buckets_.hash_function()},e.prototype.key_eq=function(){return this.buckets_.key_eq()},e.prototype.bucket=function(t){return this.hash_function()(t)%this.buckets_.length()},e.prototype.max_load_factor=function(t){return void 0===t&&(t=null),this.buckets_.max_load_factor(t)},e.prototype.reserve=function(t){this.buckets_.reserve(t)},e.prototype.rehash=function(t){this.buckets_.rehash(t)},e.prototype.emplace=function(t,e){var n=this.find(t);return!1===n.equals(this.end())?new d.Pair(n,!1):(this.data_.push(new l.Entry(t,e)),n=n.prev(),this._Handle_insert(n,n.next()),new d.Pair(n,!0))},e.prototype.emplace_hint=function(t,e,n){var r=this.find(e);return!0===r.equals(this.end())&&(r=this.data_.insert(t,new l.Entry(e,n)),this._Handle_insert(r,r.next())),r},e.prototype._Handle_insert=function(t,e){for(;!t.equals(e);t=t.next())this.buckets_.insert(t)},e.prototype._Handle_erase=function(t,e){for(;!t.equals(e);t=t.next())this.buckets_.erase(t)},e}(a.UniqueMap);e.HashMap=f,function(t){t.Iterator=u.MapElementList.Iterator,t.ReverseIterator=u.MapElementList.ReverseIterator}(f=e.HashMap||(e.HashMap={})),e.HashMap=f},1188:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},o=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.HashSet=void 0;var a=n(6001),c=n(5312),u=n(2986),h=n(1130),l=n(7627),d=function(t){function e(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=t.call(this,(function(t){return new u.SetElementList(t)}))||this;return c.IHashContainer.construct.apply(c.IHashContainer,o([i,e,function(t,e){i.buckets_=new h.SetHashBuckets(i,t,e)}],s(n),!1)),i}return i(e,t),e.prototype.clear=function(){this.buckets_.clear(),t.prototype.clear.call(this)},e.prototype.swap=function(t){var e,n;e=s([t.data_,this.data_],2),this.data_=e[0],t.data_=e[1],u.SetElementList._Swap_associative(this.data_,t.data_),h.SetHashBuckets._Swap_source(this.buckets_,t.buckets_),n=s([t.buckets_,this.buckets_],2),this.buckets_=n[0],t.buckets_=n[1]},e.prototype.find=function(t){return this.buckets_.find(t)},e.prototype.begin=function(e){return void 0===e&&(e=null),null===e?t.prototype.begin.call(this):this.buckets_.at(e)[0]},e.prototype.end=function(e){if(void 0===e&&(e=null),null===e)return t.prototype.end.call(this);var n=this.buckets_.at(e);return n[n.length-1].next()},e.prototype.rbegin=function(t){return void 0===t&&(t=null),this.end(t).reverse()},e.prototype.rend=function(t){return void 0===t&&(t=null),this.begin(t).reverse()},e.prototype.bucket_count=function(){return this.buckets_.length()},e.prototype.bucket_size=function(t){return this.buckets_.at(t).length},e.prototype.load_factor=function(){return this.buckets_.load_factor()},e.prototype.hash_function=function(){return this.buckets_.hash_function()},e.prototype.key_eq=function(){return this.buckets_.key_eq()},e.prototype.bucket=function(t){return this.hash_function()(t)%this.buckets_.length()},e.prototype.max_load_factor=function(t){return void 0===t&&(t=null),this.buckets_.max_load_factor(t)},e.prototype.reserve=function(t){this.buckets_.reserve(t)},e.prototype.rehash=function(t){this.buckets_.rehash(t)},e.prototype._Insert_by_key=function(t){var e=this.find(t);return!1===e.equals(this.end())?new l.Pair(e,!1):(this.data_.push(t),e=e.prev(),this._Handle_insert(e,e.next()),new l.Pair(e,!0))},e.prototype._Insert_by_hint=function(t,e){var n=this.find(e);return!0===n.equals(this.end())&&(n=this.data_.insert(t,e),this._Handle_insert(n,n.next())),n},e.prototype._Handle_insert=function(t,e){for(;!t.equals(e);t=t.next())this.buckets_.insert(t)},e.prototype._Handle_erase=function(t,e){for(;!t.equals(e);t=t.next())this.buckets_.erase(t)},e}(a.UniqueSet);e.HashSet=d,function(t){t.Iterator=u.SetElementList.Iterator,t.ReverseIterator=u.SetElementList.ReverseIterator}(d=e.HashSet||(e.HashSet={})),e.HashSet=d},8099:function(t,e){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.Exception=void 0;var i=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this,i=n.prototype;return Object.setPrototypeOf?Object.setPrototypeOf(r,i):r.__proto__=i,r}return r(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),e.prototype.what=function(){return this.message},e.prototype.toJSON=function(){return{name:this.name,message:this.message,stack:this.stack}},e}(Error);e.Exception=i},2246:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.InvalidArgument=void 0;var s=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e}(n(8188).LogicError);e.InvalidArgument=s},8188:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.LogicError=void 0;var s=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e}(n(8099).Exception);e.LogicError=s},5422:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.OutOfRange=void 0;var s=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e}(n(8188).LogicError);e.OutOfRange=s},9909:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.greater_equal=e.greater=e.less_equal=e.less=e.not_equal_to=e.equal_to=void 0;var r=n(5962);function i(t,e){return t=t?t.valueOf():t,e=e?e.valueOf():e,t instanceof Object&&t.equals instanceof Function?t.equals(e):t===e}function s(t,e){return t=t.valueOf(),e=e.valueOf(),t instanceof Object?t.less instanceof Function?t.less(e):(0,r.get_uid)(t)<(0,r.get_uid)(e):t<e}function o(t,e){return s(t,e)||i(t,e)}e.equal_to=i,e.not_equal_to=function(t,e){return!i(t,e)},e.less=s,e.less_equal=o,e.greater=function(t,e){return!o(t,e)},e.greater_equal=function(t,e){return!s(t,e)}},966:function(t,e,n){"use strict";var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.hash=void 0;var i=n(5962);function s(t,e){return(e^=t?1:0)*u}function o(t,e){return a(t.toString(),e)}function a(t,e){for(var n=0;n<t.length;++n)e^=t.charCodeAt(n),e*=u;return Math.abs(e)}e.hash=function(){for(var t,e,n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];var l=c;try{for(var d=r(n),f=d.next();!f.done;f=d.next()){var p=f.value,y=typeof(p=p?p.valueOf():p);if("boolean"===y)l=s(p,l);else if("number"===y||"bigint"===y)l=o(p,l);else if("string"===y)l=a(p,l);else if(p instanceof Object&&p.hashCode instanceof Function){var g=p.hashCode();if(1===n.length)return g;l^=g,l*=u}else l=o((0,i.get_uid)(p),l)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(e=d.return)&&e.call(d)}finally{if(t)throw t.error}}return Math.abs(l)};var c=2166136261,u=16777619},5962:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get_uid=void 0;var r=n(8321);e.get_uid=function(t){if(t instanceof Object){if(!1===t.hasOwnProperty("__get_m_iUID")){var e=++(0,r._Get_root)().__s_iUID;Object.defineProperty(t,"__get_m_iUID",{value:function(){return e}})}return t.__get_m_iUID()}return void 0===t?-1:0}},8321:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._Get_root=void 0;var r=n(5539);e._Get_root=function(){return null===i&&void 0===(i=(0,r.is_node)()?n.g:self).__s_iUID&&(i.__s_iUID=0),i};var i=null},105:function(t,e){"use strict";var n=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.IAssociativeContainer=void 0,(e.IAssociativeContainer||(e.IAssociativeContainer={})).construct=function(t){for(var e,i,s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];return s.length>=1&&s[0]instanceof Array?(e=function(){var e=s[0];t.push.apply(t,r([],n(e),!1))},i=s.slice(1)):s.length>=2&&s[0].next instanceof Function&&s[1].next instanceof Function?(e=function(){var e=s[0],n=s[1];t.assign(e,n)},i=s.slice(2)):(e=null,i=s),{ramda:e,tail:i}}},5312:function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},i=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.IHashContainer=void 0;var s=n(105),o=n(966),a=n(9909);(e.IHashContainer||(e.IHashContainer={})).construct=function(t,e,n){for(var c=[],u=3;u<arguments.length;u++)c[u-3]=arguments[u];var h=null,l=o.hash,d=a.equal_to;if(1===c.length&&c[0]instanceof e){var f=c[0];l=f.hash_function(),d=f.key_eq(),h=function(){var e=f.begin(),n=f.end();t.assign(e,n)}}else{var p=s.IAssociativeContainer.construct.apply(s.IAssociativeContainer,i([t],r(c),!1));h=p.ramda,p.tail.length>=1&&(l=p.tail[0]),p.tail.length>=2&&(d=p.tail[1])}n(l,d),null!==h&&h()}},808:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.MapElementList=void 0;var o=n(1363),a=n(6365),c=n(7907),u=function(t){function e(e){var n=t.call(this)||this;return n.associative_=e,n}return i(e,t),e.prototype._Create_iterator=function(t,n,r){return e.Iterator.create(this,t,n,r)},e._Swap_associative=function(t,e){var n;n=s([e.associative_,t.associative_],2),t.associative_=n[0],e.associative_=n[1]},e.prototype.associative=function(){return this.associative_},e}(o.ListContainer);e.MapElementList=u,function(t){var e=function(t){function e(e,n,r,i){var s=t.call(this,n,r,i)||this;return s.list_=e,s}return i(e,t),e.create=function(t,n,r,i){return new e(t,n,r,i)},e.prototype.reverse=function(){return new n(this)},e.prototype.source=function(){return this.list_.associative()},Object.defineProperty(e.prototype,"first",{get:function(){return this.value.first},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"second",{get:function(){return this.value.second},set:function(t){this.value.second=t},enumerable:!1,configurable:!0}),e}(a.ListIterator);t.Iterator=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._Create_neighbor=function(t){return new e(t)},Object.defineProperty(e.prototype,"first",{get:function(){return this.base_.first},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"second",{get:function(){return this.base_.second},set:function(t){this.base_.second=t},enumerable:!1,configurable:!0}),e}(c.ReverseIterator);t.ReverseIterator=n}(u=e.MapElementList||(e.MapElementList={})),e.MapElementList=u},2986:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.SetElementList=void 0;var o=n(1363),a=n(6365),c=n(7907),u=function(t){function e(e){var n=t.call(this)||this;return n.associative_=e,n}return i(e,t),e.prototype._Create_iterator=function(t,n,r){return e.Iterator.create(this,t,n,r)},e._Swap_associative=function(t,e){var n;n=s([e.associative_,t.associative_],2),t.associative_=n[0],e.associative_=n[1]},e.prototype.associative=function(){return this.associative_},e}(o.ListContainer);e.SetElementList=u,function(t){var e=function(t){function e(e,n,r,i){var s=t.call(this,n,r,i)||this;return s.source_=e,s}return i(e,t),e.create=function(t,n,r,i){return new e(t,n,r,i)},e.prototype.reverse=function(){return new n(this)},e.prototype.source=function(){return this.source_.associative()},e}(a.ListIterator);t.Iterator=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._Create_neighbor=function(t){return new e(t)},e}(c.ReverseIterator);t.ReverseIterator=n}(u=e.SetElementList||(e.SetElementList={})),e.SetElementList=u},1363:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.ListContainer=void 0;var o=n(359),a=n(6365),c=n(7100),u=n(3848),h=n(5948),l=n(719),d=function(t){function e(){var e=t.call(this)||this;return e.end_=e._Create_iterator(null,null),e.clear(),e}return i(e,t),e.prototype.assign=function(t,e){this.clear(),this.insert(this.end(),t,e)},e.prototype.clear=function(){a.ListIterator._Set_prev(this.end_,this.end_),a.ListIterator._Set_next(this.end_,this.end_),this.begin_=this.end_,this.size_=0},e.prototype.resize=function(t){var e=t-this.size();e>0?this.insert(this.end(),e,void 0):e<0&&this.erase((0,h.advance)(this.end(),-e),this.end())},e.prototype.begin=function(){return this.begin_},e.prototype.end=function(){return this.end_},e.prototype.size=function(){return this.size_},e.prototype.push_front=function(t){this.insert(this.begin_,t)},e.prototype.push_back=function(t){this.insert(this.end_,t)},e.prototype.pop_front=function(){if(!0===this.empty())throw l.ErrorGenerator.empty(this.end_.source().constructor.name,"pop_front");this.erase(this.begin_)},e.prototype.pop_back=function(){if(!0===this.empty())throw l.ErrorGenerator.empty(this.end_.source().constructor.name,"pop_back");this.erase(this.end_.prev())},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return this.size();var n=new u.NativeArrayIterator(t,0),r=new u.NativeArrayIterator(t,t.length);return this._Insert_by_range(this.end(),n,r),this.size()},e.prototype.insert=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t.source()!==this.end_.source())throw l.ErrorGenerator.not_my_iterator(this.end_.source(),"insert");if(!0===t.erased_)throw l.ErrorGenerator.erased_iterator(this.end_.source(),"insert");return 1===e.length?this._Insert_by_repeating_val(t,1,e[0]):2===e.length&&"number"==typeof e[0]?this._Insert_by_repeating_val(t,e[0],e[1]):this._Insert_by_range(t,e[0],e[1])},e.prototype._Insert_by_repeating_val=function(t,e,n){var r=new c.Repeater(0,n),i=new c.Repeater(e);return this._Insert_by_range(t,r,i)},e.prototype._Insert_by_range=function(t,e,n){for(var r=t.prev(),i=null,s=0,o=e;!1===o.equals(n);o=o.next()){var c=this._Create_iterator(r,null,o.value);0===s&&(i=c),a.ListIterator._Set_next(r,c),r=c,++s}return!0===t.equals(this.begin())&&(this.begin_=i),a.ListIterator._Set_next(r,t),a.ListIterator._Set_prev(t,r),this.size_+=s,i},e.prototype.erase=function(t,e){return void 0===e&&(e=t.next()),this._Erase_by_range(t,e)},e.prototype._Erase_by_range=function(t,e){if(t.source()!==this.end_.source())throw l.ErrorGenerator.not_my_iterator(this.end_.source(),"insert");if(!0===t.erased_)throw l.ErrorGenerator.erased_iterator(this.end_.source(),"insert");if(t.equals(this.end_))return this.end_;var n=t.prev();a.ListIterator._Set_next(n,e),a.ListIterator._Set_prev(e,n);for(var r=t;!r.equals(e);r=r.next())r.erased_=!0,--this.size_;return t.equals(this.begin_)&&(this.begin_=e),e},e.prototype.swap=function(t){var e,n,r;e=s([t.begin_,this.begin_],2),this.begin_=e[0],t.begin_=e[1],n=s([t.end_,this.end_],2),this.end_=n[0],t.end_=n[1],r=s([t.size_,this.size_],2),this.size_=r[0],t.size_=r[1]},e}(o.Container);e.ListContainer=d},719:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorGenerator=void 0;var r=n(2246),i=n(5422);!function(t){function e(t){if("string"==typeof t)return t;var e=t.constructor.name;return t.constructor.__MODULE&&(e="".concat(t.constructor.__MODULE,".").concat(e)),"std.".concat(e)}t.get_class_name=e,t.empty=function(t,n){return new i.OutOfRange("Error on ".concat(e(t),".").concat(n,"(): it's empty container."))},t.negative_index=function(t,n,r){return new i.OutOfRange("Error on ".concat(e(t),".").concat(n,"(): parametric index is negative -> (index = ").concat(r,")."))},t.excessive_index=function(t,n,r,s){return new i.OutOfRange("Error on ".concat(e(t),".").concat(n,"(): parametric index is equal or greater than size -> (index = ").concat(r,", size: ").concat(s,")."))},t.not_my_iterator=function(t,n){return new r.InvalidArgument("Error on ".concat(e(t),".").concat(n,"(): parametric iterator is not this container's own."))},t.erased_iterator=function(t,n){return new r.InvalidArgument("Error on ".concat(e(t),".").concat(n,"(): parametric iterator, it already has been erased."))},t.negative_iterator=function(t,n,r){return new i.OutOfRange("Error on ".concat(e(t),".").concat(n,"(): parametric iterator is directing negative position -> (index = ").concat(r,")."))},t.iterator_end_value=function(t,n){void 0===n&&(n="end");var r=e(t);return new i.OutOfRange("Error on ".concat(r,".Iterator.value: cannot access to the ").concat(r,".").concat(n,"().value."))},t.key_nout_found=function(t,n,r){throw new i.OutOfRange("Error on ".concat(e(t),".").concat(n,"(): unable to find the matched key -> ").concat(r))}}(e.ErrorGenerator||(e.ErrorGenerator={}))},2402:function(t,e){"use strict";var n=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.HashBuckets=void 0;var r=function(){function t(t,e){this.fetcher_=t,this.hasher_=e,this.max_load_factor_=s,this.data_=[],this.size_=0,this.initialize()}return t.prototype.clear=function(){this.data_=[],this.size_=0,this.initialize()},t.prototype.rehash=function(t){var e,r,s,o;t=Math.max(t,i);for(var a=[],c=0;c<t;++c)a.push([]);try{for(var u=n(this.data_),h=u.next();!h.done;h=u.next()){var l=h.value;try{for(var d=(s=void 0,n(l)),f=d.next();!f.done;f=d.next()){var p=f.value;a[this.hasher_(this.fetcher_(p))%a.length].push(p)}}catch(t){s={error:t}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(s)throw s.error}}}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}this.data_=a},t.prototype.reserve=function(t){t>this.capacity()&&(t=Math.floor(t/this.max_load_factor_),this.rehash(t))},t.prototype.initialize=function(){for(var t=0;t<i;++t)this.data_.push([])},t.prototype.length=function(){return this.data_.length},t.prototype.capacity=function(){return this.data_.length*this.max_load_factor_},t.prototype.at=function(t){return this.data_[t]},t.prototype.load_factor=function(){return this.size_/this.length()},t.prototype.max_load_factor=function(t){if(void 0===t&&(t=null),null===t)return this.max_load_factor_;this.max_load_factor_=t},t.prototype.hash_function=function(){return this.hasher_},t.prototype.index=function(t){return this.hasher_(this.fetcher_(t))%this.length()},t.prototype.insert=function(t){var e=this.capacity();++this.size_>e&&this.reserve(2*e);var n=this.index(t);this.data_[n].push(t)},t.prototype.erase=function(t){for(var e=this.index(t),n=this.data_[e],r=0;r<n.length;++r)if(n[r]===t){n.splice(r,1),--this.size_;break}},t}();e.HashBuckets=r;var i=10,s=1},3624:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.MapHashBuckets=void 0;var a=function(t){function e(e,n,r){var i=t.call(this,c,n)||this;return i.source_=e,i.key_eq_=r,i}return i(e,t),e._Swap_source=function(t,e){var n;n=s([e.source_,t.source_],2),t.source_=n[0],e.source_=n[1]},e.prototype.key_eq=function(){return this.key_eq_},e.prototype.find=function(t){var e,n,r=this.hash_function()(t)%this.length(),i=this.at(r);try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var c=a.value;if(this.key_eq_(c.first,t))return c}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return this.source_.end()},e}(n(2402).HashBuckets);function c(t){return t.first}e.MapHashBuckets=a},1130:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.SetHashBuckets=void 0;var a=function(t){function e(e,n,r){var i=t.call(this,c,n)||this;return i.source_=e,i.key_eq_=r,i}return i(e,t),e._Swap_source=function(t,e){var n;n=s([e.source_,t.source_],2),t.source_=n[0],e.source_=n[1]},e.prototype.key_eq=function(){return this.key_eq_},e.prototype.find=function(t){var e,n,r=this.hash_function()(t)%this.length(),i=this.at(r);try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var c=a.value;if(this.key_eq_(c.value,t))return c}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return this.source_.end()},e}(n(2402).HashBuckets);function c(t){return t.value}e.SetHashBuckets=a},6365:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListIterator=void 0;var r=n(719),i=function(){function t(t,e,n){this.prev_=t,this.next_=e,this.value_=n}return t._Set_prev=function(t,e){t.prev_=e},t._Set_next=function(t,e){t.next_=e},t.prototype.prev=function(){return this.prev_},t.prototype.next=function(){return this.next_},Object.defineProperty(t.prototype,"value",{get:function(){return this._Try_value(),this.value_},enumerable:!1,configurable:!0}),t.prototype._Try_value=function(){if(void 0===this.value_&&!0===this.equals(this.source().end()))throw r.ErrorGenerator.iterator_end_value(this.source())},t.prototype.equals=function(t){return this===t},t}();e.ListIterator=i},7907:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ReverseIterator=void 0;var n=function(){function t(t){this.base_=t.prev()}return t.prototype.source=function(){return this.base_.source()},t.prototype.base=function(){return this.base_.next()},Object.defineProperty(t.prototype,"value",{get:function(){return this.base_.value},enumerable:!1,configurable:!0}),t.prototype.prev=function(){return this._Create_neighbor(this.base().next())},t.prototype.next=function(){return this._Create_neighbor(this.base_)},t.prototype.equals=function(t){return this.base_.equals(t.base_)},t}();e.ReverseIterator=n},1559:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ForOfAdaptor=void 0;var n=function(){function t(t,e){this.it_=t,this.last_=e}return t.prototype.next=function(){if(this.it_.equals(this.last_))return{done:!0,value:void 0};var t=this.it_;return this.it_=this.it_.next(),{done:!1,value:t.value}},t.prototype[Symbol.iterator]=function(){return this},t}();e.ForOfAdaptor=n},3848:function(t,e){"use strict";var n=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.NativeArrayIterator=void 0;var r=function(){function t(t,e){this.data_=t,this.index_=e}return t.prototype.index=function(){return this.index_},Object.defineProperty(t.prototype,"value",{get:function(){return this.data_[this.index_]},enumerable:!1,configurable:!0}),t.prototype.prev=function(){return--this.index_,this},t.prototype.next=function(){return++this.index_,this},t.prototype.advance=function(t){return this.index_+=t,this},t.prototype.equals=function(t){return this.data_===t.data_&&this.index_===t.index_},t.prototype.swap=function(t){var e,r;e=n([t.data_,this.data_],2),this.data_=e[0],t.data_=e[1],r=n([t.index_,this.index_],2),this.index_=r[0],t.index_=r[1]},t}();e.NativeArrayIterator=r},7100:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Repeater=void 0;var n=function(){function t(t,e){this.index_=t,this.value_=e}return t.prototype.index=function(){return this.index_},Object.defineProperty(t.prototype,"value",{get:function(){return this.value_},enumerable:!1,configurable:!0}),t.prototype.next=function(){return++this.index_,this},t.prototype.equals=function(t){return this.index_===t.index_},t}();e.Repeater=n},5948:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.next=e.prev=e.advance=e.distance=e.size=e.empty=void 0;var r=n(2246);function i(t,e){if(0===e)return t;if(t.advance instanceof Function)return t.advance(e);var n;if(e<0){if(!(t.prev instanceof Function))throw new r.InvalidArgument("Error on std.advance(): parametric iterator is not a bi-directional iterator, thus advancing to negative direction is not possible.");n=function(t){return t.prev()},e=-e}else n=function(t){return t.next()};for(;e-- >0;)t=n(t);return t}e.empty=function(t){return t instanceof Array?0!==t.length:t.empty()},e.size=function(t){return t instanceof Array?t.length:t.size()},e.distance=function(t,e){if(t.index instanceof Function)return function(t,e){var n=t.index(),r=e.index();return t.base instanceof Function?n-r:r-n}(t,e);for(var n=0;!t.equals(e);t=t.next())++n;return n},e.advance=i,e.prev=function(t,e){return void 0===e&&(e=1),1===e?t.prev():i(t,-e)},e.next=function(t,e){return void 0===e&&(e=1),1===e?t.next():i(t,e)}},2971:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Entry=void 0;var r=n(966),i=n(9909),s=function(){function t(t,e){this.first=t,this.second=e}return t.prototype.equals=function(t){return(0,i.equal_to)(this.first,t.first)},t.prototype.less=function(t){return(0,i.less)(this.first,t.first)},t.prototype.hashCode=function(){return(0,r.hash)(this.first)},t}();e.Entry=s},7627:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.make_pair=e.Pair=void 0;var r=n(966),i=n(9909),s=function(){function t(t,e){this.first=t,this.second=e}return t.prototype.equals=function(t){return(0,i.equal_to)(this.first,t.first)&&(0,i.equal_to)(this.second,t.second)},t.prototype.less=function(t){return!1===(0,i.equal_to)(this.first,t.first)?(0,i.less)(this.first,t.first):(0,i.less)(this.second,t.second)},t.prototype.hashCode=function(){return(0,r.hash)(this.first,this.second)},t}();e.Pair=s,e.make_pair=function(t,e){return new s(t,e)}},5539:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.is_node=void 0,e.is_node=function(){var t;return null===r&&(r="object"==typeof n.g&&null!==(t=n.g)&&"object"==typeof t.process&&null!==t.process&&"object"==typeof t.process.versions&&null!==t.process.versions&&void 0!==t.process.versions.node),r};var r=null},6145:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCache=void 0;const r=n(5397);class i{constructor(t){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:e=25,entryExpirationTimeInMS:n=null,onEntryEvicted:r,onEntryMarkedAsMostRecentlyUsed:i,cloneFn:s,clone:o}=null!=t?t:{};if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");if("number"==typeof n&&(n<=0||Number.isNaN(n)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=e,this.entryExpirationTimeInMS=n,this.onEntryEvicted=r,this.onEntryMarkedAsMostRecentlyUsed=i,this.clone=o,this.cloneFn=s}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(t){if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=t,this.enforceSizeLimit()}set(t,e,n){const i=this.lookupTable.get(t);i&&this.removeNodeFromListAndLookupTable(i);const s=new r.LRUCacheNode(t,e,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...n});return this.setNodeAsHead(s),this.lookupTable.set(t,s),this.enforceSizeLimit(),this}get(t){const e=this.lookupTable.get(t);return e?e.isExpired?(this.removeNodeFromListAndLookupTable(e),null):(this.setNodeAsHead(e),e.value):null}peek(t){const e=this.lookupTable.get(t);return e?e.isExpired?(this.removeNodeFromListAndLookupTable(e),null):e.value:null}delete(t){const e=this.lookupTable.get(t);return!!e&&this.removeNodeFromListAndLookupTable(e)}has(t){const e=this.lookupTable.get(t);return!(!e||e.isExpired&&(this.removeNodeFromListAndLookupTable(e),1))}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(t){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}const n=this.mapNodeToEntry(e);if(t(n))return this.setNodeAsHead(e),n;e=e.next}return null}forEach(t){let e=this.head,n=0;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else t(e.value,e.key,n),e=e.next,n++}*values(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield t.value,t=t.next}*keys(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield t.key,t=t.next}*entries(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield this.mapNodeToEntry(t),t=t.next}*[Symbol.iterator](){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield this.mapNodeToEntry(t),t=t.next}enforceSizeLimit(){let t=this.tail;for(;null!==t&&this.size>this.maxSizeInternal;){const e=t.prev;this.removeNodeFromListAndLookupTable(t),t=e}}mapNodeToEntry({key:t,value:e}){return{key:t,value:e}}setNodeAsHead(t){this.removeNodeFromList(t),this.head?(t.next=this.head,this.head.prev=t,this.head=t):(this.head=t,this.tail=t),t.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(t){null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.head===t&&(this.head=t.next),this.tail===t&&(this.tail=t.prev),t.next=null,t.prev=null}removeNodeFromListAndLookupTable(t){return t.invokeOnEvicted(),this.removeNodeFromList(t),this.lookupTable.delete(t.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const t=[];for(const e of this.lookupTable.values())e.isExpired&&t.push(e);t.forEach((t=>this.removeNodeFromListAndLookupTable(t)))}}e.LRUCache=i},5397:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCacheNode=void 0,e.LRUCacheNode=class{constructor(t,e,n){const{entryExpirationTimeInMS:r=null,next:i=null,prev:s=null,onEntryEvicted:o,onEntryMarkedAsMostRecentlyUsed:a,clone:c,cloneFn:u}=null!=n?n:{};if("number"==typeof r&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=null!=c&&c,this.cloneFn=null!=u?u:this.defaultClone,this.key=t,this.internalValue=this.clone?this.cloneFn(e):e,this.created=Date.now(),this.entryExpirationTimeInMS=r,this.next=i,this.prev=s,this.onEntryEvicted=o,this.onEntryMarkedAsMostRecentlyUsed=a}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return"number"==typeof this.entryExpirationTimeInMS&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:t,value:e,isExpired:n}=this;this.onEntryEvicted({key:t,value:e,isExpired:n})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:t,value:e}=this;this.onEntryMarkedAsMostRecentlyUsed({key:t,value:e})}}defaultClone(t){return"boolean"==typeof t||"string"==typeof t||"number"==typeof t?t:JSON.parse(JSON.stringify(t))}}},6654:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(6145),e)},6947:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},s.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var o=n(952),a=n(6253),c=n(9172),u=n(5426),h=n(2339),l=n(6416),d=function(t){function e(n,r){var i=t.call(this)||this;return i.on_={},i.state_=e.CONNECTING,i.client_=new o.client,i.client_.on("connect",i._Handle_connect.bind(i)),i.client_.on("connectFailed",i._Handle_error.bind(i)),"string"==typeof r&&(r=[r]),i.client_.connect(n,r),i}return i(e,t),e.prototype.close=function(t,n){this.state_=e.CLOSING,void 0===t?this.connection_.sendCloseFrame():this.connection_.sendCloseFrame(t,n,!0)},e.prototype.send=function(t){if("string"==typeof t.valueOf())this.connection_.sendUTF(t);else{var e;e=t instanceof Buffer?t:t instanceof Blob?new Buffer(t,"blob"):t.buffer?new Buffer(t.buffer):new Buffer(t),this.connection_.sendBytes(e)}},Object.defineProperty(e.prototype,"url",{get:function(){return this.client_.url.href},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this.client_.protocols?this.client_.protocols[0]:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this.connection_&&this.connection_.extensions?this.connection_.extensions[0].name:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.state_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this.connection_.bytesWaitingToFlush},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return"arraybuffer"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onopen",{get:function(){return this.on_.open},set:function(t){this._Set_on("open",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onclose",{get:function(){return this.on_.close},set:function(t){this._Set_on("close",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onmessage",{get:function(){return this.on_.message},set:function(t){this._Set_on("message",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onerror",{get:function(){return this.on_.error},set:function(t){this._Set_on("error",t)},enumerable:!0,configurable:!0}),e.prototype._Set_on=function(t,e){this.on_[t]&&this.removeEventListener(t,this.on_[t]),this.addEventListener(t,e),this.on_[t]=e},e.prototype._Handle_connect=function(t){this.connection_=t,this.state_=e.OPEN,this.connection_.on("message",this._Handle_message.bind(this)),this.connection_.on("error",this._Handle_error.bind(this)),this.connection_.on("close",this._Handle_close.bind(this));var n=new c.Event("open",f);this.dispatchEvent(n)},e.prototype._Handle_close=function(t,n){var r=new u.CloseEvent("close",s({},f,{code:t,reason:n}));this.state_=e.CLOSED,this.dispatchEvent(r)},e.prototype._Handle_message=function(t){var e=new h.MessageEvent("message",s({},f,{data:t.binaryData?t.binaryData:t.utf8Data}));this.dispatchEvent(e)},e.prototype._Handle_error=function(t){var n=new l.ErrorEvent("error",s({},f,{error:t,message:t.message}));this.state_===e.CONNECTING&&(this.state_=e.CLOSED),this.dispatchEvent(n)},e}(a.EventTarget);e.WebSocket=d,function(t){t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3}(d=e.WebSocket||(e.WebSocket={})),e.WebSocket=d;var f={bubbles:!1,cancelable:!1}},5426:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,n){return t.call(this,e,n)||this}return i(e,t),e}(n(9172).Event);e.CloseEvent=s},6416:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,n){return t.call(this,e,n)||this}return i(e,t),e}(n(9172).Event);e.ErrorEvent=s},9172:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Event=function(t,e){this.type=t,e&&Object.assign(this,e)}},6253:function(t,e,n){"use strict";var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(1188),s=n(1302),o=function(){function t(){this.listeners_=new s.HashMap,this.created_at_=new Date}return t.prototype.dispatchEvent=function(t){var e,n,i=this.listeners_.find(t.type);if(!i.equals(this.listeners_.end())){t.target=this,t.timeStamp=(new Date).getTime()-this.created_at_.getTime();try{for(var s=r(i.second),o=s.next();!o.done;o=s.next())(0,o.value)(t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}}},t.prototype.addEventListener=function(t,e){var n=this.listeners_.find(t);n.equals(this.listeners_.end())&&(n=this.listeners_.emplace(t,new i.HashSet).first),n.second.insert(e)},t.prototype.removeEventListener=function(t,e){var n=this.listeners_.find(t);n.equals(this.listeners_.end())||(n.second.erase(e),n.second.empty()&&this.listeners_.erase(n))},t}();e.EventTarget=o},2339:function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,n){return t.call(this,e,n)||this}return i(e,t),e}(n(9172).Event);e.MessageEvent=s},2388:(t,e,n)=>{"use strict";n(5539).is_node()&&(n.g.WebSocket=n(6947).WebSocket)},952:(t,e,n)=>{var r;if("object"==typeof globalThis)r=globalThis;else try{r=n(4903)}catch(t){}finally{if(r||"undefined"==typeof window||(r=window),!r)throw new Error("Could not determine global this")}var i=r.WebSocket||r.MozWebSocket,s=n(9840);function o(t,e){return e?new i(t,e):new i(t)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(t){Object.defineProperty(o,t,{get:function(){return i[t]}})})),t.exports={w3cwebsocket:i?o:null,version:s}},9840:(t,e,n)=>{t.exports=n(9003).version},9003:t=>{"use strict";t.exports={version:"1.0.35"}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var t={};__webpack_require__.r(t),__webpack_require__.d(t,{aK:()=>se,e8:()=>qt,DO:()=>zt,dJ:()=>oe,OG:()=>ae,My:()=>Ht,Ph:()=>Yt,lX:()=>Qt,Id:()=>ne,fg:()=>he,qj:()=>ee,aT:()=>Jt,r4:()=>ie,aY:()=>Dt,x:()=>fe,lq:()=>Xt,z:()=>te,zW:()=>Vt,Q5:()=>de});var e={};function n(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function r(t,...e){if(!((n=t)instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function i(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}__webpack_require__.r(e),__webpack_require__.d(e,{OG:()=>$o,My:()=>Io,Ph:()=>Po,lX:()=>Lo,Id:()=>Fo,fg:()=>qo,qj:()=>jo,aT:()=>Uo,lq:()=>Bo,z:()=>Mo,Q5:()=>Ho});const s="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,o=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),a=(t,e)=>t<<32-e|t>>>e,c=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function u(t){r(t);let e="";for(let n=0;n<t.length;n++)e+=c[t[n]];return e}function h(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:void 0}function l(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),r(t),t}class d{clone(){return this._cloneInto()}}function f(t){const e=e=>t().update(l(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function p(t=32){if(s&&"function"==typeof s.getRandomValues)return s.getRandomValues(new Uint8Array(t));if(s&&"function"==typeof s.randomBytes)return s.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const y=(t,e,n)=>t&e^t&n^e&n;class g extends d{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=o(this.buffer)}update(t){i(this);const{view:e,buffer:n,blockLen:r}=this,s=(t=l(t)).length;for(let i=0;i<s;){const a=Math.min(r-this.pos,s-i);if(a!==r)n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=o(t);for(;r<=s-i;i+=r)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){i(this),function(t,e){r(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:s,isLE:a}=this;let{pos:c}=this;e[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>s-c&&(this.process(n,0),c=0);for(let t=c;t<s;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}(n,s-8,BigInt(8*this.length),a),this.process(n,0);const u=o(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=h/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<l;t++)u.setUint32(4*t,d[t],a)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return t.length=r,t.pos=o,t.finished=i,t.destroyed=s,r%e&&t.buffer.set(n),t}}const m=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),w=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),b=new Uint32Array(64);class v extends g{constructor(){super(64,32,8,!1),this.A=0|w[0],this.B=0|w[1],this.C=0|w[2],this.D=0|w[3],this.E=0|w[4],this.F=0|w[5],this.G=0|w[6],this.H=0|w[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[t,e,n,r,i,s,o,a]}set(t,e,n,r,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)b[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=b[t-15],n=b[t-2],r=a(e,7)^a(e,18)^e>>>3,i=a(n,17)^a(n,19)^n>>>10;b[t]=i+b[t-7]+r+b[t-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:c,G:u,H:h}=this;for(let t=0;t<64;t++){const e=h+(a(o,6)^a(o,11)^a(o,25))+((l=o)&c^~l&u)+m[t]+b[t]|0,d=(a(n,2)^a(n,13)^a(n,22))+y(n,r,i)|0;h=u,u=c,c=o,o=s+e|0,s=i,i=r,r=n,n=e+d|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,c=c+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(n,r,i,s,o,c,u,h)}roundClean(){b.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const _=f((()=>new v));function E(t){if(t>Number.MAX_SAFE_INTEGER)throw new TypeError("Number exceeds safe bounds!")}function k(t,e){if(t!==e)throw new TypeError(`Bech32 prefix does not match: ${t} !== ${e}`)}const x=new TextEncoder,A=new TextDecoder;function S(t){return x.encode(t)}function C(t){return A.decode(t)}function O(t,e,n="le"){e=function(t,e){!function(t){if(null!==t.match(/[^a-fA-f0-9]/))throw new TypeError("Invalid characters in hex string: "+t);if(t.length%2!=0)throw new Error(`Length of hex string is invalid: ${t.length}`)}(t);const n=t.length/2;if(void 0===e&&(e=n),n>e)throw new TypeError(`Hex string is larger than array size: ${n} > ${e}`);return e}(t,e);const r="le"===n,i=new ArrayBuffer(e),s=new DataView(i);let o=r?0:e-1;for(let e=0;e<t.length;e+=2){const n=t.substring(e,e+2),i=parseInt(n,16);r?s.setUint8(o++,i):s.setUint8(o--,i)}return new Uint8Array(i)}function T(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function R(t,e){return!!Array.isArray(e)&&(0===e.length||(t?e.every((t=>"string"==typeof t)):e.every((t=>Number.isSafeInteger(t)))))}function I(t){if("function"!=typeof t)throw new Error("function expected");return!0}function N(t,e){if("string"!=typeof e)throw new Error(`${t}: string expected`);return!0}function U(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function P(t){if(!Array.isArray(t))throw new Error("array expected")}function L(t,e){if(!R(!0,e))throw new Error(`${t}: array of strings expected`)}function B(t,e){if(!R(!1,e))throw new Error(`${t}: array of numbers expected`)}function M(...t){const e=t=>t,n=(t,e)=>n=>t(e(n));return{encode:t.map((t=>t.encode)).reduceRight(n,e),decode:t.map((t=>t.decode)).reduce(n,e)}}function j(t){const e="string"==typeof t?t.split(""):t,n=e.length;L("alphabet",e);const r=new Map(e.map(((t,e)=>[t,e])));return{encode:r=>(P(r),r.map((r=>{if(!Number.isSafeInteger(r)||r<0||r>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${r}". Allowed: ${t}`);return e[r]}))),decode:e=>(P(e),e.map((e=>{N("alphabet.decode",e);const n=r.get(e);if(void 0===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n})))}}function F(t=""){return N("join",t),{encode:e=>(L("join.decode",e),e.join(t)),decode:e=>(N("join.decode",e),e.split(t))}}function $(t,e="="){return U(t),N("padding",e),{encode(n){for(L("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){L("padding.decode",n);let r=n.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if((r-1)*t%8==0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}function D(t){return I(t),{encode:t=>t,decode:e=>t(e)}}function z(t,e,n){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(P(t),!t.length)return[];let r=0;const i=[],s=Array.from(t,(t=>{if(U(t),t<0||t>=e)throw new Error(`invalid integer: ${t}`);return t})),o=s.length;for(;;){let t=0,a=!0;for(let i=r;i<o;i++){const o=s[i],c=e*t,u=c+o;if(!Number.isSafeInteger(u)||c/e!==t||u-o!==c)throw new Error("convertRadix: carry overflow");const h=u/n;t=u%n;const l=Math.floor(h);if(s[i]=l,!Number.isSafeInteger(l)||l*n+t!==u)throw new Error("convertRadix: carry overflow");a&&(l?a=!1:r=i)}if(i.push(t),a)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}const q=(t,e)=>0===e?t:q(e,t%e),Z=(t,e)=>t+(e-q(t,e)),H=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function V(t,e,n,r){if(P(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Z(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Z(e,n)}`);let i=0,s=0;const o=H[e],a=H[n]-1,c=[];for(const r of t){if(U(r),r>=o)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(i=i<<e|r,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const t=H[s];if(void 0===t)throw new Error("invalid carry");i&=t-1}if(i=i<<n-s&a,!r&&s>=e)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function K(t,e=!1){if(U(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Z(8,t)>32||Z(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!T(n))throw new Error("radix2.encode input should be Uint8Array");return V(Array.from(n),8,t,!e)},decode:n=>(B("radix2.decode",n),Uint8Array.from(V(n,t,8,e)))}}function W(t){return I(t),function(...e){try{return t.apply(null,e)}catch(t){}}}M(K(4),j("0123456789ABCDEF"),F("")),M(K(5),j("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),$(5),F(""));const G=(M(K(5),j("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),F("")),M(K(5),j("0123456789ABCDEFGHIJKLMNOPQRSTUV"),$(5),F("")),M(K(5),j("0123456789ABCDEFGHIJKLMNOPQRSTUV"),F("")),M(K(5),j("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),F(""),D((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),M(K(6),j("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),$(6),F(""))),J=(M(K(6),j("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),F("")),M(K(6),j("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),$(6),F("")),M(K(6),j("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),F(""))),Y=t=>M(function(t){return U(t),{encode:e=>{if(!T(e))throw new Error("radix.encode input should be Uint8Array");return z(Array.from(e),256,t)},decode:e=>(B("radix.decode",e),Uint8Array.from(z(e,t,256)))}}(58),j(t),F("")),Q=Y("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),X=(Y("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Y("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),t=>{return M((n=e=>t(t(e)),U(e=4),I(n),{encode(t){if(!T(t))throw new Error("checksum.encode: input should be Uint8Array");const r=n(t).slice(0,e),i=new Uint8Array(t.length+e);return i.set(t),i.set(r,t.length),i},decode(t){if(!T(t))throw new Error("checksum.decode: input should be Uint8Array");const r=t.slice(0,-e),i=t.slice(-e),s=n(r).slice(0,e);for(let t=0;t<e;t++)if(s[t]!==i[t])throw new Error("Invalid checksum");return r}}),Q);var e,n}),tt=M(j("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),F("")),et=[996825010,642813549,513874426,1027748829,705979059];function nt(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<et.length;t++)1==(e>>t&1)&&(n^=et[t]);return n}function rt(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=nt(i)^n>>5}i=nt(i);for(let e=0;e<r;e++)i=nt(i)^31&t.charCodeAt(e);for(let t of e)i=nt(i)^t;for(let t=0;t<6;t++)i=nt(i);return i^=n,tt.encode(V([i%H[30]],30,5,!1))}function it(t){const e="bech32"===t?1:734539939,n=K(5),r=n.decode,i=n.encode,s=W(r);function o(t,n,r=90){N("bech32.encode prefix",t),T(n)&&(n=Array.from(n)),B("bech32.encode",n);const i=t.length;if(0===i)throw new TypeError(`Invalid prefix length ${i}`);const s=i+7+n.length;if(!1!==r&&s>r)throw new TypeError(`Length ${s} exceeds limit ${r}`);const o=t.toLowerCase(),a=rt(o,n,e);return`${o}1${tt.encode(n)}${a}`}function a(t,n=90){N("bech32.decode input",t);const r=t.length;if(r<8||!1!==n&&r>n)throw new TypeError(`invalid string length: ${r} (${t}). Expected (8..${n})`);const i=t.toLowerCase();if(t!==i&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=i.lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const o=i.slice(0,s),a=i.slice(s+1);if(a.length<6)throw new Error("Data must be at least 6 characters long");const c=tt.decode(a).slice(0,-6),u=rt(o,c,e);if(!a.endsWith(u))throw new Error(`Invalid checksum in ${t}: expected "${u}"`);return{prefix:o,words:c}}return{encode:o,decode:a,encodeFromBytes:function(t,e){return o(t,i(e))},decodeToBytes:function(t){const{prefix:e,words:n}=a(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:W(a),fromWords:r,fromWordsUnsafe:s,toWords:i}}const st=it("bech32"),ot=it("bech32m"),at=(M(K(4),j("0123456789abcdef"),F(""),D((t=>{if("string"!=typeof t||t.length%2!=0)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}))),t=>X(_).encode(t)),ct={to_words:st.toWords,to_bytes:st.fromWords,encode:(t,e,n=!1)=>st.encode(t,e,n),decode:(t,e=!1)=>{const{prefix:n,words:r}=st.decode(t,e);return{prefix:n,words:r}}},ut={to_words:ot.toWords,to_bytes:ot.fromWords,encode:(t,e,n=!1)=>ot.encode(t,e,n),decode:(t,e=!1)=>{const{prefix:n,words:r}=ot.decode(t,e);return{prefix:n,words:r}}},ht=BigInt(0),lt=BigInt(255),dt=BigInt(256);function ft(t){return null===t.match(/[^a-fA-F0-9]/)&&t.length%2==0}function pt(t){return!("string"!=typeof t||!ft(t))||"number"==typeof t||"bigint"==typeof t||t instanceof Uint8Array||!(!Array.isArray(t)||!t.every((t=>"number"==typeof t)))}function yt(t){let e,n=0;const r=t.reduce(((t,e)=>t+e.length),0),i=new Uint8Array(r);for(e=0;e<t.length;e++){const r=t[e];i.set(r,n),n+=r.length}return i}function gt(t,e){return"bigint"==typeof e?`${e}n`:e}function mt(t,e){return"string"==typeof e&&/^[0-9]+n$/.test(e)?BigInt(e.slice(0,-1)):e}function wt(t,e,n){if(t instanceof ArrayBuffer)return new Uint8Array(t);if(t instanceof Uint8Array)return function(t,e,n="be"){void 0===e&&(e=t.length),function(t,e){if(t.length>e)throw new TypeError(`Data is larger than array size: ${t.length} > ${e}`)}(t,e);const r=new Uint8Array(e).fill(0),i="be"===n?0:e-t.length;return r.set(t,i),r}(t,e,n);if(Array.isArray(t))return yt(t.map((t=>wt(t,e,n))));if("string"==typeof t)return O(t,e,n);if("bigint"==typeof t)return function(t,e,n="be"){void 0===e&&(e=function(t){if(t<=0xffn)return 1;if(t<=0xffffn)return 2;if(t<=0xffffffffn)return 4;if(t<=0xffffffffffffffffn)return 8;if(t<=0xffffffffffffffffffffffffffffffffn)return 16;if(t<=0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffn)return 32;throw new TypeError("Must specify a fixed buffer size for bigints greater than 32 bytes.")}(t));const r="le"===n,i=new ArrayBuffer(e),s=new DataView(i);let o=r?0:e-1;for(;t>ht;){const e=t&lt,n=Number(e);r?s.setUint8(o++,n):s.setUint8(o--,n),t=(t-e)/dt}return new Uint8Array(i)}(t,e,n);if("number"==typeof t)return function(t,e,n="be"){void 0===e&&(e=function(t){if(t<=255)return 1;if(t<=65535)return 2;if(t<=4294967295)return 4;throw new TypeError("Numbers larger than 4 bytes must specify a fixed size!")}(t));const r="le"===n,i=new ArrayBuffer(e),s=new DataView(i);let o=r?0:e-1;for(;t>0;){const e=255&t;r?s.setUint8(o++,t):s.setUint8(o--,t),t=(t-e)/256}return new Uint8Array(i)}(t,e,n);if("boolean"==typeof t)return Uint8Array.of(t?1:0);throw new TypeError("Unsupported format:"+String(typeof t))}class bt extends Uint8Array{static{this.num=vt}static{this.big=Et}static{this.bin=_t}static{this.raw=kt}static{this.str=xt}static{this.hex=At}static{this.bytes=Pt}static{this.json=St}static{this.base64=Ct}static{this.b64url=Ot}static{this.bech32=Tt}static{this.bech32m=Rt}static{this.b58chk=It}static{this.encode=S}static{this.decode=C}static{this.parse=Nt}static{this.is_bytes=pt}static{this.is_hex=ft}static{this.is_equal=Ut}static random(t=32){const e=p(t);return new bt(e,t)}static now(t=4){const e=Math.floor(Date.now()/1e3);return new bt(e,t)}constructor(t,e,n){if(t instanceof bt&&void 0===e)return t;super(wt(t,e,n))}get arr(){return[...this]}get num(){return this.to_num()}get big(){return this.to_big()}get str(){return this.to_str()}get hex(){return this.to_hex()}get raw(){return new Uint8Array(this)}get bin(){return this.to_bin()}get b58chk(){return this.to_b58chk()}get base64(){return this.to_base64()}get b64url(){return this.to_b64url()}get digest(){return this.to_hash()}get id(){return this.to_hash().hex}get stream(){return new Lt(this)}to_num(t="be"){return function(t){let e=0;for(let n=t.length-1;n>=0;n--)e=256*e+t[n],E(e);return e}("be"===t?this.reverse():this)}to_big(t="be"){return function(t){let e=BigInt(0);for(let n=t.length-1;n>=0;n--)e=e*dt+BigInt(t[n]);return BigInt(e)}("be"===t?this.reverse():this)}to_bin(){return function(t){const e=new Array(8*t.length);let n=0;for(const r of t){if(r>255)throw new Error(`Invalid byte value: ${r}. Byte values must be between 0 and 255.`);for(let t=7;t>=0;t--,n++)e[n]=r>>t&1}return e.join("")}(this)}to_hash(){const t=_(this);return new bt(t)}to_json(t){void 0===t&&(t=mt);const e=C(this);return JSON.parse(e,t)}to_bech32(t,e){const{encode:n,to_words:r}=ct;return n(t,r(this),e)}to_bech32m(t,e){const{encode:n,to_words:r}=ut;return n(t,r(this),e)}to_str(){return C(this)}to_hex(){return function(t){let e="";for(let n=0;n<t.length;n++)e+=t[n].toString(16).padStart(2,"0");return e}(this)}to_bytes(){return new Uint8Array(this)}to_b58chk(){return at(this)}to_base64(){return t=this,G.encode(t);var t}to_b64url(){return t=this,J.encode(t);var t}append(t){return bt.join([this,bt.bytes(t)])}equals(t){return Pt(t).hex===this.hex}prepend(t){return bt.join([bt.bytes(t),this])}reverse(){const t=new Uint8Array(this).reverse();return new bt(t)}slice(t,e){const n=new Uint8Array(this).slice(t,e);return new bt(n)}set(t,e){this.set(t,e)}subarray(t,e){const n=new Uint8Array(this).subarray(t,e);return new bt(n)}write(t,e){const n=bt.bytes(t);this.set(n,e)}add_varint(t){const e=bt.calc_varint(this.length,t);return bt.join([e,this])}toJSON(){return this.hex}toString(){return this.hex}static from(t){return new bt(Uint8Array.from(t))}static of(...t){return new bt(Uint8Array.of(...t))}static join(t){const e=yt(t.map((t=>bt.bytes(t))));return new bt(e)}static sort(t,e){const n=t.map((t=>Pt(t,e).hex));return n.sort(),n.map((t=>bt.hex(t,e)))}static calc_varint(t,e){if(t<253)return bt.num(t,1);if(t<65536)return bt.of(253,...bt.num(t,2,e));if(t<4294967296)return bt.of(254,...bt.num(t,4,e));if(BigInt(t)<0x10000000000000000n)return bt.of(255,...bt.num(t,8,e));throw new Error(`Value is too large: ${t}`)}}function vt(t,e,n){return new bt(t,e,n)}function _t(t,e,n){return new bt(function(t){const e=t.split("").map(Number);if(e.length%8!=0)throw new Error(`Binary array is invalid length: ${t.length}`);const n=new Uint8Array(e.length/8);for(let t=0,r=0;t<e.length;t+=8,r++){let i=0;for(let n=0;n<8;n++)i|=e[t+n]<<7-n;n[r]=i}return n}(t),e,n)}function Et(t,e,n){return new bt(t,e,n)}function kt(t,e,n){return new bt(t,e,n)}function xt(t,e,n){return new bt(S(t),e,n)}function At(t,e,n){return new bt(t,e,n)}function St(t,e){void 0===e&&(e=gt);const n=JSON.stringify(t,e);return new bt(S(n))}function Ct(t){return new bt((t=>G.decode(t))(t))}function Ot(t){return new bt((t=>J.decode(t))(t))}function Tt(t,e,n){const{decode:r,to_bytes:i}=ct,{prefix:s,words:o}=r(t,e),a=i(o);return"string"==typeof n&&k(s,n),new bt(a)}function Rt(t,e,n){const{decode:r,to_bytes:i}=ut,{prefix:s,words:o}=r(t,e),a=i(o);return"string"==typeof n&&k(s,n),new bt(a)}function It(t){return new bt((t=>X(_).decode(t))(t))}function Nt(t,e,n){const r=function(t,e,n){const r=t.length,i=n/e;if(n%e!=0)throw new TypeError(`Invalid parameters: ${n} % ${e} !== 0`);if(r!==n)throw new TypeError(`Invalid data stream: ${r} !== ${n}`);if(r%e!=0)throw new TypeError(`Invalid data stream: ${r} % ${e} !== 0`);const s=new Array(i);for(let n=0;n<i;n++){const r=n*e;s[n]=t.subarray(r,r+e)}return s}(wt(t),e,n);return r.map((t=>bt.bytes(t)))}function Ut(t,e){return new bt(t).hex===new bt(e).hex}function Pt(t,e,n){return new bt(t,e,n)}class Lt{constructor(t){this.data=bt.bytes(t),this.size=this.data.length}peek(t){if(t>this.size)throw new Error(`Size greater than stream: ${t} > ${this.size}`);return new bt(this.data.slice(0,t))}read(t){const e=this.peek(t);return this.data=this.data.slice(t),this.size=this.data.length,e}read_varint(t){const e=this.read(1).num;switch(!0){case e>=0&&e<253:return e;case 253===e:return this.read(2).to_num(t);case 254===e:return this.read(4).to_num(t);case 255===e:return this.read(8).to_num(t);default:throw new Error(`Varint is out of range: ${e}`)}}}class Bt extends d{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");n(t.outputLen),n(t.blockLen)}(t);const r=l(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return i(this),this.iHash.update(t),this}digestInto(t){i(this),r(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=r,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Mt=(t,e,n)=>new Bt(t,e).update(n).digest();Mt.create=(t,e)=>new Bt(t,e);const jt=BigInt(0),Ft=BigInt(1),$t=BigInt(2);function Dt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function zt(t){if(!Dt(t))throw new Error("Uint8Array expected")}function qt(t,e){if("boolean"!=typeof e)throw new Error(t+" boolean expected, got "+e)}const Zt=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Ht(t){zt(t);let e="";for(let n=0;n<t.length;n++)e+=Zt[t[n]];return e}function Vt(t){const e=t.toString(16);return 1&e.length?"0"+e:e}function Kt(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return""===t?jt:BigInt("0x"+t)}const Wt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Gt(t){return t>=Wt._0&&t<=Wt._9?t-Wt._0:t>=Wt.A&&t<=Wt.F?t-(Wt.A-10):t>=Wt.a&&t<=Wt.f?t-(Wt.a-10):void 0}function Jt(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,i=0;e<n;e++,i+=2){const n=Gt(t.charCodeAt(i)),s=Gt(t.charCodeAt(i+1));if(void 0===n||void 0===s){const e=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+i)}r[e]=16*n+s}return r}function Yt(t){return Kt(Ht(t))}function Qt(t){return zt(t),Kt(Ht(Uint8Array.from(t).reverse()))}function Xt(t,e){return Jt(t.toString(16).padStart(2*e,"0"))}function te(t,e){return Xt(t,e).reverse()}function ee(t,e,n){let r;if("string"==typeof e)try{r=Jt(e)}catch(e){throw new Error(t+" must be hex string or Uint8Array, cause: "+e)}else{if(!Dt(e))throw new Error(t+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function ne(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];zt(r),e+=r.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}const re=t=>"bigint"==typeof t&&jt<=t;function ie(t,e,n){return re(t)&&re(e)&&re(n)&&e<=t&&t<n}function se(t,e,n,r){if(!ie(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function oe(t){let e;for(e=0;t>jt;t>>=Ft,e+=1);return e}const ae=t=>($t<<BigInt(t-1))-Ft,ce=t=>new Uint8Array(t),ue=t=>Uint8Array.from(t);function he(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=ce(t),i=ce(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...t)=>n(i,r,...t),c=(t=ce())=>{i=a(ue([0]),t),r=a(),0!==t.length&&(i=a(ue([1]),t),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return ne(...n)};return(t,e)=>{let n;for(o(),c(t);!(n=e(u()));)c();return o(),n}}const le={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||Dt(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function de(t,e,n={}){const r=(e,n,r)=>{const i=le[n];if("function"!=typeof i)throw new Error("invalid validator function");const s=t[e];if(!(r&&void 0===s||i(s,t)))throw new Error("param "+String(e)+" is invalid. Expected "+n+", got "+s)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}function fe(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(void 0!==i)return i;const s=t(n,...r);return e.set(n,s),s}}const pe=BigInt(0),ye=BigInt(1),ge=BigInt(2),me=BigInt(3),we=BigInt(4),be=BigInt(5),ve=BigInt(8);function _e(t,e){const n=t%e;return n>=pe?n:e+n}function Ee(t,e,n){if(e<pe)throw new Error("invalid exponent, negatives unsupported");if(n<=pe)throw new Error("invalid modulus");if(n===ye)return pe;let r=ye;for(;e>pe;)e&ye&&(r=r*t%n),t=t*t%n,e>>=ye;return r}function ke(t,e,n){let r=t;for(;e-- >pe;)r*=r,r%=n;return r}function xe(t,e){if(t===pe)throw new Error("invert: expected non-zero number");if(e<=pe)throw new Error("invert: expected positive modulus, got "+e);let n=_e(t,e),r=e,i=pe,s=ye,o=ye,a=pe;for(;n!==pe;){const t=r/n,e=r%n,c=i-o*t,u=s-a*t;r=n,n=e,i=o,s=a,o=c,a=u}if(r!==ye)throw new Error("invert: does not exist");return _e(i,e)}const Ae=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Se(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Ce(t,e,n=!1,r={}){if(t<=pe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Se(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:ae(i),ZERO:pe,ONE:ye,create:e=>_e(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("invalid field element: expected bigint, got "+typeof e);return pe<=e&&e<t},is0:t=>t===pe,isOdd:t=>(t&ye)===ye,neg:e=>_e(-e,t),eql:(t,e)=>t===e,sqr:e=>_e(e*e,t),add:(e,n)=>_e(e+n,t),sub:(e,n)=>_e(e-n,t),mul:(e,n)=>_e(e*n,t),pow:(t,e)=>function(t,e,n){if(n<pe)throw new Error("invalid exponent, negatives unsupported");if(n===pe)return t.ONE;if(n===ye)return e;let r=t.ONE,i=e;for(;n>pe;)n&ye&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ye;return r}(a,t,e),div:(e,n)=>_e(e*xe(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>xe(e,t),sqrt:r.sqrt||(e=>(o||(o=function(t){if(t%we===me){const e=(t+ye)/we;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%ve===be){const e=(t-be)/ve;return function(t,n){const r=t.mul(n,ge),i=t.pow(r,e),s=t.mul(n,i),o=t.mul(t.mul(s,ge),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-ye)/ge;let n,r,i;for(n=t-ye,r=0;n%ge===pe;n/=ge,r++);for(i=ge;i<t&&Ee(i,e,t)!==t-ye;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const e=(t+ye)/we;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+ye)/ge;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,i),n),u=t.pow(o,s),h=t.pow(o,n);for(;!t.eql(h,t.ONE);){if(t.eql(h,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(h);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,ye<<BigInt(a-e-1));c=t.sqr(n),u=t.mul(u,n),h=t.mul(h,c),a=e}return u}}(t)}(t)),o(a,e))),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,i)=>t.is0(r)?e:(n[i]=e,t.mul(e,r))),t.ONE),i=t.inv(r);return e.reduceRight(((e,r,i)=>t.is0(r)?e:(n[i]=t.mul(e,n[i]),t.mul(e,r))),i),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?te(t,s):Xt(t,s),fromBytes:t=>{if(t.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+t.length);return n?Qt(t):Yt(t)}});return Object.freeze(a)}function Oe(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Te(t){const e=Oe(t);return e+Math.ceil(e/2)}const Re=BigInt(0),Ie=BigInt(1);function Ne(t,e){const n=e.negate();return t?n:e}function Ue(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Pe(t,e){return Ue(t,e),{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)}}const Le=new WeakMap,Be=new WeakMap;function Me(t){return Be.get(t)||1}function je(t){return de(t.Fp,Ae.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),de(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Se(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Fe(t){void 0!==t.lowS&&qt("lowS",t.lowS),void 0!==t.prehash&&qt("prehash",t.prehash)}const{Ph:$e,aT:De}=t;class ze extends Error{constructor(t=""){super(t)}}const qe={Err:ze,_tlv:{encode:(t,e)=>{const{Err:n}=qe;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(1&e.length)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=Vt(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Vt(i.length/2|128):"";return Vt(t)+s+i+e},decode(t,e){const{Err:n}=qe;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++];let s=0;if(128&i){const t=127&i;if(!t)throw new n("tlv.decode(long): indefinite length not supported");if(t>4)throw new n("tlv.decode(long): byte length is too big");const o=e.subarray(r,r+t);if(o.length!==t)throw new n("tlv.decode: length bytes not complete");if(0===o[0])throw new n("tlv.decode(long): zero leftmost byte");for(const t of o)s=s<<8|t;if(r+=t,s<128)throw new n("tlv.decode(long): not minimal encoding")}else s=i;const o=e.subarray(r,r+s);if(o.length!==s)throw new n("tlv.decode: wrong value length");return{v:o,l:e.subarray(r+s)}}},_int:{encode(t){const{Err:e}=qe;if(t<Ze)throw new e("integer: negative integers are not allowed");let n=Vt(t);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=qe;if(128&t[0])throw new e("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("invalid signature integer: unnecessary leading zero");return $e(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=qe,i="string"==typeof t?De(t):t;zt(i);const{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l:h}=r.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=qe,r=e.encode(2,n.encode(t.r))+e.encode(2,n.encode(t.s));return e.encode(48,r)}},Ze=BigInt(0),He=BigInt(1),Ve=(BigInt(2),BigInt(3));function Ke(t){const e=function(t){const e=je(t);de(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=Ce(e.n,e.nBitLength),i=e.toBytes||((t,e,r)=>{const i=e.toAffine();return ne(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function o(t){const{a:r,b:i}=e,s=n.sqr(t),o=n.mul(s,t);return n.add(n.add(o,n.mul(t,r)),i)}if(!n.eql(n.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=e;if(n&&"bigint"!=typeof t){if(Dt(t)&&(t=Ht(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("invalid private key");t=t.padStart(2*r,"0")}let o;try{o="bigint"==typeof t?t:Yt(ee("private key",t,r))}catch(e){throw new Error("invalid private key, expected hex or "+r+" bytes, got "+typeof t)}return i&&(o=_e(o,s)),se("private key",o,He,s),o}function c(t){if(!(t instanceof l))throw new Error("ProjectivePoint expected")}const u=fe(((t,e)=>{const{px:r,py:i,pz:s}=t;if(n.eql(s,n.ONE))return{x:r,y:i};const o=t.is0();null==e&&(e=o?n.ONE:n.inv(s));const a=n.mul(r,e),c=n.mul(i,e),u=n.mul(s,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(u,n.ONE))throw new Error("invZ was invalid");return{x:a,y:c}})),h=fe((t=>{if(t.is0()){if(e.allowInfinityPoint&&!n.is0(t.py))return;throw new Error("bad point: ZERO")}const{x:r,y:i}=t.toAffine();if(!n.isValid(r)||!n.isValid(i))throw new Error("bad point: x or y not FE");const s=n.sqr(i),a=o(r);if(!n.eql(s,a))throw new Error("bad point: equation left != right");if(!t.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class l{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required");Object.freeze(this)}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof l)throw new Error("projective point not allowed");const i=t=>n.eql(t,n.ZERO);return i(e)&&i(r)?l.ZERO:new l(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(l.fromAffine)}static fromHex(t){const e=l.fromAffine(s(ee("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return l.BASE.multiply(a(t))}static msm(t,e){return function(t,e,n,r){if(function(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach(((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)}))}(n,t),function(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach(((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)}))}(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=oe(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i);let u=i;for(let t=Math.floor((e.BITS-1)/o)*o;t>=0;t-=o){c.fill(i);for(let e=0;e<r.length;e++){const i=r[e],s=Number(i>>BigInt(t)&BigInt(a));c[s]=c[s].add(n[e])}let e=i;for(let t=c.length-1,n=i;t>0;t--)n=n.add(c[t]),e=e.add(n);if(u=u.add(e),0!==t)for(let t=0;t<o;t++)u=u.double()}return u}(l,r,t,e)}_setWindowSize(t){f.setWindowSize(this,t)}assertValidity(){h(this)}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){c(t);const{px:e,py:r,pz:i}=this,{px:s,py:o,pz:a}=t,u=n.eql(n.mul(e,a),n.mul(s,i)),h=n.eql(n.mul(r,a),n.mul(o,i));return u&&h}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,i=n.mul(r,Ve),{px:s,py:o,pz:a}=this;let c=n.ZERO,u=n.ZERO,h=n.ZERO,d=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),y=n.mul(s,o);return y=n.add(y,y),h=n.mul(s,a),h=n.add(h,h),c=n.mul(t,h),u=n.mul(i,p),u=n.add(c,u),c=n.sub(f,u),u=n.add(f,u),u=n.mul(c,u),c=n.mul(y,c),h=n.mul(i,h),p=n.mul(t,p),y=n.sub(d,p),y=n.mul(t,y),y=n.add(y,h),h=n.add(d,d),d=n.add(h,d),d=n.add(d,p),d=n.mul(d,y),u=n.add(u,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,y),c=n.sub(c,d),h=n.mul(p,f),h=n.add(h,h),h=n.add(h,h),new l(c,u,h)}add(t){c(t);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:u}=t;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,y=n.mul(e.b,Ve);let g=n.mul(r,o),m=n.mul(i,a),w=n.mul(s,u),b=n.add(r,i),v=n.add(o,a);b=n.mul(b,v),v=n.add(g,m),b=n.sub(b,v),v=n.add(r,s);let _=n.add(o,u);return v=n.mul(v,_),_=n.add(g,w),v=n.sub(v,_),_=n.add(i,s),h=n.add(a,u),_=n.mul(_,h),h=n.add(m,w),_=n.sub(_,h),f=n.mul(p,v),h=n.mul(y,w),f=n.add(h,f),h=n.sub(m,f),f=n.add(m,f),d=n.mul(h,f),m=n.add(g,g),m=n.add(m,g),w=n.mul(p,w),v=n.mul(y,v),m=n.add(m,w),w=n.sub(g,w),w=n.mul(p,w),v=n.add(v,w),g=n.mul(m,v),d=n.add(d,g),g=n.mul(_,v),h=n.mul(b,h),h=n.sub(h,g),g=n.mul(b,m),f=n.mul(_,f),f=n.add(f,g),new l(h,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(l.ZERO)}wNAF(t){return f.wNAFCached(this,t,l.normalizeZ)}multiplyUnsafe(t){const{endo:r,n:i}=e;se("scalar",t,Ze,i);const s=l.ZERO;if(t===Ze)return s;if(this.is0()||t===He)return this;if(!r||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,t,l.normalizeZ);let{k1neg:o,k1:a,k2neg:c,k2:u}=r.splitScalar(t),h=s,d=s,p=this;for(;a>Ze||u>Ze;)a&He&&(h=h.add(p)),u&He&&(d=d.add(p)),p=p.double(),a>>=He,u>>=He;return o&&(h=h.negate()),c&&(d=d.negate()),d=new l(n.mul(d.px,r.beta),d.py,d.pz),h.add(d)}multiply(t){const{endo:r,n:i}=e;let s,o;if(se("scalar",t,He,i),r){const{k1neg:e,k1:i,k2neg:a,k2:c}=r.splitScalar(t);let{p:u,f:h}=this.wNAF(i),{p:d,f:p}=this.wNAF(c);u=f.constTimeNegate(e,u),d=f.constTimeNegate(a,d),d=new l(n.mul(d.px,r.beta),d.py,d.pz),s=u.add(d),o=h.add(p)}else{const{p:e,f:n}=this.wNAF(t);s=e,o=n}return l.normalizeZ([s,o])[0]}multiplyAndAddUnsafe(t,e,n){const r=l.BASE,i=(t,e)=>e!==Ze&&e!==He&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),s=i(this,e).add(i(t,n));return s.is0()?void 0:s}toAffine(t){return u(this,t)}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===He)return!0;if(n)return n(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===He?this:n?n(l,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return qt("isCompressed",t),this.assertValidity(),i(l,this,t)}toHex(t=!0){return qt("isCompressed",t),Ht(this.toRawBytes(t))}}l.BASE=new l(e.Gx,e.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=(p=l,y=e.endo?Math.ceil(d/2):d,{constTimeNegate:Ne,hasPrecomputes:t=>1!==Me(t),unsafeLadder(t,e,n=p.ZERO){let r=t;for(;e>Re;)e&Ie&&(n=n.add(r)),r=r.double(),e>>=Ie;return n},precomputeWindow(t,e){const{windows:n,windowSize:r}=Pe(e,y),i=[];let s=t,o=s;for(let t=0;t<n;t++){o=s,i.push(o);for(let t=1;t<r;t++)o=o.add(s),i.push(o);s=o.double()}return i},wNAF(t,e,n){const{windows:r,windowSize:i}=Pe(t,y);let s=p.ZERO,o=p.BASE;const a=BigInt(2**t-1),c=2**t,u=BigInt(t);for(let t=0;t<r;t++){const r=t*i;let h=Number(n&a);n>>=u,h>i&&(h-=c,n+=Ie);const l=r,d=r+Math.abs(h)-1,f=t%2!=0,p=h<0;0===h?o=o.add(Ne(f,e[l])):s=s.add(Ne(p,e[d]))}return{p:s,f:o}},wNAFUnsafe(t,e,n,r=p.ZERO){const{windows:i,windowSize:s}=Pe(t,y),o=BigInt(2**t-1),a=2**t,c=BigInt(t);for(let t=0;t<i;t++){const i=t*s;if(n===Re)break;let u=Number(n&o);if(n>>=c,u>s&&(u-=a,n+=Ie),0===u)continue;let h=e[i+Math.abs(u)-1];u<0&&(h=h.negate()),r=r.add(h)}return r},getPrecomputes(t,e,n){let r=Le.get(e);return r||(r=this.precomputeWindow(e,t),1!==t&&Le.set(e,n(r))),r},wNAFCached(t,e,n){const r=Me(t);return this.wNAF(r,this.getPrecomputes(r,t,n),e)},wNAFCachedUnsafe(t,e,n,r){const i=Me(t);return 1===i?this.unsafeLadder(t,e,r):this.wNAFUnsafe(i,this.getPrecomputes(i,t,n),e,r)},setWindowSize(t,e){Ue(e,y),Be.set(t,e),Le.delete(t)}});var p,y;return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder:function(t){return ie(t,He,e.n)}}}function We(t){const e=function(t){const e=je(t);return de(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(t){return _e(t,r)}function a(t){return xe(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:l}=Ke({...e,toBytes(t,e,r){const i=e.toAffine(),s=n.toBytes(i.x),o=ne;return qt("isCompressed",r),r?o(Uint8Array.from([e.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(t){const e=t.length,r=t[0],o=t.subarray(1);if(e!==i||2!==r&&3!==r){if(e===s&&4===r)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};throw new Error("invalid Point, expected length of "+i+", or uncompressed "+s+", got "+e)}{const t=Yt(o);if(!ie(t,He,n.ORDER))throw new Error("Point is not on curve");const e=h(t);let i;try{i=n.sqrt(e)}catch(t){const e=t instanceof Error?": "+t.message:"";throw new Error("Point is not on curve"+e)}return!(1&~r)!=((i&He)===He)&&(i=n.neg(i)),{x:t,y:i}}}}),d=t=>Ht(Xt(t,e.nByteLength));function f(t){return t>r>>He}const p=(t,e,n)=>Yt(t.slice(e,n));class y{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=ee("compactSignature",t,2*n),new y(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=qe.toSig(ee("DER",t));return new y(e,n)}assertValidity(){se("r",this.r,He,r),se("s",this.s,He,r)}addRecoveryBit(t){return new y(this.r,this.s,t)}recoverPublicKey(t){const{r,s:i,recovery:s}=this,u=b(ee("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const h=2===s||3===s?r+e.n:r;if(h>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const l=1&s?"03":"02",f=c.fromHex(l+d(h)),p=a(h),y=o(-u*p),g=o(i*p),m=c.BASE.multiplyAndAddUnsafe(f,y,g);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Jt(this.toDERHex())}toDERHex(){return qe.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Jt(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const g={isValidPrivateKey(t){try{return u(t),!0}catch(t){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const t=Te(e.n);return function(t,e,n=!1){const r=t.length,i=Oe(e),s=Te(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=_e(n?Qt(t):Yt(t),e-ye)+ye;return n?te(o,i):Xt(o,i)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function m(t){const e=Dt(t),n="string"==typeof t,r=(e||n)&&t.length;return e?r===i||r===s:n?r===2*i||r===2*s:t instanceof c}const w=e.bits2int||function(t){if(t.length>8192)throw new Error("input is too large");const n=Yt(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},b=e.bits2int_modN||function(t){return o(w(t))},v=ae(e.nBitLength);function _(t){return se("num < 2^"+e.nBitLength,t,Ze,v),Xt(t,e.nByteLength)}const E={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(m(t))throw new Error("first arg must be private key");if(!m(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(u(t)).toRawBytes(n)},sign:function(t,r,i=E){const{seed:s,k2sig:h}=function(t,r,i=E){if(["recovered","canonical"].some((t=>t in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:h}=e;let{lowS:d,prehash:p,extraEntropy:g}=i;null==d&&(d=!0),t=ee("msgHash",t),Fe(i),p&&(t=ee("prehashed msgHash",s(t)));const m=b(t),v=u(r),k=[_(v),_(m)];if(null!=g&&!1!==g){const t=!0===g?h(n.BYTES):g;k.push(ee("extraEntropy",t))}const x=ne(...k),A=m;return{seed:x,k2sig:function(t){const e=w(t);if(!l(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),i=o(r.x);if(i===Ze)return;const s=o(n*o(A+i*v));if(s===Ze)return;let u=(r.x===i?0:2)|Number(r.y&He),h=s;return d&&f(s)&&(h=function(t){return f(t)?o(-t):t}(s),u^=1),new y(i,h,u)}}}(t,r,i),d=e;return he(d.hash.outputLen,d.nByteLength,d.hmac)(s,h)},verify:function(t,n,r,i=k){const s=t;n=ee("msgHash",n),r=ee("publicKey",r);const{lowS:u,prehash:h,format:l}=i;if(Fe(i),"strict"in i)throw new Error("options.strict was renamed to lowS");if(void 0!==l&&"compact"!==l&&"der"!==l)throw new Error("format must be compact or der");const d="string"==typeof s||Dt(s),f=!d&&!l&&"object"==typeof s&&null!==s&&"bigint"==typeof s.r&&"bigint"==typeof s.s;if(!d&&!f)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,g;try{if(f&&(p=new y(s.r,s.s)),d){try{"compact"!==l&&(p=y.fromDER(s))}catch(t){if(!(t instanceof qe.Err))throw t}p||"der"===l||(p=y.fromCompact(s))}g=c.fromHex(r)}catch(t){return!1}if(!p)return!1;if(u&&p.hasHighS())return!1;h&&(n=e.hash(n));const{r:m,s:w}=p,v=b(n),_=a(w),E=o(v*_),x=o(m*_),A=c.BASE.multiplyAndAddUnsafe(g,E,x)?.toAffine();return!!A&&o(A.x)===m},ProjectivePoint:c,Signature:y,utils:g}}function Ge(t){return{hash:t,hmac:(e,...n)=>Mt(t,e,function(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];r(i),e+=i.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}(...n)),randomBytes:p}}BigInt(4);const Je=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ye=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qe=BigInt(1),Xe=BigInt(2),tn=(t,e)=>(t+e/Xe)/e;function en(t){const e=Je,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,h=u*u*t%e,l=ke(h,n,e)*h%e,d=ke(l,n,e)*h%e,f=ke(d,Xe,e)*u%e,p=ke(f,i,e)*f%e,y=ke(p,s,e)*p%e,g=ke(y,a,e)*y%e,m=ke(g,c,e)*g%e,w=ke(m,a,e)*y%e,b=ke(w,n,e)*h%e,v=ke(b,o,e)*p%e,_=ke(v,r,e)*u%e,E=ke(_,Xe,e);if(!nn.eql(nn.sqr(E),t))throw new Error("Cannot find square root");return E}const nn=Ce(Je,void 0,void 0,{sqrt:en}),rn=function(t,e){const n=e=>We({...t,...Ge(e)});return{...n(e),create:n}}({a:BigInt(0),b:BigInt(7),Fp:nn,n:Ye,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Ye,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Qe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=tn(s*t,e),c=tn(-r*t,e);let u=_e(t-a*n-c*i,e),h=_e(-a*r-c*s,e);const l=u>o,d=h>o;if(l&&(u=e-u),d&&(h=e-h),u>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:d,k2:h}}}},_),sn=BigInt(0),on={};function an(t,...e){let n=on[t];if(void 0===n){const e=_(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=ne(e,e),on[t]=n}return _(ne(n,...e))}const cn=t=>t.toRawBytes(!0).slice(1),un=t=>Xt(t,32),hn=t=>_e(t,Je),ln=t=>_e(t,Ye),dn=rn.ProjectivePoint;function fn(t){let e=rn.utils.normPrivateKeyToScalar(t),n=dn.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:ln(-e),bytes:cn(n)}}function pn(t){se("x",t,Qe,Je);const e=hn(t*t);let n=en(hn(e*t+BigInt(7)));n%Xe!==sn&&(n=hn(-n));const r=new dn(t,n,Qe);return r.assertValidity(),r}const yn=Yt;function gn(...t){return ln(yn(an("BIP0340/challenge",...t)))}function mn(t){return fn(t).bytes}function wn(t,e,n=p(32)){const r=ee("message",t),{bytes:i,scalar:s}=fn(e),o=ee("auxRand",n,32),a=un(s^yn(an("BIP0340/aux",o))),c=an("BIP0340/nonce",a,i,r),u=ln(yn(c));if(u===sn)throw new Error("sign failed: k is zero");const{bytes:h,scalar:l}=fn(u),d=gn(h,i,r),f=new Uint8Array(64);if(f.set(h,0),f.set(un(ln(l+d*s)),32),!bn(f,r,i))throw new Error("sign: Invalid signature produced");return f}function bn(t,e,n){const r=ee("signature",t,64),i=ee("message",e),s=ee("publicKey",n,32);try{const t=pn(yn(s)),e=yn(r.subarray(0,32));if(!ie(e,Qe,Je))return!1;const n=yn(r.subarray(32,64));if(!ie(n,Qe,Ye))return!1;const u=gn(un(e),cn(t),i),h=(o=t,a=n,c=ln(-u),dn.BASE.multiplyAndAddUnsafe(o,a,c));return!(!h||!h.hasEvenY()||h.toAffine().x!==e)}catch(t){return!1}var o,a,c}const vn=(()=>({getPublicKey:mn,sign:wn,verify:bn,utils:{randomPrivateKey:rn.utils.randomPrivateKey,lift_x:pn,pointToBytes:cn,numberToBytesBE:Xt,bytesToNumberBE:Yt,taggedHash:an,mod:_e}}))();function _n(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function En(t,...e){if(!_n(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function kn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function xn(t,e){En(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const An=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Sn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function Cn(t){if("string"==typeof t)t=function(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!_n(t))throw new Error("Uint8Array expected, got "+typeof t);t=In(t)}return t}const On=(t,e)=>{function n(n,...r){if(En(n),void 0!==t.nonceLength){const e=r[0];if(!e)throw new Error("nonce / iv required");t.varSizeNonce?En(e):En(e,t.nonceLength)}const i=t.tagLength;i&&void 0!==r[1]&&En(r[1]);const s=e(n,...r),o=(t,e)=>{if(void 0!==e){if(2!==t)throw new Error("cipher output not supported");En(e)}};let a=!1;const c={encrypt(t,e){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,En(t),o(s.encrypt.length,e),s.encrypt(t,e)},decrypt(t,e){if(En(t),i&&t.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return o(s.decrypt.length,e),s.decrypt(t,e)}};return c}return Object.assign(n,t),n};function Tn(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function Rn(t){return t.byteOffset%4==0}function In(t){return Uint8Array.from(t)}function Nn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const Un=16,Pn=new Uint8Array(16),Ln=An(Pn),Bn=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class Mn{constructor(t,e){this.blockLen=Un,this.outputLen=Un,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,En(t=Cn(t),16);const n=Sn(t);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),s=n.getUint32(8,!1),o=n.getUint32(12,!1);const a=[];for(let t=0;t<128;t++)a.push({s0:Bn(r),s1:Bn(i),s2:Bn(s),s3:Bn(o)}),({s0:r,s1:i,s2:s,s3:o}={s3:(h=s)<<31|(l=o)>>>1,s2:(u=i)<<31|h>>>1,s1:(c=r)<<31|u>>>1,s0:c>>>1^225<<24&-(1&l)});var c,u,h,l;const d=(f=e||1024)>65536?8:f>1024?4:2;var f;if(![1,2,4,8].includes(d))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=d;const p=128/d,y=this.windowSize=2**d,g=[];for(let t=0;t<p;t++)for(let e=0;e<y;e++){let n=0,r=0,i=0,s=0;for(let o=0;o<d;o++){if(!(e>>>d-o-1&1))continue;const{s0:c,s1:u,s2:h,s3:l}=a[d*t+o];n^=c,r^=u,i^=h,s^=l}g.push({s0:n,s1:r,s2:i,s3:s})}this.t=g}_updateBlock(t,e,n,r){t^=this.s0,e^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:s,windowSize:o}=this;let a=0,c=0,u=0,h=0;const l=(1<<i)-1;let d=0;for(const f of[t,e,n,r])for(let t=0;t<4;t++){const e=f>>>8*t&255;for(let t=8/i-1;t>=0;t--){const n=e>>>i*t&l,{s0:r,s1:f,s2:p,s3:y}=s[d*o+n];a^=r,c^=f,u^=p,h^=y,d+=1}}this.s0=a,this.s1=c,this.s2=u,this.s3=h}update(t){t=Cn(t),kn(this);const e=An(t),n=Math.floor(t.length/Un),r=t.length%Un;for(let t=0;t<n;t++)this._updateBlock(e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]);return r&&(Pn.set(t.subarray(n*Un)),this._updateBlock(Ln[0],Ln[1],Ln[2],Ln[3]),Nn(Ln)),this}destroy(){const{t}=this;for(const e of t)e.s0=0,e.s1=0,e.s2=0,e.s3=0}digestInto(t){kn(this),xn(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:i}=this,s=An(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,t}digest(){const t=new Uint8Array(Un);return this.digestInto(t),this.destroy(),t}}class jn extends Mn{constructor(t,e){const n=function(t){t.reverse();const e=1&t[15];let n=0;for(let e=0;e<t.length;e++){const r=t[e];t[e]=r>>>1|n,n=(1&r)<<7}return t[0]^=225&-e,t}(In(t=Cn(t)));super(n,e),Nn(n)}update(t){t=Cn(t),kn(this);const e=An(t),n=t.length%Un,r=Math.floor(t.length/Un);for(let t=0;t<r;t++)this._updateBlock(Bn(e[4*t+3]),Bn(e[4*t+2]),Bn(e[4*t+1]),Bn(e[4*t+0]));return n&&(Pn.set(t.subarray(r*Un)),this._updateBlock(Bn(Ln[3]),Bn(Ln[2]),Bn(Ln[1]),Bn(Ln[0])),Nn(Ln)),this}digestInto(t){kn(this),xn(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:i}=this,s=An(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,t.reverse()}}function Fn(t){const e=(e,n)=>t(n,e.length).update(Cn(e)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(e,n)=>t(e,n),e}const $n=Fn(((t,e)=>new Mn(t,e))),Dn=(Fn(((t,e)=>new jn(t,e))),16),zn=new Uint8Array(Dn);function qn(t){return t<<1^283&-(t>>7)}function Zn(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=qn(t);return n}const Hn=(()=>{const t=new Uint8Array(256);for(let e=0,n=1;e<256;e++,n^=qn(n))t[e]=n;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return Nn(t),e})(),Vn=t=>t<<8|t>>>24;function Kn(t,e){if(256!==t.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>e(t[r]))),r=n.map(Vn),i=r.map(Vn),s=i.map(Vn),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let e=0;e<256;e++)for(let u=0;u<256;u++){const h=256*e+u;o[h]=n[e]^r[u],a[h]=i[e]^s[u],c[h]=t[e]<<8|t[u]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const Wn=Kn(Hn,(t=>Zn(t,3)<<24|t<<16|t<<8|Zn(t,2))),Gn=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=qn(n))t[e]=n;return t})();function Jn(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Yn(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function Qn(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=Wn;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],i^=t[c++];const u=t.length/4-2;for(let s=0;s<u;s++){const s=t[c++]^Jn(o,a,e,n,r,i),u=t[c++]^Jn(o,a,n,r,i,e),h=t[c++]^Jn(o,a,r,i,e,n),l=t[c++]^Jn(o,a,i,e,n,r);e=s,n=u,r=h,i=l}return{s0:t[c++]^Yn(s,e,n,r,i),s1:t[c++]^Yn(s,n,r,i,e),s2:t[c++]^Yn(s,r,i,e,n),s3:t[c++]^Yn(s,i,e,n,r)}}function Xn(t,e,n,r,i){En(n,Dn),En(r),i=function(t,e,n=!0){if(void 0===e)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!Rn(e))throw new Error("invalid output, must be aligned");return e}(r.length,i);const s=n,o=An(s),a=Sn(s),c=An(r),u=An(i),h=e?0:12,l=r.length;let d=a.getUint32(h,e),{s0:f,s1:p,s2:y,s3:g}=Qn(t,o[0],o[1],o[2],o[3]);for(let n=0;n+4<=c.length;n+=4)u[n+0]=c[n+0]^f,u[n+1]=c[n+1]^p,u[n+2]=c[n+2]^y,u[n+3]=c[n+3]^g,d=d+1>>>0,a.setUint32(h,d,e),({s0:f,s1:p,s2:y,s3:g}=Qn(t,o[0],o[1],o[2],o[3]));const m=Dn*Math.floor(c.length/4);if(m<l){const t=new Uint32Array([f,p,y,g]),e=(w=t,new Uint8Array(w.buffer,w.byteOffset,w.byteLength));for(let t=m,n=0;t<l;t++,n++)i[t]=r[t]^e[n];Nn(t)}var w;return i}const tr=On({blockSize:16,nonceLength:12,tagLength:16,varSizeNonce:!0},(function(t,e,n){if(e.length<8)throw new Error("aes/gcm: invalid nonce length");function r(t,e,r){const i=function(t,e,n,r,i){const s=null==i?0:i.length,o=t.create(n,r.length+s);i&&o.update(i),o.update(r);const a=new Uint8Array(16),c=Sn(a);i&&Tn(c,0,BigInt(8*s),e),Tn(c,8,BigInt(8*r.length),e),o.update(a);const u=o.digest();return Nn(a),u}($n,!1,t,r,n);for(let t=0;t<e.length;t++)i[t]^=e[t];return i}function i(){const n=function(t){En(t);const e=t.length;if(![16,24,32].includes(e))throw new Error("aes: invalid key size, should be 16, 24 or 32, got "+e);const{sbox2:n}=Wn,r=[];Rn(t)||r.push(t=In(t));const i=An(t),s=i.length,o=t=>Yn(n,t,t,t,t),a=new Uint32Array(e+28);a.set(i);for(let t=s;t<a.length;t++){let e=a[t-1];t%s==0?e=o((c=e)<<24|c>>>8)^Gn[t/s-1]:s>6&&t%s==4&&(e=o(e)),a[t]=a[t-s]^e}var c;return Nn(...r),a}(t),r=zn.slice(),i=zn.slice();if(Xn(n,!1,i,i,r),12===e.length)i.set(e);else{const t=zn.slice();Tn(Sn(t),8,BigInt(8*e.length),!1);const n=$n.create(r).update(e).update(t);n.digestInto(i),n.destroy()}return{xk:n,authKey:r,counter:i,tagMask:Xn(n,!1,i,zn)}}return{encrypt(t){const{xk:e,authKey:n,counter:s,tagMask:o}=i(),a=new Uint8Array(t.length+16),c=[e,n,s,o];Rn(t)||c.push(t=In(t)),Xn(e,!1,s,t,a.subarray(0,t.length));const u=r(n,o,a.subarray(0,a.length-16));return c.push(u),a.set(u,t.length),Nn(...c),a},decrypt(t){const{xk:e,authKey:n,counter:s,tagMask:o}=i(),a=[e,n,o,s];Rn(t)||a.push(t=In(t));const c=t.subarray(0,-16),u=t.subarray(-16),h=r(n,o,c);if(a.push(h),!function(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}(h,u))throw new Error("aes/gcm: invalid ghash tag");const l=Xn(e,!1,s,c);return Nn(...a),l}}}));function er(t){const e=vn.getPublicKey(t);return new bt(e).hex}function nr(t,e){const n=rn.getSharedSecret(t,"02"+e,!0);return new bt(n).slice(1).hex}const rr=()=>Math.floor(Date.now()/1e3);var ir;function sr(){return bt.random(16).hex}function or(t){return t instanceof Error?t.message:"string"==typeof t?t:String(t)}function ar(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return bt.str(e).digest.hex}function cr(t,e){const n=function(t){return t.tags.filter((t=>"p"===t.at(0)))}(t);return n.some((t=>t[1]===e))}!function(t){t.ok=function(t,e){if(!1===t)throw new Error(e??"assertion failed")},t.exists=function(t,e){if(null==t)throw new Error(e??"value is null or undefined")}}(ir||(ir={}));const ur={EVENT_CONFIG:()=>({created_at:rr(),kind:20004,tags:[]}),NODE_CONFIG:()=>({kinds:[20004],peer_pks:[],now_offset:5,req_timeout:5e3,start_delay:2e3}),SUB_CONFIG:()=>({peers:[],strict:!0,timeout:5e3}),REQ_TIMEOUT:5e3};var hr,lr;!function(t){t.assertEqual=t=>t,t.assertIs=function(t){},t.assertNever=function(t){throw new Error},t.arrayToEnum=t=>{const e={};for(const n of t)e[n]=n;return e},t.getValidEnumValues=e=>{const n=t.objectKeys(e).filter((t=>"number"!=typeof e[e[t]])),r={};for(const t of n)r[t]=e[t];return t.objectValues(r)},t.objectValues=e=>t.objectKeys(e).map((function(t){return e[t]})),t.objectKeys="function"==typeof Object.keys?t=>Object.keys(t):t=>{const e=[];for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},t.find=(t,e)=>{for(const n of t)if(e(n))return n},t.isInteger="function"==typeof Number.isInteger?t=>Number.isInteger(t):t=>"number"==typeof t&&isFinite(t)&&Math.floor(t)===t,t.joinValues=function(t,e=" | "){return t.map((t=>"string"==typeof t?`'${t}'`:t)).join(e)},t.jsonStringifyReplacer=(t,e)=>"bigint"==typeof e?e.toString():e}(hr||(hr={})),function(t){t.mergeShapes=(t,e)=>({...t,...e})}(lr||(lr={}));const dr=hr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),fr=t=>{switch(typeof t){case"undefined":return dr.undefined;case"string":return dr.string;case"number":return isNaN(t)?dr.nan:dr.number;case"boolean":return dr.boolean;case"function":return dr.function;case"bigint":return dr.bigint;case"symbol":return dr.symbol;case"object":return Array.isArray(t)?dr.array:null===t?dr.null:t.then&&"function"==typeof t.then&&t.catch&&"function"==typeof t.catch?dr.promise:"undefined"!=typeof Map&&t instanceof Map?dr.map:"undefined"!=typeof Set&&t instanceof Set?dr.set:"undefined"!=typeof Date&&t instanceof Date?dr.date:dr.object;default:return dr.unknown}},pr=hr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class yr extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=(t=[])=>{this.issues=[...this.issues,...t]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}format(t){const e=t||function(t){return t.message},n={_errors:[]},r=t=>{for(const i of t.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(e(i));else{let t=n,r=0;for(;r<i.path.length;){const n=i.path[r];r===i.path.length-1?(t[n]=t[n]||{_errors:[]},t[n]._errors.push(e(i))):t[n]=t[n]||{_errors:[]},t=t[n],r++}}};return r(this),n}static assert(t){if(!(t instanceof yr))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,hr.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(t=t=>t.message){const e={},n=[];for(const r of this.issues)r.path.length>0?(e[r.path[0]]=e[r.path[0]]||[],e[r.path[0]].push(t(r))):n.push(t(r));return{formErrors:n,fieldErrors:e}}get formErrors(){return this.flatten()}}yr.create=t=>new yr(t);const gr=(t,e)=>{let n;switch(t.code){case pr.invalid_type:n=t.received===dr.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case pr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,hr.jsonStringifyReplacer)}`;break;case pr.unrecognized_keys:n=`Unrecognized key(s) in object: ${hr.joinValues(t.keys,", ")}`;break;case pr.invalid_union:n="Invalid input";break;case pr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${hr.joinValues(t.options)}`;break;case pr.invalid_enum_value:n=`Invalid enum value. Expected ${hr.joinValues(t.options)}, received '${t.received}'`;break;case pr.invalid_arguments:n="Invalid function arguments";break;case pr.invalid_return_type:n="Invalid function return type";break;case pr.invalid_date:n="Invalid date";break;case pr.invalid_string:"object"==typeof t.validation?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,"number"==typeof t.validation.position&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:hr.assertNever(t.validation):n="regex"!==t.validation?`Invalid ${t.validation}`:"Invalid";break;case pr.too_small:n="array"===t.type?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:"string"===t.type?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:"number"===t.type?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:"date"===t.type?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case pr.too_big:n="array"===t.type?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:"string"===t.type?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:"number"===t.type?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:"bigint"===t.type?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:"date"===t.type?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case pr.custom:n="Invalid input";break;case pr.invalid_intersection_types:n="Intersection results could not be merged";break;case pr.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case pr.not_finite:n="Number must be finite";break;default:n=e.defaultError,hr.assertNever(t)}return{message:n}};let mr=gr;function wr(){return mr}const br=t=>{const{data:e,path:n,errorMaps:r,issueData:i}=t,s=[...n,...i.path||[]],o={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let a="";const c=r.filter((t=>!!t)).slice().reverse();for(const t of c)a=t(o,{data:e,defaultError:a}).message;return{...i,path:s,message:a}};function vr(t,e){const n=wr(),r=br({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===gr?void 0:gr].filter((t=>!!t))});t.common.issues.push(r)}class _r{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(t,e){const n=[];for(const r of e){if("aborted"===r.status)return Er;"dirty"===r.status&&t.dirty(),n.push(r.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,e){const n=[];for(const t of e){const e=await t.key,r=await t.value;n.push({key:e,value:r})}return _r.mergeObjectSync(t,n)}static mergeObjectSync(t,e){const n={};for(const r of e){const{key:e,value:i}=r;if("aborted"===e.status)return Er;if("aborted"===i.status)return Er;"dirty"===e.status&&t.dirty(),"dirty"===i.status&&t.dirty(),"__proto__"===e.value||void 0===i.value&&!r.alwaysSet||(n[e.value]=i.value)}return{status:t.value,value:n}}}const Er=Object.freeze({status:"aborted"}),kr=t=>({status:"dirty",value:t}),xr=t=>({status:"valid",value:t}),Ar=t=>"aborted"===t.status,Sr=t=>"dirty"===t.status,Cr=t=>"valid"===t.status,Or=t=>"undefined"!=typeof Promise&&t instanceof Promise;function Tr(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}function Rr(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n}var Ir,Nr,Ur;"function"==typeof SuppressedError&&SuppressedError,function(t){t.errToObj=t=>"string"==typeof t?{message:t}:t||{},t.toString=t=>"string"==typeof t?t:null==t?void 0:t.message}(Ir||(Ir={}));class Pr{constructor(t,e,n,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Lr=(t,e)=>{if(Cr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new yr(t.common.issues);return this._error=e,this._error}}};function Br(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return e?{errorMap:e,description:i}:{errorMap:(e,i)=>{var s,o;const{message:a}=t;return"invalid_enum_value"===e.code?{message:null!=a?a:i.defaultError}:void 0===i.data?{message:null!==(s=null!=a?a:r)&&void 0!==s?s:i.defaultError}:"invalid_type"!==e.code?{message:i.defaultError}:{message:null!==(o=null!=a?a:n)&&void 0!==o?o:i.defaultError}},description:i}}class Mr{get description(){return this._def.description}_getType(t){return fr(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:fr(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new _r,ctx:{common:t.parent.common,data:t.data,parsedType:fr(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(Or(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const n=this.safeParse(t,e);if(n.success)return n.data;throw n.error}safeParse(t,e){var n;const r={common:{issues:[],async:null!==(n=null==e?void 0:e.async)&&void 0!==n&&n,contextualErrorMap:null==e?void 0:e.errorMap},path:(null==e?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:fr(t)},i=this._parseSync({data:t,path:r.path,parent:r});return Lr(r,i)}"~validate"(t){var e,n;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:fr(t)};if(!this["~standard"].async)try{const e=this._parseSync({data:t,path:[],parent:r});return Cr(e)?{value:e.value}:{issues:r.common.issues}}catch(t){(null===(n=null===(e=null==t?void 0:t.message)||void 0===e?void 0:e.toLowerCase())||void 0===n?void 0:n.includes("encountered"))&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then((t=>Cr(t)?{value:t.value}:{issues:r.common.issues}))}async parseAsync(t,e){const n=await this.safeParseAsync(t,e);if(n.success)return n.data;throw n.error}async safeParseAsync(t,e){const n={common:{issues:[],contextualErrorMap:null==e?void 0:e.errorMap,async:!0},path:(null==e?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:fr(t)},r=this._parse({data:t,path:n.path,parent:n}),i=await(Or(r)?r:Promise.resolve(r));return Lr(n,i)}refine(t,e){const n=t=>"string"==typeof e||void 0===e?{message:e}:"function"==typeof e?e(t):e;return this._refinement(((e,r)=>{const i=t(e),s=()=>r.addIssue({code:pr.custom,...n(e)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then((t=>!!t||(s(),!1))):!!i||(s(),!1)}))}refinement(t,e){return this._refinement(((n,r)=>!!t(n)||(r.addIssue("function"==typeof e?e(n,r):e),!1)))}_refinement(t){return new Mi({schema:this,typeName:Gi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ji.create(this,this._def)}nullable(){return Fi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wi.create(this)}promise(){return Bi.create(this,this._def)}or(t){return _i.create([this,t],this._def)}and(t){return Ai.create(this,t,this._def)}transform(t){return new Mi({...Br(this._def),schema:this,typeName:Gi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e="function"==typeof t?t:()=>t;return new $i({...Br(this._def),innerType:this,defaultValue:e,typeName:Gi.ZodDefault})}brand(){return new Zi({typeName:Gi.ZodBranded,type:this,...Br(this._def)})}catch(t){const e="function"==typeof t?t:()=>t;return new Di({...Br(this._def),innerType:this,catchValue:e,typeName:Gi.ZodCatch})}describe(t){return new(0,this.constructor)({...this._def,description:t})}pipe(t){return Hi.create(this,t)}readonly(){return Vi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const jr=/^c[^\s-]{8,}$/i,Fr=/^[0-9a-z]+$/,$r=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Dr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,zr=/^[a-z0-9_-]{21}$/i,qr=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Zr=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Hr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Vr;const Kr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Wr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Gr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Jr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Yr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Qr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Xr="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ti=new RegExp(`^${Xr}$`);function ei(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:null==t.precision&&(e=`${e}(\\.\\d+)?`),e}function ni(t){let e=`${Xr}T${ei(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function ri(t,e){if(!qr.test(t))return!1;try{const[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!("object"!=typeof i||null===i||!i.typ||!i.alg||e&&i.alg!==e)}catch(t){return!1}}function ii(t,e){return!("v4"!==e&&e||!Wr.test(t))||!("v6"!==e&&e||!Jr.test(t))}class si extends Mr{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==dr.string){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.string,received:e.parsedType}),Er}const e=new _r;let n;for(const s of this._def.checks)if("min"===s.kind)t.data.length<s.value&&(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),e.dirty());else if("max"===s.kind)t.data.length>s.value&&(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),e.dirty());else if("length"===s.kind){const r=t.data.length>s.value,i=t.data.length<s.value;(r||i)&&(n=this._getOrReturnCtx(t,n),r?vr(n,{code:pr.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&vr(n,{code:pr.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),e.dirty())}else if("email"===s.kind)Hr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"email",code:pr.invalid_string,message:s.message}),e.dirty());else if("emoji"===s.kind)Vr||(Vr=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Vr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"emoji",code:pr.invalid_string,message:s.message}),e.dirty());else if("uuid"===s.kind)Dr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"uuid",code:pr.invalid_string,message:s.message}),e.dirty());else if("nanoid"===s.kind)zr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"nanoid",code:pr.invalid_string,message:s.message}),e.dirty());else if("cuid"===s.kind)jr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"cuid",code:pr.invalid_string,message:s.message}),e.dirty());else if("cuid2"===s.kind)Fr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"cuid2",code:pr.invalid_string,message:s.message}),e.dirty());else if("ulid"===s.kind)$r.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"ulid",code:pr.invalid_string,message:s.message}),e.dirty());else if("url"===s.kind)try{new URL(t.data)}catch(r){n=this._getOrReturnCtx(t,n),vr(n,{validation:"url",code:pr.invalid_string,message:s.message}),e.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"regex",code:pr.invalid_string,message:s.message}),e.dirty())):"trim"===s.kind?t.data=t.data.trim():"includes"===s.kind?t.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),e.dirty()):"toLowerCase"===s.kind?t.data=t.data.toLowerCase():"toUpperCase"===s.kind?t.data=t.data.toUpperCase():"startsWith"===s.kind?t.data.startsWith(s.value)||(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.invalid_string,validation:{startsWith:s.value},message:s.message}),e.dirty()):"endsWith"===s.kind?t.data.endsWith(s.value)||(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.invalid_string,validation:{endsWith:s.value},message:s.message}),e.dirty()):"datetime"===s.kind?ni(s).test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.invalid_string,validation:"datetime",message:s.message}),e.dirty()):"date"===s.kind?ti.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.invalid_string,validation:"date",message:s.message}),e.dirty()):"time"===s.kind?new RegExp(`^${ei(s)}$`).test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.invalid_string,validation:"time",message:s.message}),e.dirty()):"duration"===s.kind?Zr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"duration",code:pr.invalid_string,message:s.message}),e.dirty()):"ip"===s.kind?(r=t.data,("v4"!==(i=s.version)&&i||!Kr.test(r))&&("v6"!==i&&i||!Gr.test(r))&&(n=this._getOrReturnCtx(t,n),vr(n,{validation:"ip",code:pr.invalid_string,message:s.message}),e.dirty())):"jwt"===s.kind?ri(t.data,s.alg)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"jwt",code:pr.invalid_string,message:s.message}),e.dirty()):"cidr"===s.kind?ii(t.data,s.version)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"cidr",code:pr.invalid_string,message:s.message}),e.dirty()):"base64"===s.kind?Yr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"base64",code:pr.invalid_string,message:s.message}),e.dirty()):"base64url"===s.kind?Qr.test(t.data)||(n=this._getOrReturnCtx(t,n),vr(n,{validation:"base64url",code:pr.invalid_string,message:s.message}),e.dirty()):hr.assertNever(s);var r,i;return{status:e.value,value:t.data}}_regex(t,e,n){return this.refinement((e=>t.test(e)),{validation:e,code:pr.invalid_string,...Ir.errToObj(n)})}_addCheck(t){return new si({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Ir.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Ir.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Ir.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Ir.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Ir.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Ir.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Ir.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Ir.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Ir.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Ir.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Ir.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Ir.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Ir.errToObj(t)})}datetime(t){var e,n;return"string"==typeof t?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:void 0===(null==t?void 0:t.precision)?null:null==t?void 0:t.precision,offset:null!==(e=null==t?void 0:t.offset)&&void 0!==e&&e,local:null!==(n=null==t?void 0:t.local)&&void 0!==n&&n,...Ir.errToObj(null==t?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return"string"==typeof t?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:void 0===(null==t?void 0:t.precision)?null:null==t?void 0:t.precision,...Ir.errToObj(null==t?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Ir.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,...Ir.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:null==e?void 0:e.position,...Ir.errToObj(null==e?void 0:e.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,...Ir.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,...Ir.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,...Ir.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,...Ir.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,...Ir.errToObj(e)})}nonempty(t){return this.min(1,Ir.errToObj(t))}trim(){return new si({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new si({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new si({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((t=>"datetime"===t.kind))}get isDate(){return!!this._def.checks.find((t=>"date"===t.kind))}get isTime(){return!!this._def.checks.find((t=>"time"===t.kind))}get isDuration(){return!!this._def.checks.find((t=>"duration"===t.kind))}get isEmail(){return!!this._def.checks.find((t=>"email"===t.kind))}get isURL(){return!!this._def.checks.find((t=>"url"===t.kind))}get isEmoji(){return!!this._def.checks.find((t=>"emoji"===t.kind))}get isUUID(){return!!this._def.checks.find((t=>"uuid"===t.kind))}get isNANOID(){return!!this._def.checks.find((t=>"nanoid"===t.kind))}get isCUID(){return!!this._def.checks.find((t=>"cuid"===t.kind))}get isCUID2(){return!!this._def.checks.find((t=>"cuid2"===t.kind))}get isULID(){return!!this._def.checks.find((t=>"ulid"===t.kind))}get isIP(){return!!this._def.checks.find((t=>"ip"===t.kind))}get isCIDR(){return!!this._def.checks.find((t=>"cidr"===t.kind))}get isBase64(){return!!this._def.checks.find((t=>"base64"===t.kind))}get isBase64url(){return!!this._def.checks.find((t=>"base64url"===t.kind))}get minLength(){let t=null;for(const e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return t}}function oi(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r;return parseInt(t.toFixed(i).replace(".",""))%parseInt(e.toFixed(i).replace(".",""))/Math.pow(10,i)}si.create=t=>{var e;return new si({checks:[],typeName:Gi.ZodString,coerce:null!==(e=null==t?void 0:t.coerce)&&void 0!==e&&e,...Br(t)})};class ai extends Mr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==dr.number){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.number,received:e.parsedType}),Er}let e;const n=new _r;for(const r of this._def.checks)"int"===r.kind?hr.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?t.data<r.value:t.data<=r.value)&&(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?t.data>r.value:t.data>=r.value)&&(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==oi(t.data,r.value)&&(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.not_finite,message:r.message}),n.dirty()):hr.assertNever(r);return{status:n.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,Ir.toString(e))}gt(t,e){return this.setLimit("min",t,!1,Ir.toString(e))}lte(t,e){return this.setLimit("max",t,!0,Ir.toString(e))}lt(t,e){return this.setLimit("max",t,!1,Ir.toString(e))}setLimit(t,e,n,r){return new ai({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:n,message:Ir.toString(r)}]})}_addCheck(t){return new ai({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Ir.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ir.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ir.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ir.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ir.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:Ir.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:Ir.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ir.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ir.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find((t=>"int"===t.kind||"multipleOf"===t.kind&&hr.isInteger(t.value)))}get isFinite(){let t=null,e=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===e||n.value>e)&&(e=n.value):"max"===n.kind&&(null===t||n.value<t)&&(t=n.value)}return Number.isFinite(e)&&Number.isFinite(t)}}ai.create=t=>new ai({checks:[],typeName:Gi.ZodNumber,coerce:(null==t?void 0:t.coerce)||!1,...Br(t)});class ci extends Mr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch(e){return this._getInvalidInput(t)}if(this._getType(t)!==dr.bigint)return this._getInvalidInput(t);let e;const n=new _r;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?t.data<r.value:t.data<=r.value)&&(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?t.data>r.value:t.data>=r.value)&&(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?t.data%r.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),vr(e,{code:pr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):hr.assertNever(r);return{status:n.value,value:t.data}}_getInvalidInput(t){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.bigint,received:e.parsedType}),Er}gte(t,e){return this.setLimit("min",t,!0,Ir.toString(e))}gt(t,e){return this.setLimit("min",t,!1,Ir.toString(e))}lte(t,e){return this.setLimit("max",t,!0,Ir.toString(e))}lt(t,e){return this.setLimit("max",t,!1,Ir.toString(e))}setLimit(t,e,n,r){return new ci({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:n,message:Ir.toString(r)}]})}_addCheck(t){return new ci({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ir.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ir.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ir.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ir.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:Ir.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return t}}ci.create=t=>{var e;return new ci({checks:[],typeName:Gi.ZodBigInt,coerce:null!==(e=null==t?void 0:t.coerce)&&void 0!==e&&e,...Br(t)})};class ui extends Mr{_parse(t){if(this._def.coerce&&(t.data=Boolean(t.data)),this._getType(t)!==dr.boolean){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.boolean,received:e.parsedType}),Er}return xr(t.data)}}ui.create=t=>new ui({typeName:Gi.ZodBoolean,coerce:(null==t?void 0:t.coerce)||!1,...Br(t)});class hi extends Mr{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==dr.date){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.date,received:e.parsedType}),Er}if(isNaN(t.data.getTime()))return vr(this._getOrReturnCtx(t),{code:pr.invalid_date}),Er;const e=new _r;let n;for(const r of this._def.checks)"min"===r.kind?t.data.getTime()<r.value&&(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),e.dirty()):"max"===r.kind?t.data.getTime()>r.value&&(n=this._getOrReturnCtx(t,n),vr(n,{code:pr.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),e.dirty()):hr.assertNever(r);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new hi({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:Ir.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:Ir.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return null!=t?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return null!=t?new Date(t):null}}hi.create=t=>new hi({checks:[],coerce:(null==t?void 0:t.coerce)||!1,typeName:Gi.ZodDate,...Br(t)});class li extends Mr{_parse(t){if(this._getType(t)!==dr.symbol){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.symbol,received:e.parsedType}),Er}return xr(t.data)}}li.create=t=>new li({typeName:Gi.ZodSymbol,...Br(t)});class di extends Mr{_parse(t){if(this._getType(t)!==dr.undefined){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.undefined,received:e.parsedType}),Er}return xr(t.data)}}di.create=t=>new di({typeName:Gi.ZodUndefined,...Br(t)});class fi extends Mr{_parse(t){if(this._getType(t)!==dr.null){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.null,received:e.parsedType}),Er}return xr(t.data)}}fi.create=t=>new fi({typeName:Gi.ZodNull,...Br(t)});class pi extends Mr{constructor(){super(...arguments),this._any=!0}_parse(t){return xr(t.data)}}pi.create=t=>new pi({typeName:Gi.ZodAny,...Br(t)});class yi extends Mr{constructor(){super(...arguments),this._unknown=!0}_parse(t){return xr(t.data)}}yi.create=t=>new yi({typeName:Gi.ZodUnknown,...Br(t)});class gi extends Mr{_parse(t){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.never,received:e.parsedType}),Er}}gi.create=t=>new gi({typeName:Gi.ZodNever,...Br(t)});class mi extends Mr{_parse(t){if(this._getType(t)!==dr.undefined){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.void,received:e.parsedType}),Er}return xr(t.data)}}mi.create=t=>new mi({typeName:Gi.ZodVoid,...Br(t)});class wi extends Mr{_parse(t){const{ctx:e,status:n}=this._processInputParams(t),r=this._def;if(e.parsedType!==dr.array)return vr(e,{code:pr.invalid_type,expected:dr.array,received:e.parsedType}),Er;if(null!==r.exactLength){const t=e.data.length>r.exactLength.value,i=e.data.length<r.exactLength.value;(t||i)&&(vr(e,{code:t?pr.too_big:pr.too_small,minimum:i?r.exactLength.value:void 0,maximum:t?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&e.data.length<r.minLength.value&&(vr(e,{code:pr.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&e.data.length>r.maxLength.value&&(vr(e,{code:pr.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),e.common.async)return Promise.all([...e.data].map(((t,n)=>r.type._parseAsync(new Pr(e,t,e.path,n))))).then((t=>_r.mergeArray(n,t)));const i=[...e.data].map(((t,n)=>r.type._parseSync(new Pr(e,t,e.path,n))));return _r.mergeArray(n,i)}get element(){return this._def.type}min(t,e){return new wi({...this._def,minLength:{value:t,message:Ir.toString(e)}})}max(t,e){return new wi({...this._def,maxLength:{value:t,message:Ir.toString(e)}})}length(t,e){return new wi({...this._def,exactLength:{value:t,message:Ir.toString(e)}})}nonempty(t){return this.min(1,t)}}function bi(t){if(t instanceof vi){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=ji.create(bi(r))}return new vi({...t._def,shape:()=>e})}return t instanceof wi?new wi({...t._def,type:bi(t.element)}):t instanceof ji?ji.create(bi(t.unwrap())):t instanceof Fi?Fi.create(bi(t.unwrap())):t instanceof Si?Si.create(t.items.map((t=>bi(t)))):t}wi.create=(t,e)=>new wi({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Gi.ZodArray,...Br(e)});class vi extends Mr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const t=this._def.shape(),e=hr.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==dr.object){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.object,received:e.parsedType}),Er}const{status:e,ctx:n}=this._processInputParams(t),{shape:r,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof gi&&"strip"===this._def.unknownKeys))for(const t in n.data)i.includes(t)||s.push(t);const o=[];for(const t of i){const e=r[t],i=n.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new Pr(n,i,n.path,t)),alwaysSet:t in n.data})}if(this._def.catchall instanceof gi){const t=this._def.unknownKeys;if("passthrough"===t)for(const t of s)o.push({key:{status:"valid",value:t},value:{status:"valid",value:n.data[t]}});else if("strict"===t)s.length>0&&(vr(n,{code:pr.unrecognized_keys,keys:s}),e.dirty());else if("strip"!==t)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const t=this._def.catchall;for(const e of s){const r=n.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new Pr(n,r,n.path,e)),alwaysSet:e in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const t=[];for(const e of o){const n=await e.key,r=await e.value;t.push({key:n,value:r,alwaysSet:e.alwaysSet})}return t})).then((t=>_r.mergeObjectSync(e,t))):_r.mergeObjectSync(e,o)}get shape(){return this._def.shape()}strict(t){return Ir.errToObj,new vi({...this._def,unknownKeys:"strict",...void 0!==t?{errorMap:(e,n)=>{var r,i,s,o;const a=null!==(s=null===(i=(r=this._def).errorMap)||void 0===i?void 0:i.call(r,e,n).message)&&void 0!==s?s:n.defaultError;return"unrecognized_keys"===e.code?{message:null!==(o=Ir.errToObj(t).message)&&void 0!==o?o:a}:{message:a}}}:{}})}strip(){return new vi({...this._def,unknownKeys:"strip"})}passthrough(){return new vi({...this._def,unknownKeys:"passthrough"})}extend(t){return new vi({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new vi({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Gi.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new vi({...this._def,catchall:t})}pick(t){const e={};return hr.objectKeys(t).forEach((n=>{t[n]&&this.shape[n]&&(e[n]=this.shape[n])})),new vi({...this._def,shape:()=>e})}omit(t){const e={};return hr.objectKeys(this.shape).forEach((n=>{t[n]||(e[n]=this.shape[n])})),new vi({...this._def,shape:()=>e})}deepPartial(){return bi(this)}partial(t){const e={};return hr.objectKeys(this.shape).forEach((n=>{const r=this.shape[n];t&&!t[n]?e[n]=r:e[n]=r.optional()})),new vi({...this._def,shape:()=>e})}required(t){const e={};return hr.objectKeys(this.shape).forEach((n=>{if(t&&!t[n])e[n]=this.shape[n];else{let t=this.shape[n];for(;t instanceof ji;)t=t._def.innerType;e[n]=t}})),new vi({...this._def,shape:()=>e})}keyof(){return Ui(hr.objectKeys(this.shape))}}vi.create=(t,e)=>new vi({shape:()=>t,unknownKeys:"strip",catchall:gi.create(),typeName:Gi.ZodObject,...Br(e)}),vi.strictCreate=(t,e)=>new vi({shape:()=>t,unknownKeys:"strict",catchall:gi.create(),typeName:Gi.ZodObject,...Br(e)}),vi.lazycreate=(t,e)=>new vi({shape:t,unknownKeys:"strip",catchall:gi.create(),typeName:Gi.ZodObject,...Br(e)});class _i extends Mr{_parse(t){const{ctx:e}=this._processInputParams(t),n=this._def.options;if(e.common.async)return Promise.all(n.map((async t=>{const n={...e,common:{...e.common,issues:[]},parent:null};return{result:await t._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}}))).then((function(t){for(const e of t)if("valid"===e.result.status)return e.result;for(const n of t)if("dirty"===n.result.status)return e.common.issues.push(...n.ctx.common.issues),n.result;const n=t.map((t=>new yr(t.ctx.common.issues)));return vr(e,{code:pr.invalid_union,unionErrors:n}),Er}));{let t;const r=[];for(const i of n){const n={...e,common:{...e.common,issues:[]},parent:null},s=i._parseSync({data:e.data,path:e.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||t||(t={result:s,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(t)return e.common.issues.push(...t.ctx.common.issues),t.result;const i=r.map((t=>new yr(t)));return vr(e,{code:pr.invalid_union,unionErrors:i}),Er}}get options(){return this._def.options}}_i.create=(t,e)=>new _i({options:t,typeName:Gi.ZodUnion,...Br(e)});const Ei=t=>t instanceof Ii?Ei(t.schema):t instanceof Mi?Ei(t.innerType()):t instanceof Ni?[t.value]:t instanceof Pi?t.options:t instanceof Li?hr.objectValues(t.enum):t instanceof $i?Ei(t._def.innerType):t instanceof di?[void 0]:t instanceof fi?[null]:t instanceof ji?[void 0,...Ei(t.unwrap())]:t instanceof Fi?[null,...Ei(t.unwrap())]:t instanceof Zi||t instanceof Vi?Ei(t.unwrap()):t instanceof Di?Ei(t._def.innerType):[];class ki extends Mr{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==dr.object)return vr(e,{code:pr.invalid_type,expected:dr.object,received:e.parsedType}),Er;const n=this.discriminator,r=e.data[n],i=this.optionsMap.get(r);return i?e.common.async?i._parseAsync({data:e.data,path:e.path,parent:e}):i._parseSync({data:e.data,path:e.path,parent:e}):(vr(e,{code:pr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Er)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,n){const r=new Map;for(const n of e){const e=Ei(n.shape[t]);if(!e.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const i of e){if(r.has(i))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(i)}`);r.set(i,n)}}return new ki({typeName:Gi.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:r,...Br(n)})}}function xi(t,e){const n=fr(t),r=fr(e);if(t===e)return{valid:!0,data:t};if(n===dr.object&&r===dr.object){const n=hr.objectKeys(e),r=hr.objectKeys(t).filter((t=>-1!==n.indexOf(t))),i={...t,...e};for(const n of r){const r=xi(t[n],e[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}if(n===dr.array&&r===dr.array){if(t.length!==e.length)return{valid:!1};const n=[];for(let r=0;r<t.length;r++){const i=xi(t[r],e[r]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===dr.date&&r===dr.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Ai extends Mr{_parse(t){const{status:e,ctx:n}=this._processInputParams(t),r=(t,r)=>{if(Ar(t)||Ar(r))return Er;const i=xi(t.value,r.value);return i.valid?((Sr(t)||Sr(r))&&e.dirty(),{status:e.value,value:i.data}):(vr(n,{code:pr.invalid_intersection_types}),Er)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([t,e])=>r(t,e))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Ai.create=(t,e,n)=>new Ai({left:t,right:e,typeName:Gi.ZodIntersection,...Br(n)});class Si extends Mr{_parse(t){const{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==dr.array)return vr(n,{code:pr.invalid_type,expected:dr.array,received:n.parsedType}),Er;if(n.data.length<this._def.items.length)return vr(n,{code:pr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Er;!this._def.rest&&n.data.length>this._def.items.length&&(vr(n,{code:pr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const r=[...n.data].map(((t,e)=>{const r=this._def.items[e]||this._def.rest;return r?r._parse(new Pr(n,t,n.path,e)):null})).filter((t=>!!t));return n.common.async?Promise.all(r).then((t=>_r.mergeArray(e,t))):_r.mergeArray(e,r)}get items(){return this._def.items}rest(t){return new Si({...this._def,rest:t})}}Si.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Si({items:t,typeName:Gi.ZodTuple,rest:null,...Br(e)})};class Ci extends Mr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==dr.object)return vr(n,{code:pr.invalid_type,expected:dr.object,received:n.parsedType}),Er;const r=[],i=this._def.keyType,s=this._def.valueType;for(const t in n.data)r.push({key:i._parse(new Pr(n,t,n.path,t)),value:s._parse(new Pr(n,n.data[t],n.path,t)),alwaysSet:t in n.data});return n.common.async?_r.mergeObjectAsync(e,r):_r.mergeObjectSync(e,r)}get element(){return this._def.valueType}static create(t,e,n){return new Ci(e instanceof Mr?{keyType:t,valueType:e,typeName:Gi.ZodRecord,...Br(n)}:{keyType:si.create(),valueType:t,typeName:Gi.ZodRecord,...Br(e)})}}class Oi extends Mr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==dr.map)return vr(n,{code:pr.invalid_type,expected:dr.map,received:n.parsedType}),Er;const r=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map((([t,e],s)=>({key:r._parse(new Pr(n,t,n.path,[s,"key"])),value:i._parse(new Pr(n,e,n.path,[s,"value"]))})));if(n.common.async){const t=new Map;return Promise.resolve().then((async()=>{for(const n of s){const r=await n.key,i=await n.value;if("aborted"===r.status||"aborted"===i.status)return Er;"dirty"!==r.status&&"dirty"!==i.status||e.dirty(),t.set(r.value,i.value)}return{status:e.value,value:t}}))}{const t=new Map;for(const n of s){const r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return Er;"dirty"!==r.status&&"dirty"!==i.status||e.dirty(),t.set(r.value,i.value)}return{status:e.value,value:t}}}}Oi.create=(t,e,n)=>new Oi({valueType:e,keyType:t,typeName:Gi.ZodMap,...Br(n)});class Ti extends Mr{_parse(t){const{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==dr.set)return vr(n,{code:pr.invalid_type,expected:dr.set,received:n.parsedType}),Er;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(vr(n,{code:pr.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),e.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(vr(n,{code:pr.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),e.dirty());const i=this._def.valueType;function s(t){const n=new Set;for(const r of t){if("aborted"===r.status)return Er;"dirty"===r.status&&e.dirty(),n.add(r.value)}return{status:e.value,value:n}}const o=[...n.data.values()].map(((t,e)=>i._parse(new Pr(n,t,n.path,e))));return n.common.async?Promise.all(o).then((t=>s(t))):s(o)}min(t,e){return new Ti({...this._def,minSize:{value:t,message:Ir.toString(e)}})}max(t,e){return new Ti({...this._def,maxSize:{value:t,message:Ir.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}Ti.create=(t,e)=>new Ti({valueType:t,minSize:null,maxSize:null,typeName:Gi.ZodSet,...Br(e)});class Ri extends Mr{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==dr.function)return vr(e,{code:pr.invalid_type,expected:dr.function,received:e.parsedType}),Er;function n(t,n){return br({data:t,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,wr(),gr].filter((t=>!!t)),issueData:{code:pr.invalid_arguments,argumentsError:n}})}function r(t,n){return br({data:t,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,wr(),gr].filter((t=>!!t)),issueData:{code:pr.invalid_return_type,returnTypeError:n}})}const i={errorMap:e.common.contextualErrorMap},s=e.data;if(this._def.returns instanceof Bi){const t=this;return xr((async function(...e){const o=new yr([]),a=await t._def.args.parseAsync(e,i).catch((t=>{throw o.addIssue(n(e,t)),o})),c=await Reflect.apply(s,this,a);return await t._def.returns._def.type.parseAsync(c,i).catch((t=>{throw o.addIssue(r(c,t)),o}))}))}{const t=this;return xr((function(...e){const o=t._def.args.safeParse(e,i);if(!o.success)throw new yr([n(e,o.error)]);const a=Reflect.apply(s,this,o.data),c=t._def.returns.safeParse(a,i);if(!c.success)throw new yr([r(a,c.error)]);return c.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new Ri({...this._def,args:Si.create(t).rest(yi.create())})}returns(t){return new Ri({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,n){return new Ri({args:t||Si.create([]).rest(yi.create()),returns:e||yi.create(),typeName:Gi.ZodFunction,...Br(n)})}}class Ii extends Mr{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}Ii.create=(t,e)=>new Ii({getter:t,typeName:Gi.ZodLazy,...Br(e)});class Ni extends Mr{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return vr(e,{received:e.data,code:pr.invalid_literal,expected:this._def.value}),Er}return{status:"valid",value:t.data}}get value(){return this._def.value}}function Ui(t,e){return new Pi({values:t,typeName:Gi.ZodEnum,...Br(e)})}Ni.create=(t,e)=>new Ni({value:t,typeName:Gi.ZodLiteral,...Br(e)});class Pi extends Mr{constructor(){super(...arguments),Nr.set(this,void 0)}_parse(t){if("string"!=typeof t.data){const e=this._getOrReturnCtx(t),n=this._def.values;return vr(e,{expected:hr.joinValues(n),received:e.parsedType,code:pr.invalid_type}),Er}if(Tr(this,Nr,"f")||Rr(this,Nr,new Set(this._def.values),"f"),!Tr(this,Nr,"f").has(t.data)){const e=this._getOrReturnCtx(t),n=this._def.values;return vr(e,{received:e.data,code:pr.invalid_enum_value,options:n}),Er}return xr(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return Pi.create(t,{...this._def,...e})}exclude(t,e=this._def){return Pi.create(this.options.filter((e=>!t.includes(e))),{...this._def,...e})}}Nr=new WeakMap,Pi.create=Ui;class Li extends Mr{constructor(){super(...arguments),Ur.set(this,void 0)}_parse(t){const e=hr.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==dr.string&&n.parsedType!==dr.number){const t=hr.objectValues(e);return vr(n,{expected:hr.joinValues(t),received:n.parsedType,code:pr.invalid_type}),Er}if(Tr(this,Ur,"f")||Rr(this,Ur,new Set(hr.getValidEnumValues(this._def.values)),"f"),!Tr(this,Ur,"f").has(t.data)){const t=hr.objectValues(e);return vr(n,{received:n.data,code:pr.invalid_enum_value,options:t}),Er}return xr(t.data)}get enum(){return this._def.values}}Ur=new WeakMap,Li.create=(t,e)=>new Li({values:t,typeName:Gi.ZodNativeEnum,...Br(e)});class Bi extends Mr{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==dr.promise&&!1===e.common.async)return vr(e,{code:pr.invalid_type,expected:dr.promise,received:e.parsedType}),Er;const n=e.parsedType===dr.promise?e.data:Promise.resolve(e.data);return xr(n.then((t=>this._def.type.parseAsync(t,{path:e.path,errorMap:e.common.contextualErrorMap}))))}}Bi.create=(t,e)=>new Bi({type:t,typeName:Gi.ZodPromise,...Br(e)});class Mi extends Mr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Gi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:n}=this._processInputParams(t),r=this._def.effect||null,i={addIssue:t=>{vr(n,t),t.fatal?e.abort():e.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){const t=r.transform(n.data,i);if(n.common.async)return Promise.resolve(t).then((async t=>{if("aborted"===e.value)return Er;const r=await this._def.schema._parseAsync({data:t,path:n.path,parent:n});return"aborted"===r.status?Er:"dirty"===r.status||"dirty"===e.value?kr(r.value):r}));{if("aborted"===e.value)return Er;const r=this._def.schema._parseSync({data:t,path:n.path,parent:n});return"aborted"===r.status?Er:"dirty"===r.status||"dirty"===e.value?kr(r.value):r}}if("refinement"===r.type){const t=t=>{const e=r.refinement(t,i);if(n.common.async)return Promise.resolve(e);if(e instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return t};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Er:("dirty"===r.status&&e.dirty(),t(r.value),{status:e.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Er:("dirty"===n.status&&e.dirty(),t(n.value).then((()=>({status:e.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const t=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Cr(t))return t;const s=r.transform(t.value,i);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((t=>Cr(t)?Promise.resolve(r.transform(t.value,i)).then((t=>({status:e.value,value:t}))):t))}hr.assertNever(r)}}Mi.create=(t,e,n)=>new Mi({schema:t,typeName:Gi.ZodEffects,effect:e,...Br(n)}),Mi.createWithPreprocess=(t,e,n)=>new Mi({schema:e,effect:{type:"preprocess",transform:t},typeName:Gi.ZodEffects,...Br(n)});class ji extends Mr{_parse(t){return this._getType(t)===dr.undefined?xr(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ji.create=(t,e)=>new ji({innerType:t,typeName:Gi.ZodOptional,...Br(e)});class Fi extends Mr{_parse(t){return this._getType(t)===dr.null?xr(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Fi.create=(t,e)=>new Fi({innerType:t,typeName:Gi.ZodNullable,...Br(e)});class $i extends Mr{_parse(t){const{ctx:e}=this._processInputParams(t);let n=e.data;return e.parsedType===dr.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}$i.create=(t,e)=>new $i({innerType:t,typeName:Gi.ZodDefault,defaultValue:"function"==typeof e.default?e.default:()=>e.default,...Br(e)});class Di extends Mr{_parse(t){const{ctx:e}=this._processInputParams(t),n={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Or(r)?r.then((t=>({status:"valid",value:"valid"===t.status?t.value:this._def.catchValue({get error(){return new yr(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new yr(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Di.create=(t,e)=>new Di({innerType:t,typeName:Gi.ZodCatch,catchValue:"function"==typeof e.catch?e.catch:()=>e.catch,...Br(e)});class zi extends Mr{_parse(t){if(this._getType(t)!==dr.nan){const e=this._getOrReturnCtx(t);return vr(e,{code:pr.invalid_type,expected:dr.nan,received:e.parsedType}),Er}return{status:"valid",value:t.data}}}zi.create=t=>new zi({typeName:Gi.ZodNaN,...Br(t)});const qi=Symbol("zod_brand");class Zi extends Mr{_parse(t){const{ctx:e}=this._processInputParams(t),n=e.data;return this._def.type._parse({data:n,path:e.path,parent:e})}unwrap(){return this._def.type}}class Hi extends Mr{_parse(t){const{status:e,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const t=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===t.status?Er:"dirty"===t.status?(e.dirty(),kr(t.value)):this._def.out._parseAsync({data:t.value,path:n.path,parent:n})})();{const t=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===t.status?Er:"dirty"===t.status?(e.dirty(),{status:"dirty",value:t.value}):this._def.out._parseSync({data:t.value,path:n.path,parent:n})}}static create(t,e){return new Hi({in:t,out:e,typeName:Gi.ZodPipeline})}}class Vi extends Mr{_parse(t){const e=this._def.innerType._parse(t),n=t=>(Cr(t)&&(t.value=Object.freeze(t.value)),t);return Or(e)?e.then((t=>n(t))):n(e)}unwrap(){return this._def.innerType}}function Ki(t,e={},n){return t?pi.create().superRefine(((r,i)=>{var s,o;if(!t(r)){const t="function"==typeof e?e(r):"string"==typeof e?{message:e}:e,a=null===(o=null!==(s=t.fatal)&&void 0!==s?s:n)||void 0===o||o,c="string"==typeof t?{message:t}:t;i.addIssue({code:"custom",...c,fatal:a})}})):pi.create()}Vi.create=(t,e)=>new Vi({innerType:t,typeName:Gi.ZodReadonly,...Br(e)});const Wi={object:vi.lazycreate};var Gi;!function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"}(Gi||(Gi={}));const Ji=si.create,Yi=ai.create,Qi=zi.create,Xi=ci.create,ts=ui.create,es=hi.create,ns=li.create,rs=di.create,is=fi.create,ss=pi.create,os=yi.create,as=gi.create,cs=mi.create,us=wi.create,hs=vi.create,ls=vi.strictCreate,ds=_i.create,fs=ki.create,ps=Ai.create,ys=Si.create,gs=Ci.create,ms=Oi.create,ws=Ti.create,bs=Ri.create,vs=Ii.create,_s=Ni.create,Es=Pi.create,ks=Li.create,xs=Bi.create,As=Mi.create,Ss=ji.create,Cs=Fi.create,Os=Mi.createWithPreprocess,Ts=Hi.create,Rs={string:t=>si.create({...t,coerce:!0}),number:t=>ai.create({...t,coerce:!0}),boolean:t=>ui.create({...t,coerce:!0}),bigint:t=>ci.create({...t,coerce:!0}),date:t=>hi.create({...t,coerce:!0})},Is=Er;var Ns=Object.freeze({__proto__:null,defaultErrorMap:gr,setErrorMap:function(t){mr=t},getErrorMap:wr,makeIssue:br,EMPTY_PATH:[],addIssueToContext:vr,ParseStatus:_r,INVALID:Er,DIRTY:kr,OK:xr,isAborted:Ar,isDirty:Sr,isValid:Cr,isAsync:Or,get util(){return hr},get objectUtil(){return lr},ZodParsedType:dr,getParsedType:fr,ZodType:Mr,datetimeRegex:ni,ZodString:si,ZodNumber:ai,ZodBigInt:ci,ZodBoolean:ui,ZodDate:hi,ZodSymbol:li,ZodUndefined:di,ZodNull:fi,ZodAny:pi,ZodUnknown:yi,ZodNever:gi,ZodVoid:mi,ZodArray:wi,ZodObject:vi,ZodUnion:_i,ZodDiscriminatedUnion:ki,ZodIntersection:Ai,ZodTuple:Si,ZodRecord:Ci,ZodMap:Oi,ZodSet:Ti,ZodFunction:Ri,ZodLazy:Ii,ZodLiteral:Ni,ZodEnum:Pi,ZodNativeEnum:Li,ZodPromise:Bi,ZodEffects:Mi,ZodTransformer:Mi,ZodOptional:ji,ZodNullable:Fi,ZodDefault:$i,ZodCatch:Di,ZodNaN:zi,BRAND:qi,ZodBranded:Zi,ZodPipeline:Hi,ZodReadonly:Vi,custom:Ki,Schema:Mr,ZodSchema:Mr,late:Wi,get ZodFirstPartyTypeKind(){return Gi},coerce:Rs,any:ss,array:us,bigint:Xi,boolean:ts,date:es,discriminatedUnion:fs,effect:As,enum:Es,function:bs,instanceof:(t,e={message:`Input not instance of ${t.name}`})=>Ki((e=>e instanceof t),e),intersection:ps,lazy:vs,literal:_s,map:ms,nan:Qi,nativeEnum:ks,never:as,null:is,nullable:Cs,number:Yi,object:hs,oboolean:()=>ts().optional(),onumber:()=>Yi().optional(),optional:Ss,ostring:()=>Ji().optional(),pipeline:Ts,preprocess:Os,promise:xs,record:gs,set:ws,strictObject:ls,string:Ji,symbol:ns,transformer:As,tuple:ys,undefined:rs,union:ds,unknown:os,void:cs,NEVER:Is,ZodIssueCode:pr,quotelessJson:t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:yr});const Us=Ns.bigint(),Ps=Ns.boolean(),Ls=Ns.date(),Bs=Ns.number(),Ms=Ns.number().max(Number.MAX_SAFE_INTEGER),js=Ns.string(),Fs=Ns.number().min(5e8).max(Number.MAX_SAFE_INTEGER),$s=Ns.any(),Ds=Ns.string().regex(/^[0-9a-fA-F]*$/).refine((t=>t.length%2==0)),zs=Ns.union([Ns.string(),Ns.number(),Ns.boolean(),Ns.null()]),qs=Ds.refine((t=>32===t.length)),Zs=Ds.refine((t=>40===t.length)),Hs=Ds.refine((t=>64===t.length)),Vs=Ds.refine((t=>128===t.length)),Ks=Ds.refine((t=>66===t.length)),Ws={any:$s,base58:Ns.string().regex(/^[1-9A-HJ-NP-Za-km-z]+$/),base64:Ns.string().regex(/^[a-zA-Z0-9+/]+={0,2}$/),b64url:Ns.string().regex(/^[a-zA-Z0-9\-_]+={0,2}$/),bech32:Ns.string().regex(/^[a-z]+1[023456789acdefghjklmnpqrstuvwxyz]+$/),big:Us,bool:Ps,date:Ls,hex32:Hs,hex16:qs,hex20:Zs,hex64:Vs,hex:Ds,literal:zs,num:Bs,pubkey:Ks,str:js,stamp:Fs,uint:Ms},Gs=Ws.hex16,Js=Ws.str,Ys=Ws.str.min(3).max(256),Qs=Ns.array(Ws.literal.array()),Xs=Ns.tuple([Ys,Gs,Js]),to=Ns.object({content:Ws.str,created_at:Ws.stamp,kind:Ws.num,pubkey:Ws.hex32,tags:Qs}),eo=to.extend({id:Ws.hex32,sig:Ws.hex64}),no={base:Ws,event:{envelope:Xs,message:Ns.object({ctx:eo,data:Ns.any(),mid:Gs,tag:Ys}),signed:eo,tags:Qs,template:to}},{EVENT_CONFIG:ro}=ur;function io(t){const{id:e,sig:n,...r}=t,i=no.event.signed.safeParse(t),s=ar(r);return i.success?e!==s?"event id mismatch":function(t,e,n){return vn.verify(n,t,e)}(e,t.pubkey,n)?null:"invalid event signature":"event failed validation"}class so{constructor(){this._events=new Map}_get_methods(t){const e=String(t);let n=this._events.get(e);return void 0===n&&(n=new Set,this._events.set(e,n)),n}has(t){const e=this._events.get(t);return e instanceof Set&&e.size>0}on(t,e){this._get_methods(t).add(e)}once(t,e){const n=r=>{this.remove(t,n),e.apply(this,[r])};this.on(t,n)}within(t,e,n){const r=t=>{e.apply(this,[t])};setTimeout((()=>{this.remove(t,r)}),n),this.on(t,r)}emit(t,e){const n=[];this._get_methods(t).forEach((t=>{n.push(t.apply(this,[e]))})),this._get_methods("*").forEach((r=>{n.push(r.apply(this,[t,e]))})),Promise.allSettled(n)}remove(t,e){this._get_methods(t).delete(e)}clear(t){this._events.delete(t)}}var oo=__webpack_require__(706),ao=__webpack_require__(7833);function co(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function uo(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function ho(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const lo="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,fo=t=>t instanceof Uint8Array,po=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),yo=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function go(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!fo(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class mo{clone(){return this._cloneInto()}}function wo(t){const e=e=>t().update(go(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function bo(t=32){if(lo&&"function"==typeof lo.getRandomValues)return lo.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class vo extends mo{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=po(this.buffer)}update(t){ho(this);const{view:e,buffer:n,blockLen:r}=this,i=(t=go(t)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=po(t);for(;r<=i-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){ho(this),function(t,e){uo(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let t=s;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=po(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)o.setUint32(4*t,u[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return t.length=r,t.pos=o,t.finished=i,t.destroyed=s,r%e&&t.buffer.set(n),t}}const _o=(t,e,n)=>t&e^t&n^e&n,Eo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ko=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),xo=new Uint32Array(64);class Ao extends vo{constructor(){super(64,32,8,!1),this.A=0|ko[0],this.B=0|ko[1],this.C=0|ko[2],this.D=0|ko[3],this.E=0|ko[4],this.F=0|ko[5],this.G=0|ko[6],this.H=0|ko[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[t,e,n,r,i,s,o,a]}set(t,e,n,r,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)xo[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=xo[t-15],n=xo[t-2],r=yo(e,7)^yo(e,18)^e>>>3,i=yo(n,17)^yo(n,19)^n>>>10;xo[t]=i+xo[t-7]+r+xo[t-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let t=0;t<64;t++){const e=u+(yo(o,6)^yo(o,11)^yo(o,25))+((h=o)&a^~h&c)+Eo[t]+xo[t]|0,l=(yo(n,2)^yo(n,13)^yo(n,22))+_o(n,r,i)|0;u=c,c=a,a=o,o=s+e|0,s=i,i=r,r=n,n=e+l|0}var h;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,r,i,s,o,a,c,u)}roundClean(){xo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const So=wo((()=>new Ao)),Co=(BigInt(0),BigInt(1)),Oo=BigInt(2),To=t=>t instanceof Uint8Array,Ro=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Io(t){if(!To(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Ro[t[n]];return e}function No(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function Uo(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[e]=s}return n}function Po(t){return No(Io(t))}function Lo(t){if(!To(t))throw new Error("Uint8Array expected");return No(Io(Uint8Array.from(t).reverse()))}function Bo(t,e){return Uo(t.toString(16).padStart(2*e,"0"))}function Mo(t,e){return Bo(t,e).reverse()}function jo(t,e,n){let r;if("string"==typeof e)try{r=Uo(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!To(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Fo(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!To(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}const $o=t=>(Oo<<BigInt(t-1))-Co,Do=t=>new Uint8Array(t),zo=t=>Uint8Array.from(t);function qo(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=Do(t),i=Do(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...t)=>n(i,r,...t),c=(t=Do())=>{i=a(zo([0]),t),r=a(),0!==t.length&&(i=a(zo([1]),t),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return Fo(...n)};return(t,e)=>{let n;for(o(),c(t);!(n=e(u()));)c();return o(),n}}const Zo={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Ho(t,e,n={}){const r=(e,n,r)=>{const i=Zo[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const s=t[e];if(!(r&&void 0===s||i(s,t)))throw new Error(`Invalid param ${String(e)}=${s} (${typeof s}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}const Vo=BigInt(0),Ko=BigInt(1),Wo=BigInt(2),Go=BigInt(3),Jo=BigInt(4),Yo=BigInt(5),Qo=BigInt(8);function Xo(t,e){const n=t%e;return n>=Vo?n:e+n}function ta(t,e,n){if(n<=Vo||e<Vo)throw new Error("Expected power/modulo > 0");if(n===Ko)return Vo;let r=Ko;for(;e>Vo;)e&Ko&&(r=r*t%n),t=t*t%n,e>>=Ko;return r}function ea(t,e,n){let r=t;for(;e-- >Vo;)r*=r,r%=n;return r}function na(t,e){if(t===Vo||e<=Vo)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Xo(t,e),r=e,i=Vo,s=Ko,o=Ko,a=Vo;for(;n!==Vo;){const t=r/n,e=r%n,c=i-o*t,u=s-a*t;r=n,n=e,i=o,s=a,o=c,a=u}if(r!==Ko)throw new Error("invert: does not exist");return Xo(i,e)}BigInt(9),BigInt(16);const ra=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ia(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function sa(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function oa(t){const e=sa(t);return e+Math.ceil(e/2)}class aa extends mo{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");co(t.outputLen),co(t.blockLen)}(t);const n=go(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),i.fill(0)}update(t){return ho(this),this.iHash.update(t),this}digestInto(t){ho(this),uo(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=r,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ca=(t,e,n)=>new aa(t,e).update(n).digest();ca.create=(t,e)=>new aa(t,e);const ua=BigInt(0),ha=BigInt(1);function la(t){return Ho(t.Fp,ra.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Ho(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ia(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:da,aT:fa}=e,pa={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=pa;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:da(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=pa,n="string"==typeof t?fa(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=pa._parseInt(n.subarray(2)),{d:o,l:a}=pa._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),c=n(o);return`30${n(o+s+4)}02${c}${i}02${a}${r}`}},ya=BigInt(0),ga=BigInt(1),ma=(BigInt(2),BigInt(3));function wa(t){const e=function(t){const e=la(t);return Ho(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(t){return Xo(t,r)}function a(t){return na(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:l}=function(t){const e=function(t){const e=la(t);Ho(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const i=e.toAffine();return Fo(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function s(t){const{a:r,b:i}=e,s=n.sqr(t),o=n.mul(s,t);return n.add(n.add(o,n.mul(t,r)),i)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(t){return"bigint"==typeof t&&ya<t&&t<e.n}function a(t){if(!o(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=e;if(n&&"bigint"!=typeof t){if(t instanceof Uint8Array&&(t=Io(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let o;try{o="bigint"==typeof t?t:Po(jo("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return i&&(o=Xo(o,s)),a(o),o}const u=new Map;function h(t){if(!(t instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof l)throw new Error("projective point not allowed");const i=t=>n.eql(t,n.ZERO);return i(e)&&i(r)?l.ZERO:new l(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(l.fromAffine)}static fromHex(t){const e=l.fromAffine(i(jo("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return l.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,u.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),o=s(t);if(!n.eql(i,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){h(t);const{px:e,py:r,pz:i}=this,{px:s,py:o,pz:a}=t,c=n.eql(n.mul(e,a),n.mul(s,i)),u=n.eql(n.mul(r,a),n.mul(o,i));return c&&u}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,i=n.mul(r,ma),{px:s,py:o,pz:a}=this;let c=n.ZERO,u=n.ZERO,h=n.ZERO,d=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),y=n.mul(s,o);return y=n.add(y,y),h=n.mul(s,a),h=n.add(h,h),c=n.mul(t,h),u=n.mul(i,p),u=n.add(c,u),c=n.sub(f,u),u=n.add(f,u),u=n.mul(c,u),c=n.mul(y,c),h=n.mul(i,h),p=n.mul(t,p),y=n.sub(d,p),y=n.mul(t,y),y=n.add(y,h),h=n.add(d,d),d=n.add(h,d),d=n.add(d,p),d=n.mul(d,y),u=n.add(u,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,y),c=n.sub(c,d),h=n.mul(p,f),h=n.add(h,h),h=n.add(h,h),new l(c,u,h)}add(t){h(t);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:c}=t;let u=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,y=n.mul(e.b,ma);let g=n.mul(r,o),m=n.mul(i,a),w=n.mul(s,c),b=n.add(r,i),v=n.add(o,a);b=n.mul(b,v),v=n.add(g,m),b=n.sub(b,v),v=n.add(r,s);let _=n.add(o,c);return v=n.mul(v,_),_=n.add(g,w),v=n.sub(v,_),_=n.add(i,s),u=n.add(a,c),_=n.mul(_,u),u=n.add(m,w),_=n.sub(_,u),f=n.mul(p,v),u=n.mul(y,w),f=n.add(u,f),u=n.sub(m,f),f=n.add(m,f),d=n.mul(u,f),m=n.add(g,g),m=n.add(m,g),w=n.mul(p,w),v=n.mul(y,v),m=n.add(m,w),w=n.sub(g,w),w=n.mul(p,w),v=n.add(v,w),g=n.mul(m,v),d=n.add(d,g),g=n.mul(_,v),u=n.mul(b,u),u=n.sub(u,g),g=n.mul(b,m),f=n.mul(_,f),f=n.add(f,g),new l(u,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(l.ZERO)}wNAF(t){return f.wNAFCached(this,u,t,(t=>{const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(l.fromAffine)}))}multiplyUnsafe(t){const r=l.ZERO;if(t===ya)return r;if(a(t),t===ga)return this;const{endo:i}=e;if(!i)return f.unsafeLadder(this,t);let{k1neg:s,k1:o,k2neg:c,k2:u}=i.splitScalar(t),h=r,d=r,p=this;for(;o>ya||u>ya;)o&ga&&(h=h.add(p)),u&ga&&(d=d.add(p)),p=p.double(),o>>=ga,u>>=ga;return s&&(h=h.negate()),c&&(d=d.negate()),d=new l(n.mul(d.px,i.beta),d.py,d.pz),h.add(d)}multiply(t){a(t);let r,i,s=t;const{endo:o}=e;if(o){const{k1neg:t,k1:e,k2neg:a,k2:c}=o.splitScalar(s);let{p:u,f:h}=this.wNAF(e),{p:d,f:p}=this.wNAF(c);u=f.constTimeNegate(t,u),d=f.constTimeNegate(a,d),d=new l(n.mul(d.px,o.beta),d.py,d.pz),r=u.add(d),i=h.add(p)}else{const{p:t,f:e}=this.wNAF(s);r=t,i=e}return l.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(t,e,n){const r=l.BASE,i=(t,e)=>e!==ya&&e!==ga&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),s=i(this,e).add(i(t,n));return s.is0()?void 0:s}toAffine(t){const{px:e,py:r,pz:i}=this,s=this.is0();null==t&&(t=s?n.ONE:n.inv(i));const o=n.mul(e,t),a=n.mul(r,t),c=n.mul(i,t);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===ga)return!0;if(n)return n(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===ga?this:n?n(l,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),r(l,this,t)}toHex(t=!0){return Io(this.toRawBytes(t))}}l.BASE=new l(e.Gx,e.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,i=e;for(;n>ua;)n&ha&&(r=r.add(i)),i=i.double(),n>>=ha;return r},precomputeWindow(t,e){const{windows:n,windowSize:i}=r(e),s=[];let o=t,a=o;for(let t=0;t<n;t++){a=o,s.push(a);for(let t=1;t<i;t++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(e,i,s){const{windows:o,windowSize:a}=r(e);let c=t.ZERO,u=t.BASE;const h=BigInt(2**e-1),l=2**e,d=BigInt(e);for(let t=0;t<o;t++){const e=t*a;let r=Number(s&h);s>>=d,r>a&&(r-=l,s+=ha);const o=e,f=e+Math.abs(r)-1,p=t%2!=0,y=r<0;0===r?u=u.add(n(p,i[o])):c=c.add(n(y,i[f]))}return{p:c,f:u}},wNAFCached(t,e,n,r){const i=t._WINDOW_SIZE||1;let s=e.get(t);return s||(s=this.precomputeWindow(t,i),1!==i&&e.set(t,r(s))),this.wNAF(i,s,n)}}}(l,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}({...e,toBytes(t,e,r){const i=e.toAffine(),s=n.toBytes(i.x),o=Fo;return r?o(Uint8Array.from([e.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(t){const e=t.length,r=t[0],o=t.subarray(1);if(e!==i||2!==r&&3!==r){if(e===s&&4===r)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${e} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const t=Po(o);if(!function(t){return ya<t&&t<n.ORDER}(t))throw new Error("Point is not on curve");const e=h(t);let i=n.sqrt(e);return!(1&~r)!=((i&ga)===ga)&&(i=n.neg(i)),{x:t,y:i}}}}),d=t=>Io(Bo(t,e.nByteLength));function f(t){return t>r>>ga}const p=(t,e,n)=>Po(t.slice(e,n));class y{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=jo("compactSignature",t,2*n),new y(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=pa.toSig(jo("DER",t));return new y(e,n)}assertValidity(){if(!l(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!l(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new y(this.r,this.s,t)}recoverPublicKey(t){const{r,s:i,recovery:s}=this,u=b(jo("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const h=2===s||3===s?r+e.n:r;if(h>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const l=1&s?"03":"02",f=c.fromHex(l+d(h)),p=a(h),y=o(-u*p),g=o(i*p),m=c.BASE.multiplyAndAddUnsafe(f,y,g);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Uo(this.toDERHex())}toDERHex(){return pa.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Uo(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const g={isValidPrivateKey(t){try{return u(t),!0}catch(t){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const t=oa(e.n);return function(t,e,n=!1){const r=t.length,i=sa(e),s=oa(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=Xo(n?Po(t):Lo(t),e-Ko)+Ko;return n?Mo(o,i):Bo(o,i)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function m(t){const e=t instanceof Uint8Array,n="string"==typeof t,r=(e||n)&&t.length;return e?r===i||r===s:n?r===2*i||r===2*s:t instanceof c}const w=e.bits2int||function(t){const n=Po(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},b=e.bits2int_modN||function(t){return o(w(t))},v=$o(e.nBitLength);function _(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(ya<=t&&t<v))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Bo(t,e.nByteLength)}const E={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(m(t))throw new Error("first arg must be private key");if(!m(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(u(t)).toRawBytes(n)},sign:function(t,r,i=E){const{seed:s,k2sig:h}=function(t,r,i=E){if(["recovered","canonical"].some((t=>t in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:h}=e;let{lowS:d,prehash:p,extraEntropy:g}=i;null==d&&(d=!0),t=jo("msgHash",t),p&&(t=jo("prehashed msgHash",s(t)));const m=b(t),v=u(r),k=[_(v),_(m)];if(null!=g){const t=!0===g?h(n.BYTES):g;k.push(jo("extraEntropy",t))}const x=Fo(...k),A=m;return{seed:x,k2sig:function(t){const e=w(t);if(!l(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),i=o(r.x);if(i===ya)return;const s=o(n*o(A+i*v));if(s===ya)return;let u=(r.x===i?0:2)|Number(r.y&ga),h=s;return d&&f(s)&&(h=function(t){return f(t)?o(-t):t}(s),u^=1),new y(i,h,u)}}}(t,r,i),d=e;return qo(d.hash.outputLen,d.nByteLength,d.hmac)(s,h)},verify:function(t,n,r,i=k){const s=t;if(n=jo("msgHash",n),r=jo("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:h}=i;let l,d;try{if("string"==typeof s||s instanceof Uint8Array)try{l=y.fromDER(s)}catch(t){if(!(t instanceof pa.Err))throw t;l=y.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:t,s:e}=s;l=new y(t,e)}}d=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&l.hasHighS())return!1;h&&(n=e.hash(n));const{r:f,s:p}=l,g=b(n),m=a(p),w=o(g*m),v=o(f*m),_=c.BASE.multiplyAndAddUnsafe(d,w,v)?.toAffine();return!!_&&o(_.x)===f},ProjectivePoint:c,Signature:y,utils:g}}function ba(t){return{hash:t,hmac:(e,...n)=>ca(t,e,function(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!fo(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}(...n)),randomBytes:bo}}BigInt(4);const va=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),_a=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ea=BigInt(1),ka=BigInt(2),xa=(t,e)=>(t+e/ka)/e;function Aa(t){const e=va,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,h=u*u*t%e,l=ea(h,n,e)*h%e,d=ea(l,n,e)*h%e,f=ea(d,ka,e)*u%e,p=ea(f,i,e)*f%e,y=ea(p,s,e)*p%e,g=ea(y,a,e)*y%e,m=ea(g,c,e)*g%e,w=ea(m,a,e)*y%e,b=ea(w,n,e)*h%e,v=ea(b,o,e)*p%e,_=ea(v,r,e)*u%e,E=ea(_,ka,e);if(!Sa.eql(Sa.sqr(E),t))throw new Error("Cannot find square root");return E}const Sa=function(t,e,n=!1,r={}){if(t<=Vo)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=ia(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=function(t){if(t%Jo===Go){const e=(t+Ko)/Jo;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%Qo===Yo){const e=(t-Yo)/Qo;return function(t,n){const r=t.mul(n,Wo),i=t.pow(r,e),s=t.mul(n,i),o=t.mul(t.mul(s,Wo),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-Ko)/Wo;let n,r,i;for(n=t-Ko,r=0;n%Wo===Vo;n/=Wo,r++);for(i=Wo;i<t&&ta(i,e,t)!==t-Ko;i++);if(1===r){const e=(t+Ko)/Jo;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+Ko)/Wo;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,i),n),u=t.pow(o,s),h=t.pow(o,n);for(;!t.eql(h,t.ONE);){if(t.eql(h,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(h);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,Ko<<BigInt(a-e-1));c=t.sqr(n),u=t.mul(u,n),h=t.mul(h,c),a=e}return u}}(t)}(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:$o(i),ZERO:Vo,ONE:Ko,create:e=>Xo(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return Vo<=e&&e<t},is0:t=>t===Vo,isOdd:t=>(t&Ko)===Ko,neg:e=>Xo(-e,t),eql:(t,e)=>t===e,sqr:e=>Xo(e*e,t),add:(e,n)=>Xo(e+n,t),sub:(e,n)=>Xo(e-n,t),mul:(e,n)=>Xo(e*n,t),pow:(t,e)=>function(t,e,n){if(n<Vo)throw new Error("Expected power > 0");if(n===Vo)return t.ONE;if(n===Ko)return e;let r=t.ONE,i=e;for(;n>Vo;)n&Ko&&(r=t.mul(r,i)),i=t.sqr(i),n>>=Ko;return r}(a,t,e),div:(e,n)=>Xo(e*na(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>na(e,t),sqrt:r.sqrt||(t=>o(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,i)=>t.is0(r)?e:(n[i]=e,t.mul(e,r))),t.ONE),i=t.inv(r);return e.reduceRight(((e,r,i)=>t.is0(r)?e:(n[i]=t.mul(e,n[i]),t.mul(e,r))),i),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?Mo(t,s):Bo(t,s),fromBytes:t=>{if(t.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${t.length}`);return n?Lo(t):Po(t)}});return Object.freeze(a)}(va,void 0,void 0,{sqrt:Aa}),Ca=function(t,e){const n=e=>wa({...t,...ba(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Sa,n:_a,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=_a,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Ea*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=xa(s*t,e),c=xa(-r*t,e);let u=Xo(t-a*n-c*i,e),h=Xo(-a*r-c*s,e);const l=u>o,d=h>o;if(l&&(u=e-u),d&&(h=e-h),u>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:d,k2:h}}}},So),Oa=BigInt(0),Ta=t=>"bigint"==typeof t&&Oa<t&&t<va,Ra={};function Ia(t,...e){let n=Ra[t];if(void 0===n){const e=So(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=Fo(e,e),Ra[t]=n}return So(Fo(n,...e))}const Na=t=>t.toRawBytes(!0).slice(1),Ua=t=>Bo(t,32),Pa=t=>Xo(t,va),La=t=>Xo(t,_a),Ba=Ca.ProjectivePoint;function Ma(t){let e=Ca.utils.normPrivateKeyToScalar(t),n=Ba.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:La(-e),bytes:Na(n)}}function ja(t){if(!Ta(t))throw new Error("bad x: need 0 < x < p");const e=Pa(t*t);let n=Aa(Pa(e*t+BigInt(7)));n%ka!==Oa&&(n=Pa(-n));const r=new Ba(t,n,Ea);return r.assertValidity(),r}function Fa(...t){return La(Po(Ia("BIP0340/challenge",...t)))}function $a(t){return Ma(t).bytes}function Da(t,e,n=bo(32)){const r=jo("message",t),{bytes:i,scalar:s}=Ma(e),o=jo("auxRand",n,32),a=Ua(s^Po(Ia("BIP0340/aux",o))),c=Ia("BIP0340/nonce",a,i,r),u=La(Po(c));if(u===Oa)throw new Error("sign failed: k is zero");const{bytes:h,scalar:l}=Ma(u),d=Fa(h,i,r),f=new Uint8Array(64);if(f.set(h,0),f.set(Ua(La(l+d*s)),32),!za(f,r,i))throw new Error("sign: Invalid signature produced");return f}function za(t,e,n){const r=jo("signature",t,64),i=jo("message",e),s=jo("publicKey",n,32);try{const t=ja(Po(s)),e=Po(r.subarray(0,32));if(!Ta(e))return!1;const n=Po(r.subarray(32,64));if(!("bigint"==typeof(u=n)&&Oa<u&&u<_a))return!1;const h=Fa(Ua(e),Na(t),i),l=(o=t,a=n,c=La(-h),Ba.BASE.multiplyAndAddUnsafe(o,a,c));return!(!l||!l.hasEvenY()||l.toAffine().x!==e)}catch(t){return!1}var o,a,c,u}const qa=(()=>({getPublicKey:$a,sign:Da,verify:za,utils:{randomPrivateKey:Ca.utils.randomPrivateKey,lift_x:ja,pointToBytes:Na,numberToBytesBE:Bo,bytesToNumberBE:Po,taggedHash:Ia,mod:Xo}}))(),Za="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Ha=t=>t instanceof Uint8Array,Va=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ka=(t,e)=>t<<32-e|t>>>e;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");const Wa=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Ga(t){if(!Ha(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Wa[t[n]];return e}function Ja(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[e]=s}return n}function Ya(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!Ha(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function Qa(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!Ha(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}class Xa{clone(){return this._cloneInto()}}function tc(t){const e=e=>t().update(Ya(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function ec(t=32){if(Za&&"function"==typeof Za.getRandomValues)return Za.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function nc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function rc(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const ic={number:nc,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:rc,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");nc(t.outputLen),nc(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){rc(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class sc extends Xa{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Va(this.buffer)}update(t){ic.exists(this);const{view:e,buffer:n,blockLen:r}=this,i=(t=Ya(t)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Va(t);for(;r<=i-s;s+=r)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){ic.exists(this),ic.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let t=s;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=Va(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)o.setUint32(4*t,u[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return t.length=r,t.pos=o,t.finished=i,t.destroyed=s,r%e&&t.buffer.set(n),t}}const oc=(t,e,n)=>t&e^t&n^e&n,ac=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),cc=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),uc=new Uint32Array(64);class hc extends sc{constructor(){super(64,32,8,!1),this.A=0|cc[0],this.B=0|cc[1],this.C=0|cc[2],this.D=0|cc[3],this.E=0|cc[4],this.F=0|cc[5],this.G=0|cc[6],this.H=0|cc[7]}get(){const{A:t,B:e,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[t,e,n,r,i,s,o,a]}set(t,e,n,r,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)uc[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=uc[t-15],n=uc[t-2],r=Ka(e,7)^Ka(e,18)^e>>>3,i=Ka(n,17)^Ka(n,19)^n>>>10;uc[t]=i+uc[t-7]+r+uc[t-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let t=0;t<64;t++){const e=u+(Ka(o,6)^Ka(o,11)^Ka(o,25))+((h=o)&a^~h&c)+ac[t]+uc[t]|0,l=(Ka(n,2)^Ka(n,13)^Ka(n,22))+oc(n,r,i)|0;u=c,c=a,a=o,o=s+e|0,s=i,i=r,r=n,n=e+l|0}var h;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,r,i,s,o,a,c,u)}roundClean(){uc.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class lc extends hc{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const dc=tc((()=>new hc));function fc(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function pc(...t){const e=(t,e)=>n=>t(e(n)),n=Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),r=t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0);return{encode:n,decode:r}}function yc(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(fc(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function gc(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function mc(t,e="="){if(fc(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function wc(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function bc(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((t=>{if(fc(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,o=!0;for(let i=r;i<s.length;i++){const a=s[i],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%n,s[i]=Math.floor(c/n),!Number.isSafeInteger(s[i])||s[i]*n+t!==c)throw new Error("convertRadix: carry overflow");o&&(s[i]?o=!1:r=i)}if(i.push(t),o)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}tc((()=>new lc));const vc=(t,e)=>e?vc(e,t%e):t,_c=(t,e)=>t+(e-vc(t,e));function Ec(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(_c(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${_c(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const r of t){if(fc(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(i=i<<e|r,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function kc(t,e=!1){if(fc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(_c(8,t)>32||_c(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ec(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ec(n,t,8,e))}}}function xc(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}pc(kc(4),yc("0123456789ABCDEF"),gc("")),pc(kc(5),yc("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),mc(5),gc(""));const Ac=(pc(kc(5),yc("0123456789ABCDEFGHIJKLMNOPQRSTUV"),mc(5),gc("")),pc(kc(5),yc("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),gc(""),wc((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),pc(kc(6),yc("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),mc(6),gc(""))),Sc=(pc(kc(6),yc("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),mc(6),gc("")),t=>pc(function(t){return fc(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return bc(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(bc(e,t,256))}}}(58),yc(t),gc(""))),Cc=(Sc("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Sc("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Sc("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),pc(yc("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),gc(""))),Oc=[996825010,642813549,513874426,1027748829,705979059];function Tc(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<Oc.length;t++)1==(e>>t&1)&&(n^=Oc[t]);return n}function Rc(t,e,n=1){const r=t.length;let i=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);i=Tc(i)^n>>5}i=Tc(i);for(let e=0;e<r;e++)i=Tc(i)^31&t.charCodeAt(e);for(let t of e)i=Tc(i)^t;for(let t=0;t<6;t++)i=Tc(i);return i^=n,Cc.encode(Ec([i%2**30],30,5,!1))}function Ic(t){const e="bech32"===t?1:734539939,n=kc(5),r=n.decode,i=n.encode,s=xc(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(t=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=t.slice(0,i),o=t.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=Cc.decode(o).slice(0,-6),c=Rc(s,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=t.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${Cc.encode(n)}${Rc(t,n,e)}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:xc(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const Nc=Ic("bech32");Ic("bech32m");function Uc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Pc(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function Lc(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function Bc(t,...e){if(!Lc(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Mc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function jc(t,e){Bc(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}pc(kc(4),yc("0123456789abcdef"),gc(""),wc((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const Fc=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),$c=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Dc=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function zc(t){if("string"==typeof t)t=function(t){if("string"!=typeof t)throw new Error("string expected, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!Lc(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function qc(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}const Zc=(t,e)=>(Object.assign(e,t),e);function Hc(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}const Vc=16,Kc=new Uint8Array(16),Wc=$c(Kc),Gc=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class Jc{constructor(t,e){this.blockLen=Vc,this.outputLen=Vc,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,Bc(t=zc(t),16);const n=Dc(t);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),s=n.getUint32(8,!1),o=n.getUint32(12,!1);const a=[];for(let t=0;t<128;t++)a.push({s0:Gc(r),s1:Gc(i),s2:Gc(s),s3:Gc(o)}),({s0:r,s1:i,s2:s,s3:o}={s3:(h=s)<<31|(l=o)>>>1,s2:(u=i)<<31|h>>>1,s1:(c=r)<<31|u>>>1,s0:c>>>1^225<<24&-(1&l)});var c,u,h,l;const d=(f=e||1024)>65536?8:f>1024?4:2;var f;if(![1,2,4,8].includes(d))throw new Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;const p=128/d,y=this.windowSize=2**d,g=[];for(let t=0;t<p;t++)for(let e=0;e<y;e++){let n=0,r=0,i=0,s=0;for(let o=0;o<d;o++){if(!(e>>>d-o-1&1))continue;const{s0:c,s1:u,s2:h,s3:l}=a[d*t+o];n^=c,r^=u,i^=h,s^=l}g.push({s0:n,s1:r,s2:i,s3:s})}this.t=g}_updateBlock(t,e,n,r){t^=this.s0,e^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:s,windowSize:o}=this;let a=0,c=0,u=0,h=0;const l=(1<<i)-1;let d=0;for(const f of[t,e,n,r])for(let t=0;t<4;t++){const e=f>>>8*t&255;for(let t=8/i-1;t>=0;t--){const n=e>>>i*t&l,{s0:r,s1:f,s2:p,s3:y}=s[d*o+n];a^=r,c^=f,u^=p,h^=y,d+=1}}this.s0=a,this.s1=c,this.s2=u,this.s3=h}update(t){t=zc(t),Mc(this);const e=$c(t),n=Math.floor(t.length/Vc),r=t.length%Vc;for(let t=0;t<n;t++)this._updateBlock(e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]);return r&&(Kc.set(t.subarray(n*Vc)),this._updateBlock(Wc[0],Wc[1],Wc[2],Wc[3]),Wc.fill(0)),this}destroy(){const{t}=this;for(const e of t)e.s0=0,e.s1=0,e.s2=0,e.s3=0}digestInto(t){Mc(this),jc(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:i}=this,s=$c(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,t}digest(){const t=new Uint8Array(Vc);return this.digestInto(t),this.destroy(),t}}class Yc extends Jc{constructor(t,e){const n=function(t){t.reverse();const e=1&t[15];let n=0;for(let e=0;e<t.length;e++){const r=t[e];t[e]=r>>>1|n,n=(1&r)<<7}return t[0]^=225&-e,t}((t=zc(t)).slice());super(n,e),n.fill(0)}update(t){t=zc(t),Mc(this);const e=$c(t),n=t.length%Vc,r=Math.floor(t.length/Vc);for(let t=0;t<r;t++)this._updateBlock(Gc(e[4*t+3]),Gc(e[4*t+2]),Gc(e[4*t+1]),Gc(e[4*t+0]));return n&&(Kc.set(t.subarray(r*Vc)),this._updateBlock(Gc(Wc[3]),Gc(Wc[2]),Gc(Wc[1]),Gc(Wc[0])),Wc.fill(0)),this}digestInto(t){Mc(this),jc(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:i}=this,s=$c(t);return s[0]=e,s[1]=n,s[2]=r,s[3]=i,t.reverse()}}function Qc(t){const e=(e,n)=>t(n,e.length).update(zc(e)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(e,n)=>t(e,n),e}const Xc=Qc(((t,e)=>new Jc(t,e))),tu=Qc(((t,e)=>new Yc(t,e))),eu=16,nu=new Uint8Array(eu);function ru(t){return t<<1^283&-(t>>7)}function iu(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=ru(t);return n}const su=(()=>{let t=new Uint8Array(256);for(let e=0,n=1;e<256;e++,n^=ru(n))t[e]=n;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),ou=su.map(((t,e)=>su.indexOf(e))),au=t=>t<<8|t>>>24;function cu(t,e){if(256!==t.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>e(t[r]))),r=n.map(au),i=r.map(au),s=i.map(au),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let e=0;e<256;e++)for(let u=0;u<256;u++){const h=256*e+u;o[h]=n[e]^r[u],a[h]=i[e]^s[u],c[h]=t[e]<<8|t[u]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const uu=cu(su,(t=>iu(t,3)<<24|t<<16|t<<8|iu(t,2))),hu=cu(ou,(t=>iu(t,11)<<24|iu(t,13)<<16|iu(t,9)<<8|iu(t,14))),lu=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=ru(n))t[e]=n;return t})();function du(t){Bc(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=uu,r=$c(t),i=r.length,s=t=>yu(n,t,t,t,t),o=new Uint32Array(e+28);o.set(r);for(let t=i;t<o.length;t++){let e=o[t-1];t%i==0?e=s((a=e)<<24|a>>>8)^lu[t/i-1]:i>6&&t%i==4&&(e=s(e)),o[t]=o[t-i]^e}var a;return o}function fu(t){const e=du(t),n=e.slice(),r=e.length,{sbox2:i}=uu,{T0:s,T1:o,T2:a,T3:c}=hu;for(let t=0;t<r;t+=4)for(let i=0;i<4;i++)n[t+i]=e[r-t-4+i];e.fill(0);for(let t=4;t<r-4;t++){const e=n[t],r=yu(i,e,e,e,e);n[t]=s[255&r]^o[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function pu(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function yu(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function gu(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=uu;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],i^=t[c++];const u=t.length/4-2;for(let s=0;s<u;s++){const s=t[c++]^pu(o,a,e,n,r,i),u=t[c++]^pu(o,a,n,r,i,e),h=t[c++]^pu(o,a,r,i,e,n),l=t[c++]^pu(o,a,i,e,n,r);e=s,n=u,r=h,i=l}return{s0:t[c++]^yu(s,e,n,r,i),s1:t[c++]^yu(s,n,r,i,e),s2:t[c++]^yu(s,r,i,e,n),s3:t[c++]^yu(s,i,e,n,r)}}function mu(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=hu;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],i^=t[c++];const u=t.length/4-2;for(let s=0;s<u;s++){const s=t[c++]^pu(o,a,e,i,r,n),u=t[c++]^pu(o,a,n,e,i,r),h=t[c++]^pu(o,a,r,n,e,i),l=t[c++]^pu(o,a,i,r,n,e);e=s,n=u,r=h,i=l}return{s0:t[c++]^yu(s,e,i,r,n),s1:t[c++]^yu(s,n,e,i,r),s2:t[c++]^yu(s,r,n,e,i),s3:t[c++]^yu(s,i,r,n,e)}}function wu(t,e){if(!e)return new Uint8Array(t);if(Bc(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function bu(t,e,n,r,i){Bc(n,eu),Bc(r),i=wu(r.length,i);const s=n,o=$c(s),a=Dc(s),c=$c(r),u=$c(i),h=e?0:12,l=r.length;let d=a.getUint32(h,e),{s0:f,s1:p,s2:y,s3:g}=gu(t,o[0],o[1],o[2],o[3]);for(let n=0;n+4<=c.length;n+=4)u[n+0]=c[n+0]^f,u[n+1]=c[n+1]^p,u[n+2]=c[n+2]^y,u[n+3]=c[n+3]^g,d=d+1>>>0,a.setUint32(h,d,e),({s0:f,s1:p,s2:y,s3:g}=gu(t,o[0],o[1],o[2],o[3]));const m=eu*Math.floor(c.length/4);if(m<l){const t=new Uint32Array([f,p,y,g]),e=Fc(t);for(let t=m,n=0;t<l;t++,n++)i[t]=r[t]^e[n]}return i}function vu(t){if(Bc(t),t.length%eu!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function _u(t,e,n){let r=t.length;const i=r%eu;if(!e&&0!==i)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=$c(t);if(e){let t=eu-i;t||(t=eu),r+=t}const o=wu(r,n);return{b:s,o:$c(o),out:o}}function Eu(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let e=0;e<r;e++)if(t[n-e-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function ku(t){const e=new Uint8Array(16),n=$c(e);e.set(t);const r=eu-t.length;for(let t=eu-r;t<eu;t++)e[t]=r;return n}Zc({blockSize:16,nonceLength:16},(function(t,e){function n(n,r){const i=du(t),s=e.slice(),o=function(t,e,n,r){Bc(e,eu),Bc(n);const i=n.length;r=wu(i,r);const s=e,o=$c(s);let{s0:a,s1:c,s2:u,s3:h}=gu(t,o[0],o[1],o[2],o[3]);const l=$c(n),d=$c(r);for(let e=0;e+4<=l.length;e+=4){d[e+0]=l[e+0]^a,d[e+1]=l[e+1]^c,d[e+2]=l[e+2]^u,d[e+3]=l[e+3]^h;let n=1;for(let t=s.length-1;t>=0;t--)n=n+(255&s[t])|0,s[t]=255&n,n>>>=8;({s0:a,s1:c,s2:u,s3:h}=gu(t,o[0],o[1],o[2],o[3]))}const f=eu*Math.floor(l.length/4);if(f<i){const t=new Uint32Array([a,c,u,h]),e=Fc(t);for(let t=f,s=0;t<i;t++,s++)r[t]=n[t]^e[s]}return r}(i,s,n,r);return i.fill(0),s.fill(0),o}return Bc(t),Bc(e,eu),{encrypt:(t,e)=>n(t,e),decrypt:(t,e)=>n(t,e)}})),Zc({blockSize:16},(function(t,e={}){Bc(t);const n=!e.disablePadding;return{encrypt:(e,r)=>{Bc(e);const{b:i,o:s,out:o}=_u(e,n,r),a=du(t);let c=0;for(;c+4<=i.length;){const{s0:t,s1:e,s2:n,s3:r}=gu(a,i[c+0],i[c+1],i[c+2],i[c+3]);s[c++]=t,s[c++]=e,s[c++]=n,s[c++]=r}if(n){const t=ku(e.subarray(4*c)),{s0:n,s1:r,s2:i,s3:o}=gu(a,t[0],t[1],t[2],t[3]);s[c++]=n,s[c++]=r,s[c++]=i,s[c++]=o}return a.fill(0),o},decrypt:(e,r)=>{vu(e);const i=fu(t),s=wu(e.length,r),o=$c(e),a=$c(s);for(let t=0;t+4<=o.length;){const{s0:e,s1:n,s2:r,s3:s}=mu(i,o[t+0],o[t+1],o[t+2],o[t+3]);a[t++]=e,a[t++]=n,a[t++]=r,a[t++]=s}return i.fill(0),Eu(s,n)}}}));const xu=Zc({blockSize:16,nonceLength:16},(function(t,e,n={}){Bc(t),Bc(e,16);const r=!n.disablePadding;return{encrypt:(n,i)=>{const s=du(t),{b:o,o:a,out:c}=_u(n,r,i),u=$c(e);let h=u[0],l=u[1],d=u[2],f=u[3],p=0;for(;p+4<=o.length;)h^=o[p+0],l^=o[p+1],d^=o[p+2],f^=o[p+3],({s0:h,s1:l,s2:d,s3:f}=gu(s,h,l,d,f)),a[p++]=h,a[p++]=l,a[p++]=d,a[p++]=f;if(r){const t=ku(n.subarray(4*p));h^=t[0],l^=t[1],d^=t[2],f^=t[3],({s0:h,s1:l,s2:d,s3:f}=gu(s,h,l,d,f)),a[p++]=h,a[p++]=l,a[p++]=d,a[p++]=f}return s.fill(0),c},decrypt:(n,i)=>{vu(n);const s=fu(t),o=$c(e),a=wu(n.length,i),c=$c(n),u=$c(a);let h=o[0],l=o[1],d=o[2],f=o[3];for(let t=0;t+4<=c.length;){const e=h,n=l,r=d,i=f;h=c[t+0],l=c[t+1],d=c[t+2],f=c[t+3];const{s0:o,s1:a,s2:p,s3:y}=mu(s,h,l,d,f);u[t++]=o^e,u[t++]=a^n,u[t++]=p^r,u[t++]=y^i}return s.fill(0),Eu(a,r)}}}));function Au(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=Dc(o);return i&&Hc(a,0,BigInt(8*i.length),e),Hc(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}Zc({blockSize:16,nonceLength:16},(function(t,e){function n(n,r,i){const s=du(t),o=n.length;i=wu(o,i);const a=$c(n),c=$c(i),u=r?c:a,h=$c(e);let l=h[0],d=h[1],f=h[2],p=h[3];for(let t=0;t+4<=a.length;){const{s0:e,s1:n,s2:r,s3:i}=gu(s,l,d,f,p);c[t+0]=a[t+0]^e,c[t+1]=a[t+1]^n,c[t+2]=a[t+2]^r,c[t+3]=a[t+3]^i,l=u[t++],d=u[t++],f=u[t++],p=u[t++]}const y=eu*Math.floor(a.length/4);if(y<o){({s0:l,s1:d,s2:f,s3:p}=gu(s,l,d,f,p));const t=Fc(new Uint32Array([l,d,f,p]));for(let e=y,r=0;e<o;e++,r++)i[e]=n[e]^t[r];t.fill(0)}return s.fill(0),i}return Bc(t),Bc(e,16),{encrypt:(t,e)=>n(t,!0,e),decrypt:(t,e)=>n(t,!1,e)}})),Zc({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(Bc(e),0===e.length)throw new Error("aes/gcm: empty nonce");function r(t,e,r){const i=Au(Xc,!1,t,r,n);for(let t=0;t<e.length;t++)i[t]^=e[t];return i}function i(){const n=du(t),r=nu.slice(),i=nu.slice();if(bu(n,!1,i,i,r),12===e.length)i.set(e);else{const t=nu.slice();Hc(Dc(t),8,BigInt(8*e.length),!1),Xc.create(r).update(e).update(t).digestInto(i)}return{xk:n,authKey:r,counter:i,tagMask:bu(n,!1,i,nu)}}return{encrypt:t=>{Bc(t);const{xk:e,authKey:n,counter:s,tagMask:o}=i(),a=new Uint8Array(t.length+16);bu(e,!1,s,t,a);const c=r(n,o,a.subarray(0,a.length-16));return a.set(c,t.length),e.fill(0),a},decrypt:t=>{if(Bc(t),t.length<16)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:e,authKey:n,counter:s,tagMask:o}=i(),a=t.subarray(0,-16),c=t.subarray(-16);if(!qc(r(n,o,a),c))throw new Error("aes/gcm: invalid ghash tag");const u=bu(e,!1,s,a);return n.fill(0),o.fill(0),e.fill(0),u}}}));const Su=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Zc({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=Su("AAD",0,2**36),i=Su("plaintext",0,2**36),s=Su("nonce",12,12),o=Su("ciphertext",16,2**36+16);function a(){const n=t.length;if(16!==n&&24!==n&&32!==n)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${n} bytes`);const r=du(t),i=new Uint8Array(n),s=new Uint8Array(16),o=$c(e);let a=0,c=o[0],u=o[1],h=o[2],l=0;for(const t of[s,i].map($c)){const e=$c(t);for(let t=0;t<e.length;t+=2){const{s0:n,s1:i}=gu(r,a,c,u,h);e[t+0]=n,e[t+1]=i,a=++l}}return r.fill(0),{authKey:s,encKey:du(i)}}function c(t,r,i){const s=Au(tu,!0,r,i,n);for(let t=0;t<12;t++)s[t]^=e[t];s[15]&=127;const o=$c(s);let a=o[0],c=o[1],u=o[2],h=o[3];return({s0:a,s1:c,s2:u,s3:h}=gu(t,a,c,u,h)),o[0]=a,o[1]=c,o[2]=u,o[3]=h,s}function u(t,e,n){let r=e.slice();return r[15]|=128,bu(t,!0,r,n)}return Bc(e),s(e.length),n&&(Bc(n),r(n.length)),{encrypt:t=>{Bc(t),i(t.length);const{encKey:e,authKey:n}=a(),r=c(e,n,t),s=new Uint8Array(t.length+16);return s.set(r,t.length),s.set(u(e,r,t)),e.fill(0),n.fill(0),s},decrypt:t=>{Bc(t),o(t.length);const e=t.subarray(-16),{encKey:n,authKey:r}=a(),i=u(n,e,t.subarray(0,-16)),s=c(n,r,i);if(n.fill(0),r.fill(0),!qc(e,s))throw new Error("invalid polyval tag");return i}}}));const Cu=(t,e)=>255&t[e++]|(255&t[e++])<<8;class Ou{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,Bc(t=zc(t),32);const e=Cu(t,0),n=Cu(t,2),r=Cu(t,4),i=Cu(t,6),s=Cu(t,8),o=Cu(t,10),a=Cu(t,12),c=Cu(t,14);this.r[0]=8191&e,this.r[1]=8191&(e>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let e=0;e<8;e++)this.pad[e]=Cu(t,16+2*e)}process(t,e,n=!1){const r=n?0:2048,{h:i,r:s}=this,o=s[0],a=s[1],c=s[2],u=s[3],h=s[4],l=s[5],d=s[6],f=s[7],p=s[8],y=s[9],g=Cu(t,e+0),m=Cu(t,e+2),w=Cu(t,e+4),b=Cu(t,e+6),v=Cu(t,e+8),_=Cu(t,e+10),E=Cu(t,e+12),k=Cu(t,e+14);let x=i[0]+(8191&g),A=i[1]+(8191&(g>>>13|m<<3)),S=i[2]+(8191&(m>>>10|w<<6)),C=i[3]+(8191&(w>>>7|b<<9)),O=i[4]+(8191&(b>>>4|v<<12)),T=i[5]+(v>>>1&8191),R=i[6]+(8191&(v>>>14|_<<2)),I=i[7]+(8191&(_>>>11|E<<5)),N=i[8]+(8191&(E>>>8|k<<8)),U=i[9]+(k>>>5|r),P=0,L=P+x*o+A*(5*y)+S*(5*p)+C*(5*f)+O*(5*d);P=L>>>13,L&=8191,L+=T*(5*l)+R*(5*h)+I*(5*u)+N*(5*c)+U*(5*a),P+=L>>>13,L&=8191;let B=P+x*a+A*o+S*(5*y)+C*(5*p)+O*(5*f);P=B>>>13,B&=8191,B+=T*(5*d)+R*(5*l)+I*(5*h)+N*(5*u)+U*(5*c),P+=B>>>13,B&=8191;let M=P+x*c+A*a+S*o+C*(5*y)+O*(5*p);P=M>>>13,M&=8191,M+=T*(5*f)+R*(5*d)+I*(5*l)+N*(5*h)+U*(5*u),P+=M>>>13,M&=8191;let j=P+x*u+A*c+S*a+C*o+O*(5*y);P=j>>>13,j&=8191,j+=T*(5*p)+R*(5*f)+I*(5*d)+N*(5*l)+U*(5*h),P+=j>>>13,j&=8191;let F=P+x*h+A*u+S*c+C*a+O*o;P=F>>>13,F&=8191,F+=T*(5*y)+R*(5*p)+I*(5*f)+N*(5*d)+U*(5*l),P+=F>>>13,F&=8191;let $=P+x*l+A*h+S*u+C*c+O*a;P=$>>>13,$&=8191,$+=T*o+R*(5*y)+I*(5*p)+N*(5*f)+U*(5*d),P+=$>>>13,$&=8191;let D=P+x*d+A*l+S*h+C*u+O*c;P=D>>>13,D&=8191,D+=T*a+R*o+I*(5*y)+N*(5*p)+U*(5*f),P+=D>>>13,D&=8191;let z=P+x*f+A*d+S*l+C*h+O*u;P=z>>>13,z&=8191,z+=T*c+R*a+I*o+N*(5*y)+U*(5*p),P+=z>>>13,z&=8191;let q=P+x*p+A*f+S*d+C*l+O*h;P=q>>>13,q&=8191,q+=T*u+R*c+I*a+N*o+U*(5*y),P+=q>>>13,q&=8191;let Z=P+x*y+A*p+S*f+C*d+O*l;P=Z>>>13,Z&=8191,Z+=T*h+R*u+I*c+N*a+U*o,P+=Z>>>13,Z&=8191,P=(P<<2)+P|0,P=P+L|0,L=8191&P,P>>>=13,B+=P,i[0]=L,i[1]=B,i[2]=M,i[3]=j,i[4]=F,i[5]=$,i[6]=D,i[7]=z,i[8]=q,i[9]=Z}finalize(){const{h:t,pad:e}=this,n=new Uint16Array(10);let r=t[1]>>>13;t[1]&=8191;for(let e=2;e<10;e++)t[e]+=r,r=t[e]>>>13,t[e]&=8191;t[0]+=5*r,r=t[0]>>>13,t[0]&=8191,t[1]+=r,r=t[1]>>>13,t[1]&=8191,t[2]+=r,n[0]=t[0]+5,r=n[0]>>>13,n[0]&=8191;for(let e=1;e<10;e++)n[e]=t[e]+r,r=n[e]>>>13,n[e]&=8191;n[9]-=8192;let i=(1^r)-1;for(let t=0;t<10;t++)n[t]&=i;i=~i;for(let e=0;e<10;e++)t[e]=t[e]&i|n[e];t[0]=65535&(t[0]|t[1]<<13),t[1]=65535&(t[1]>>>3|t[2]<<10),t[2]=65535&(t[2]>>>6|t[3]<<7),t[3]=65535&(t[3]>>>9|t[4]<<4),t[4]=65535&(t[4]>>>12|t[5]<<1|t[6]<<14),t[5]=65535&(t[6]>>>2|t[7]<<11),t[6]=65535&(t[7]>>>5|t[8]<<8),t[7]=65535&(t[8]>>>8|t[9]<<5);let s=t[0]+e[0];t[0]=65535&s;for(let n=1;n<8;n++)s=(t[n]+e[n]|0)+(s>>>16)|0,t[n]=65535&s}update(t){Mc(this);const{buffer:e,blockLen:n}=this,r=(t=zc(t)).length;for(let i=0;i<r;){const s=Math.min(n-this.pos,r-i);if(s!==n)e.set(t.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(e,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(t,i)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){Mc(this),jc(t,this),this.finished=!0;const{buffer:e,h:n}=this;let{pos:r}=this;if(r){for(e[r++]=1;r<16;r++)e[r]=0;this.process(e,0,!0)}this.finalize();let i=0;for(let e=0;e<8;e++)t[i++]=n[e]>>>0,t[i++]=n[e]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}}const Tu=function(t){const e=(e,n)=>t(n).update(zc(e)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=e=>t(e),e}((t=>new Ou(t))),Ru=t=>Uint8Array.from(t.split("").map((t=>t.charCodeAt(0)))),Iu=Ru("expand 16-byte k"),Nu=Ru("expand 32-byte k"),Uu=$c(Iu),Pu=$c(Nu);function Lu(t,e){return t<<e|t>>>32-e}function Bu(t){return t.byteOffset%4==0}Pu.slice();const Mu=2**32-1,ju=new Uint32Array;function Fu(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=function(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e)}(0,e);if("function"!=typeof t)throw new Error("core must be a function");return Uc(i),Uc(o),Pc(s),Pc(n),(e,a,c,u,h=0)=>{Bc(e),Bc(a),Bc(c);const l=c.length;if(u||(u=new Uint8Array(l)),Bc(u),Uc(h),h<0||h>=Mu)throw new Error("arx: counter overflow");if(u.length<l)throw new Error(`arx: output (${u.length}) is shorter than data (${l})`);const d=[];let f,p,y=e.length;if(32===y)f=e.slice(),d.push(f),p=Pu;else{if(16!==y||!n)throw new Error(`arx: invalid 32-byte key, got length=${y}`);f=new Uint8Array(32),f.set(e),f.set(e,16),p=Uu,d.push(f)}Bu(a)||(a=a.slice(),d.push(a));const g=$c(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,g,$c(a.subarray(0,16)),g),a=a.subarray(16)}const m=16-i;if(m!==a.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){const t=new Uint8Array(12);t.set(a,s?0:12-a.length),a=t,d.push(a)}const w=$c(a);for(function(t,e,n,r,i,s,o,a){const c=i.length,u=new Uint8Array(64),h=$c(u),l=Bu(i)&&Bu(s),d=l?$c(i):ju,f=l?$c(s):ju;for(let p=0;p<c;o++){if(t(e,n,r,h,o,a),o>=Mu)throw new Error("arx: counter overflow");const y=Math.min(64,c-p);if(l&&64===y){const t=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let e,n=0;n<16;n++)e=t+n,f[e]=d[e]^h[n];p+=64}else{for(let t,e=0;e<y;e++)t=p+e,s[t]=i[t]^u[e];p+=y}}}(t,p,g,w,c,u,h,o);d.length>0;)d.pop().fill(0);return u}}function $u(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],h=e[0],l=e[1],d=e[2],f=e[3],p=e[4],y=e[5],g=e[6],m=e[7],w=i,b=n[0],v=n[1],_=n[2],E=o,k=a,x=c,A=u,S=h,C=l,O=d,T=f,R=p,I=y,N=g,U=m,P=w,L=b,B=v,M=_;for(let t=0;t<s;t+=2)E=E+S|0,P=Lu(P^E,16),R=R+P|0,S=Lu(S^R,12),E=E+S|0,P=Lu(P^E,8),R=R+P|0,S=Lu(S^R,7),k=k+C|0,L=Lu(L^k,16),I=I+L|0,C=Lu(C^I,12),k=k+C|0,L=Lu(L^k,8),I=I+L|0,C=Lu(C^I,7),x=x+O|0,B=Lu(B^x,16),N=N+B|0,O=Lu(O^N,12),x=x+O|0,B=Lu(B^x,8),N=N+B|0,O=Lu(O^N,7),A=A+T|0,M=Lu(M^A,16),U=U+M|0,T=Lu(T^U,12),A=A+T|0,M=Lu(M^A,8),U=U+M|0,T=Lu(T^U,7),E=E+C|0,M=Lu(M^E,16),N=N+M|0,C=Lu(C^N,12),E=E+C|0,M=Lu(M^E,8),N=N+M|0,C=Lu(C^N,7),k=k+O|0,P=Lu(P^k,16),U=U+P|0,O=Lu(O^U,12),k=k+O|0,P=Lu(P^k,8),U=U+P|0,O=Lu(O^U,7),x=x+T|0,L=Lu(L^x,16),R=R+L|0,T=Lu(T^R,12),x=x+T|0,L=Lu(L^x,8),R=R+L|0,T=Lu(T^R,7),A=A+S|0,B=Lu(B^A,16),I=I+B|0,S=Lu(S^I,12),A=A+S|0,B=Lu(B^A,8),I=I+B|0,S=Lu(S^I,7);let j=0;r[j++]=o+E|0,r[j++]=a+k|0,r[j++]=c+x|0,r[j++]=u+A|0,r[j++]=h+S|0,r[j++]=l+C|0,r[j++]=d+O|0,r[j++]=f+T|0,r[j++]=p+R|0,r[j++]=y+I|0,r[j++]=g+N|0,r[j++]=m+U|0,r[j++]=w+P|0,r[j++]=b+L|0,r[j++]=v+B|0,r[j++]=_+M|0}const Du=Fu($u,{counterRight:!1,counterLength:4,allowShortKeys:!1}),zu=Fu($u,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],c=e[0],u=e[1],h=e[2],l=e[3],d=e[4],f=e[5],p=e[6],y=e[7],g=n[0],m=n[1],w=n[2],b=n[3];for(let t=0;t<20;t+=2)i=i+c|0,g=Lu(g^i,16),d=d+g|0,c=Lu(c^d,12),i=i+c|0,g=Lu(g^i,8),d=d+g|0,c=Lu(c^d,7),s=s+u|0,m=Lu(m^s,16),f=f+m|0,u=Lu(u^f,12),s=s+u|0,m=Lu(m^s,8),f=f+m|0,u=Lu(u^f,7),o=o+h|0,w=Lu(w^o,16),p=p+w|0,h=Lu(h^p,12),o=o+h|0,w=Lu(w^o,8),p=p+w|0,h=Lu(h^p,7),a=a+l|0,b=Lu(b^a,16),y=y+b|0,l=Lu(l^y,12),a=a+l|0,b=Lu(b^a,8),y=y+b|0,l=Lu(l^y,7),i=i+u|0,b=Lu(b^i,16),p=p+b|0,u=Lu(u^p,12),i=i+u|0,b=Lu(b^i,8),p=p+b|0,u=Lu(u^p,7),s=s+h|0,g=Lu(g^s,16),y=y+g|0,h=Lu(h^y,12),s=s+h|0,g=Lu(g^s,8),y=y+g|0,h=Lu(h^y,7),o=o+l|0,m=Lu(m^o,16),d=d+m|0,l=Lu(l^d,12),o=o+l|0,m=Lu(m^o,8),d=d+m|0,l=Lu(l^d,7),a=a+c|0,w=Lu(w^a,16),f=f+w|0,c=Lu(c^f,12),a=a+c|0,w=Lu(w^a,8),f=f+w|0,c=Lu(c^f,7);let v=0;r[v++]=i,r[v++]=s,r[v++]=o,r[v++]=a,r[v++]=g,r[v++]=m,r[v++]=w,r[v++]=b},allowShortKeys:!1}),qu=new Uint8Array(16),Zu=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(qu.subarray(n))},Hu=new Uint8Array(32);function Vu(t,e,n,r,i){const s=t(e,n,Hu),o=Tu.create(s);i&&Zu(o,i),Zu(o,r);const a=new Uint8Array(16),c=Dc(a);Hc(c,0,BigInt(i?i.length:0),!0),Hc(c,8,BigInt(r.length),!0),o.update(a);const u=o.digest();return s.fill(0),u}const Ku=t=>(e,n,r)=>(Bc(e,32),Bc(n),{encrypt:(i,s)=>{const o=i.length,a=o+16;s?Bc(s,a):s=new Uint8Array(a),t(e,n,i,s,1);const c=Vu(t,e,n,s.subarray(0,-16),r);return s.set(c,o),s},decrypt:(i,s)=>{const o=i.length,a=o-16;if(o<16)throw new Error("encrypted data must be at least 16 bytes");s?Bc(s,a):s=new Uint8Array(a);const c=i.subarray(0,-16);if(!qc(i.subarray(-16),Vu(t,e,n,c,r)))throw new Error("invalid tag");return t(e,n,c,s,1),s}});Ku(Du),Ku(zu);class Wu extends Xa{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,ic.hash(t);const n=Ya(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),i.fill(0)}update(t){return ic.exists(this),this.iHash.update(t),this}digestInto(t){ic.exists(this),ic.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=r,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Gu=(t,e,n)=>new Wu(t,e).update(n).digest();Gu.create=(t,e)=>new Wu(t,e);const Ju=new Uint8Array([0]),Yu=new Uint8Array;var Qu=Object.defineProperty,Xu=(t,e)=>{for(var n in e)Qu(t,n,{get:e[n],enumerable:!0})},th=Symbol("verified");function eh(t){if(!(t instanceof Object))return!1;if("number"!=typeof t.kind)return!1;if("string"!=typeof t.content)return!1;if("number"!=typeof t.created_at)return!1;if("string"!=typeof t.pubkey)return!1;if(!t.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let t=0;t<n.length;t++)if("object"==typeof n[t])return!1}return!0}Xu({},{Queue:()=>uh,QueueNode:()=>ch,binarySearch:()=>ah,insertEventIntoAscendingList:()=>oh,insertEventIntoDescendingList:()=>sh,normalizeURL:()=>ih,utf8Decoder:()=>nh,utf8Encoder:()=>rh});var nh=new TextDecoder("utf-8"),rh=new TextEncoder;function ih(t){-1===t.indexOf("://")&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),("80"===e.port&&"ws:"===e.protocol||"443"===e.port&&"wss:"===e.protocol)&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function sh(t,e){const[n,r]=ah(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:t.created_at-e.created_at));return r||t.splice(n,0,e),t}function oh(t,e){const[n,r]=ah(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:e.created_at-t.created_at));return r||t.splice(n,0,e),t}function ah(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(0===s)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var ch=class{value;next=null;prev=null;constructor(t){this.value=t}},uh=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new ch(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const t=this.first;return this.first=t.next,t.value}};function hh(t){return Ga(dc(rh.encode(function(t){if(!eh(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}(t))))}var lh=new class{generateSecretKey(){return qa.utils.randomPrivateKey()}getPublicKey(t){return Ga(qa.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Ga(qa.getPublicKey(e)),n.id=hh(n),n.sig=Ga(qa.sign(hh(n),e)),n[th]=!0,n}verifyEvent(t){if("boolean"==typeof t[th])return t[th];const e=hh(t);if(e!==t.id)return t[th]=!1,!1;try{const n=qa.verify(t.sig,e,t.pubkey);return t[th]=n,n}catch(e){return t[th]=!1,!1}}},dh=lh.generateSecretKey,fh=lh.getPublicKey,ph=lh.finalizeEvent,yh=lh.verifyEvent;function gh(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function mh(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function wh(t){return 2e4<=t&&t<3e4}function bh(t){return 3e4<=t&&t<4e4}function vh(t){return gh(t)?"regular":mh(t)?"replaceable":wh(t)?"ephemeral":bh(t)?"parameterized":"unknown"}function _h(t,e){const n=e instanceof Array?e:[e];return eh(t)&&n.includes(t.kind)||!1}Xu({},{Application:()=>Ul,BadgeAward:()=>Rh,BadgeDefinition:()=>Sl,BlockedRelaysList:()=>al,BookmarkList:()=>il,Bookmarksets:()=>kl,Calendar:()=>$l,CalendarEventRSVP:()=>Dl,ChannelCreation:()=>Ph,ChannelHideMessage:()=>Mh,ChannelMessage:()=>Bh,ChannelMetadata:()=>Lh,ChannelMuteUser:()=>jh,ClassifiedListing:()=>Bl,ClientAuth:()=>yl,CommunitiesList:()=>sl,CommunityDefinition:()=>Zl,CommunityPostApproval:()=>Kh,Contacts:()=>Ah,CreateOrUpdateProduct:()=>Tl,CreateOrUpdateStall:()=>Ol,Curationsets:()=>xl,Date:()=>jl,DirectMessageRelaysList:()=>ll,DraftClassifiedListing:()=>Ml,DraftLong:()=>Il,Emojisets:()=>Nl,EncryptedDirectMessage:()=>Sh,EventDeletion:()=>Ch,FileMetadata:()=>Dh,FileServerPreference:()=>dl,Followsets:()=>vl,GenericRepost:()=>Uh,Genericlists:()=>_l,GiftWrap:()=>$h,HTTPAuth:()=>bl,Handlerinformation:()=>ql,Handlerrecommendation:()=>zl,Highlights:()=>tl,InterestsList:()=>ul,Interestsets:()=>Cl,JobFeedback:()=>Jh,JobRequest:()=>Wh,JobResult:()=>Gh,Label:()=>Vh,LightningPubRPC:()=>pl,LiveChatMessage:()=>zh,LiveEvent:()=>Pl,LongFormArticle:()=>Rl,Metadata:()=>Eh,Mutelist:()=>el,NWCWalletInfo:()=>fl,NWCWalletRequest:()=>gl,NWCWalletResponse:()=>ml,NostrConnect:()=>wl,OpenTimestamps:()=>Fh,Pinlist:()=>nl,PrivateDirectMessage:()=>Nh,ProblemTracker:()=>qh,ProfileBadges:()=>Al,PublicChatsList:()=>ol,Reaction:()=>Th,RecommendRelay:()=>xh,RelayList:()=>rl,Relaysets:()=>El,Report:()=>Zh,Reporting:()=>Hh,Repost:()=>Oh,Seal:()=>Ih,SearchRelaysList:()=>cl,ShortTextNote:()=>kh,Time:()=>Fl,UserEmojiList:()=>hl,UserStatuses:()=>Ll,Zap:()=>Xh,ZapGoal:()=>Yh,ZapRequest:()=>Qh,classifyKind:()=>vh,isEphemeralKind:()=>wh,isKind:()=>_h,isParameterizedReplaceableKind:()=>bh,isRegularKind:()=>gh,isReplaceableKind:()=>mh});var Eh=0,kh=1,xh=2,Ah=3,Sh=4,Ch=5,Oh=6,Th=7,Rh=8,Ih=13,Nh=14,Uh=16,Ph=40,Lh=41,Bh=42,Mh=43,jh=44,Fh=1040,$h=1059,Dh=1063,zh=1311,qh=1971,Zh=1984,Hh=1984,Vh=1985,Kh=4550,Wh=5999,Gh=6999,Jh=7e3,Yh=9041,Qh=9734,Xh=9735,tl=9802,el=1e4,nl=10001,rl=10002,il=10003,sl=10004,ol=10005,al=10006,cl=10007,ul=10015,hl=10030,ll=10050,dl=10096,fl=13194,pl=21e3,yl=22242,gl=23194,ml=23195,wl=24133,bl=27235,vl=3e4,_l=30001,El=30002,kl=30003,xl=30004,Al=30008,Sl=30009,Cl=30015,Ol=30017,Tl=30018,Rl=30023,Il=30024,Nl=30030,Ul=30078,Pl=30311,Ll=30315,Bl=30402,Ml=30403,jl=31922,Fl=31923,$l=31924,Dl=31925,zl=31989,ql=31990,Zl=34550;function Hl(t,e){if(t.ids&&-1===t.ids.indexOf(e.id))return!1;if(t.kinds&&-1===t.kinds.indexOf(e.kind))return!1;if(t.authors&&-1===t.authors.indexOf(e.pubkey))return!1;for(let n in t)if("#"===n[0]){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([t,e])=>t===n.slice(1)&&-1!==r.indexOf(e))))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function Vl(t,e){for(let n=0;n<t.length;n++)if(Hl(t[n],e))return!0;return!1}function Kl(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function Wl(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function Gl(t){let e=t.slice(0,22).indexOf('"EVENT"');if(-1===e)return null;let n=t.slice(e+7+1).indexOf('"');if(-1===n)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(-1===i)return null;let s=r+1+i;return t.slice(r+1,s)}function Jl(t,e){return e===Kl(t,"id")}function Yl(t,e){return e===Kl(t,"pubkey")}function Ql(t,e){return e===Wl(t,"kind")}function Xl(t,e){return{kind:yl,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}Xu({},{getHex64:()=>Kl,getInt:()=>Wl,getSubscriptionId:()=>Gl,matchEventId:()=>Jl,matchEventKind:()=>Ql,matchEventPubkey:()=>Yl}),Xu({},{makeAuthEvent:()=>Xl});try{WebSocket}catch{}try{WebSocket}catch{}var td={};Xu(td,{BECH32_REGEX:()=>rd,Bech32MaxSize:()=>nd,NostrTypeGuard:()=>ed,decode:()=>id,encodeBytes:()=>hd,naddrEncode:()=>fd,neventEncode:()=>dd,noteEncode:()=>cd,nprofileEncode:()=>ld,npubEncode:()=>ad,nsecEncode:()=>od});var ed={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},nd=5e3,rd=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function id(t){let{prefix:e,words:n}=Nc.decode(t,nd),r=new Uint8Array(Nc.fromWords(n));switch(e){case"nprofile":{let t=sd(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ga(t[0][0]),relays:t[1]?t[1].map((t=>nh.decode(t))):[]}}}case"nevent":{let t=sd(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(t[2]&&32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(t[3]&&4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ga(t[0][0]),relays:t[1]?t[1].map((t=>nh.decode(t))):[],author:t[2]?.[0]?Ga(t[2][0]):void 0,kind:t[3]?.[0]?parseInt(Ga(t[3][0]),16):void 0}}}case"naddr":{let t=sd(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!t[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!t[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:nh.decode(t[0][0]),pubkey:Ga(t[2][0]),kind:parseInt(Ga(t[3][0]),16),relays:t[1]?t[1].map((t=>nh.decode(t))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:Ga(r)};default:throw new Error(`unknown prefix ${e}`)}}function sd(t){let e={},n=t;for(;n.length>0;){let t=n[0],r=n[1],i=n.slice(2,2+r);if(n=n.slice(2+r),i.length<r)throw new Error(`not enough data to read on TLV ${t}`);e[t]=e[t]||[],e[t].push(i)}return e}function od(t){return hd("nsec",t)}function ad(t){return hd("npub",Ja(t))}function cd(t){return hd("note",Ja(t))}function ud(t,e){let n=Nc.toWords(e);return Nc.encode(t,n,nd)}function hd(t,e){return ud(t,e)}function ld(t){return ud("nprofile",pd({0:[Ja(t.pubkey)],1:(t.relays||[]).map((t=>rh.encode(t)))}))}function dd(t){let e;return void 0!==t.kind&&(e=function(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=255&t,e}(t.kind)),ud("nevent",pd({0:[Ja(t.id)],1:(t.relays||[]).map((t=>rh.encode(t))),2:t.author?[Ja(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function fd(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),ud("naddr",pd({0:[rh.encode(t.identifier)],1:(t.relays||[]).map((t=>rh.encode(t))),2:[Ja(t.pubkey)],3:[new Uint8Array(e)]}))}function pd(t){let e=[];return Object.entries(t).reverse().forEach((([t,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(t)],0),r.set([n.length],1),r.set(n,2),e.push(r)}))})),Qa(...e)}var yd={};async function gd(t,e,n){const r=t instanceof Uint8Array?Ga(t):t,i=wd(Ca.getSharedSecret(r,"02"+e));let s=Uint8Array.from(ec(16)),o=rh.encode(n),a=xu(i,s).encrypt(o);return`${Ac.encode(new Uint8Array(a))}?iv=${Ac.encode(new Uint8Array(s.buffer))}`}async function md(t,e,n){const r=t instanceof Uint8Array?Ga(t):t;let[i,s]=n.split("?iv="),o=wd(Ca.getSharedSecret(r,"02"+e)),a=Ac.decode(s),c=Ac.decode(i),u=xu(o,a).decrypt(c);return nh.decode(u)}function wd(t){return t.slice(1,33)}Xu(yd,{decrypt:()=>md,encrypt:()=>gd}),Xu({},{NIP05_REGEX:()=>vd,isNip05:()=>_d,isValid:()=>Ad,queryProfile:()=>xd,searchDomain:()=>kd,useFetchImplementation:()=>Ed});var bd,vd=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,_d=t=>vd.test(t||"");try{bd=fetch}catch(t){}function Ed(t){bd=t}async function kd(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await bd(n,{redirect:"manual"});if(200!==r.status)throw Error("Wrong response code");return(await r.json()).names}catch(t){return{}}}async function xd(t){const e=t.match(vd);if(!e)return null;const[,n="_",r]=e;try{const t=`https://${r}/.well-known/nostr.json?name=${n}`,e=await bd(t,{redirect:"manual"});if(200!==e.status)throw Error("Wrong response code");const i=await e.json(),s=i.names[n];return s?{pubkey:s,relays:i.relays?.[s]}:null}catch(t){return null}}async function Ad(t,e){const n=await xd(e);return!!n&&n.pubkey===t}function Sd(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if("e"===s[0]&&s[1]){const[t,i,o,a,c]=s,u={id:i,relays:o?[o]:[],author:c};if("root"===a){e.root=u;continue}if("reply"===a){e.reply=u;continue}if("mention"===a){e.mentions.push(u);continue}n?r=u:n=u,e.mentions.push(u)}else{if("q"===s[0]&&s[1]){const[t,n,r]=s;e.quotes.push({id:n,relays:r?[r]:[]})}"p"===s[0]&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((t=>{if(!t)return;let n=e.mentions.indexOf(t);if(-1!==n&&e.mentions.splice(n,1),t.author){let n=e.profiles.find((e=>e.pubkey===t.author));n&&n.relays&&(t.relays||(t.relays=[]),n.relays.forEach((e=>{-1===t.relays?.indexOf(e)&&t.relays.push(e)})),n.relays=t.relays)}})),e.mentions.forEach((t=>{if(t.author){let n=e.profiles.find((e=>e.pubkey===t.author));n&&n.relays&&(t.relays||(t.relays=[]),n.relays.forEach((e=>{-1===t.relays.indexOf(e)&&t.relays.push(e)})),n.relays=t.relays)}})),e}Xu({},{parse:()=>Sd}),Xu({},{fetchRelayInformation:()=>Od,useFetchImplementation:()=>Cd});try{fetch}catch{}function Cd(t){}async function Od(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function Td(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(0!==r){e+=Math.clz32(r);break}e+=32}return e}function Rd(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const t=Math.floor((new Date).getTime()/1e3);if(t!==r.created_at&&(n=0,r.created_at=t),i[1]=(++n).toString(),r.id=Id(r),Td(r.id)>=e)break}return r}function Id(t){return Ga(dc(rh.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}function Nd(t,e,n,r){return ph({kind:Oh,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:""===t.content?"":JSON.stringify(e),created_at:t.created_at},r)}function Ud(t){if(t.kind!==Oh)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const i=t.tags[r];i.length>=2&&("e"===i[0]&&void 0===e?e=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==e?{id:e[1],relays:[e[2],n?.[2]].filter((t=>"string"==typeof t)),author:n?.[1]}:void 0}function Pd(t,{skipVerification:e}={}){const n=Ud(t);if(void 0===n||""===t.content)return;let r;try{r=JSON.parse(t.content)}catch(t){return}return r.id===n.id&&(e||yh(r))?r:void 0}Xu({},{fastEventHash:()=>Id,getPow:()=>Td,minePow:()=>Rd}),Xu({},{finishRepostEvent:()=>Nd,getRepostedEvent:()=>Pd,getRepostedEventPointer:()=>Ud}),Xu({},{NOSTR_URI_REGEX:()=>Ld,parse:()=>Md,test:()=>Bd});var Ld=new RegExp(`nostr:(${rd.source})`);function Bd(t){return"string"==typeof t&&new RegExp(`^${Ld.source}$`).test(t)}function Md(t){const e=t.match(new RegExp(`^${Ld.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:id(e[1])}}function jd(t,e,n){const r=e.tags.filter((t=>t.length>=2&&("e"===t[0]||"p"===t[0])));return ph({...t,kind:Th,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Fd(t){if(t.kind!==Th)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const i=t.tags[r];i.length>=2&&("e"===i[0]&&void 0===e?e=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==e&&void 0!==n?{id:e[1],relays:[e[2],n[2]].filter((t=>void 0!==t)),author:n[1]}:void 0}Xu({},{finishReactionEvent:()=>jd,getReactedEventPointer:()=>Fd}),Xu({},{matchAll:()=>Dd,regex:()=>$d,replaceAll:()=>zd});var $d=()=>new RegExp(`\\b${Ld.source}\\b`,"g");function*Dd(t){const e=t.matchAll($d());for(const t of e)try{const[e,n]=t;yield{uri:e,value:n,decoded:id(n),start:t.index,end:t.index+e.length}}catch(t){}}function zd(t,e){return t.replaceAll($d(),((t,n)=>e({uri:t,value:n,decoded:id(n)})))}Xu({},{channelCreateEvent:()=>qd,channelHideMessageEvent:()=>Vd,channelMessageEvent:()=>Hd,channelMetadataEvent:()=>Zd,channelMuteUserEvent:()=>Kd});var qd=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return ph({kind:Ph,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Zd=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return ph({kind:Lh,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Hd=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),ph({kind:Bh,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Vd=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return ph({kind:Mh,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Kd=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return ph({kind:jh,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)};Xu({},{EMOJI_SHORTCODE_REGEX:()=>Gd,matchAll:()=>Yd,regex:()=>Jd,replaceAll:()=>Qd});var Wd,Gd=/:(\w+):/,Jd=()=>new RegExp(`\\B${Gd.source}\\B`,"g");function*Yd(t){const e=t.matchAll(Jd());for(const t of e)try{const[e,n]=t;yield{shortcode:e,name:n,start:t.index,end:t.index+e.length}}catch(t){}}function Qd(t,e){return t.replaceAll(Jd(),((t,n)=>e({shortcode:t,name:n})))}Xu({},{useFetchImplementation:()=>Xd,validateGithub:()=>tf});try{Wd=fetch}catch{}function Xd(t){Wd=t}async function tf(t,e,n){try{return await(await Wd(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch(t){return!1}}var ef={};Xu(ef,{decrypt:()=>hf,encrypt:()=>uf,getConversationKey:()=>sf,v2:()=>lf});var nf=1,rf=65535;function sf(t,e){const n=Ca.getSharedSecret(t,"02"+e).subarray(1,33);return r=dc,i=n,s="nip44-v2",ic.hash(r),void 0===s&&(s=new Uint8Array(r.outputLen)),Gu(r,Ya(s),Ya(i));var r,i,s}function of(t,e){const n=function(t,e,n,r=32){if(ic.hash(t),ic.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);void 0===n&&(n=Yu);const s=new Uint8Array(i*t.outputLen),o=Gu.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let e=0;e<i;e++)Ju[0]=e+1,a.update(0===e?Yu:c).update(n).update(Ju).digestInto(c),s.set(c,t.outputLen*e),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Ju.fill(0),s.slice(0,r)}(dc,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function af(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function cf(t,e,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=Qa(n,e);return Gu(dc,t,r)}function uf(t,e,n=ec(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=of(e,n),o=function(t){const e=rh.encode(t),n=e.length,r=function(t){if(!Number.isSafeInteger(t)||t<nf||t>rf)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}(n);return Qa(r,e,new Uint8Array(af(n)-n))}(t),a=Du(r,i,o),c=cf(s,a,n);return Ac.encode(Qa(new Uint8Array([2]),n,a,c))}function hf(t,e){const{nonce:n,ciphertext:r,mac:i}=function(t){if("string"!=typeof t)throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if("#"===t[0])throw new Error("unknown encryption version");let n;try{n=Ac.decode(t)}catch(t){throw new Error("invalid base64: "+t.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(2!==i)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=of(e,n);if(!qc(cf(a,r,n),i))throw new Error("invalid MAC");return function(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<nf||e>rf||n.length!==e||t.length!==2+af(e))throw new Error("invalid padding");return nh.decode(n)}(Du(s,o,r))}var lf={utils:{getConversationKey:sf,calcPaddedLen:af},encrypt:uf,decrypt:hf};function df(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function ff(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await gd(e,t,JSON.stringify(r)),s={kind:gl,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return ph(s,e)}Xu({},{makeNwcRequestEvent:()=>ff,parseConnectionString:()=>df});var pf;Xu({},{getZapEndpoint:()=>gf,makeZapReceipt:()=>bf,makeZapRequest:()=>mf,useFetchImplementation:()=>yf,validateZapRequest:()=>wf});try{pf=fetch}catch{}function yf(t){pf=t}async function gf(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:t}=Nc.decode(n,1e3),r=Nc.fromWords(t);e=nh.decode(r)}else{if(!r)return null;{let[t,n]=r.split("@");e=new URL(`/.well-known/lnurlp/${t}`,`https://${n}`).toString()}}let i=await pf(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch(t){}return null}function mf({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function wf(t){let e;try{e=JSON.parse(t)}catch(t){return"Invalid zap request JSON."}if(!eh(e))return"Zap request is not a valid Nostr event.";if(!yh(e))return"Invalid signature on zap request.";let n=e.tags.find((([t,e])=>"p"===t&&e));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([t,e])=>"e"===t&&e));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([t,e])=>"relays"===t&&e))?null:"Zap request doesn't have a 'relays' tag."}function bf({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([t])=>"e"===t||"p"===t||"a"===t)),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}Xu({},{createRumor:()=>Af,createSeal:()=>Sf,createWrap:()=>Cf,unwrapEvent:()=>Rf,unwrapManyEvents:()=>If,wrapEvent:()=>Of,wrapManyEvents:()=>Tf});var vf=()=>Math.round(Date.now()/1e3),_f=()=>Math.round(vf()-172800*Math.random()),Ef=(t,e)=>sf(t,e),kf=(t,e,n)=>uf(JSON.stringify(t),Ef(e,n)),xf=(t,e)=>JSON.parse(hf(t.content,Ef(e,t.pubkey)));function Af(t,e){const n={created_at:vf(),content:"",tags:[],...t,pubkey:fh(e)};return n.id=hh(n),n}function Sf(t,e,n){return ph({kind:Ih,content:kf(t,e,n),created_at:_f(),tags:[]},e)}function Cf(t,e){const n=dh();return ph({kind:$h,content:kf(t,n,e),created_at:_f(),tags:[["p",e]]},n)}function Of(t,e,n){return Cf(Sf(Af(t,e),e,n),n)}function Tf(t,e,n){if(!n||0===n.length)throw new Error("At least one recipient is required.");const r=fh(e),i=[Of(t,e,r)];return n.forEach((n=>{i.push(Of(t,e,n))})),i}function Rf(t,e){const n=xf(t,e);return xf(n,e)}function If(t,e){let n=[];return t.forEach((t=>{n.push(Rf(t,e))})),n.sort(((t,e)=>t.created_at-e.created_at)),n}Xu({},{getToken:()=>Uf,hashPayload:()=>$f,unpackEventFromToken:()=>Lf,validateEvent:()=>zf,validateEventKind:()=>Mf,validateEventMethodTag:()=>Ff,validateEventPayloadTag:()=>Df,validateEventTimestamp:()=>Bf,validateEventUrlTag:()=>jf,validateToken:()=>Pf});var Nf="Nostr ";async function Uf(t,e,n,r=!1,i){const s={kind:bl,tags:[["u",t],["method",e]],created_at:Math.round((new Date).getTime()/1e3),content:""};i&&s.tags.push(["payload",$f(i)]);const o=await n(s);return(r?Nf:"")+Ac.encode(rh.encode(JSON.stringify(o)))}async function Pf(t,e,n){const r=await Lf(t).catch((t=>{throw t}));return await zf(r,e,n).catch((t=>{throw t}))}async function Lf(t){if(!t)throw new Error("Missing token");t=t.replace(Nf,"");const e=nh.decode(Ac.decode(t));if(!e||0===e.length||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Bf(t){return!!t.created_at&&Math.round((new Date).getTime()/1e3)-t.created_at<60}function Mf(t){return t.kind===bl}function jf(t,e){const n=t.tags.find((t=>"u"===t[0]));return!!n&&n.length>0&&n[1]===e}function Ff(t,e){const n=t.tags.find((t=>"method"===t[0]));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function $f(t){return Ga(dc(rh.encode(JSON.stringify(t))))}function Df(t,e){const n=t.tags.find((t=>"payload"===t[0]));if(!n)return!1;const r=$f(e);return n.length>0&&n[1]===r}async function zf(t,e,n,r){if(!yh(t))throw new Error("Invalid nostr event, signature invalid");if(!Mf(t))throw new Error("Invalid nostr event, kind invalid");if(!Bf(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!jf(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Ff(t,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!Df(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var qf=__webpack_require__(6654);function Zf(t,e,n="write"){if(!t.outboxTracker)return;const r=t.outboxTracker.data.get(e);return r?"write"===n?r.writeRelays:r.readRelays:void 0}function Hf(t,e,n,{count:r,preferredRelays:i}={}){r??=2,i??=new Set;const s=t.pool,o=s.connectedRelays();o.forEach((t=>{i.add(t.url)}));const a=new Map,{pubkeysToRelays:c,authorsMissingRelays:u}=function(t,e,n="read"){const r=new Map,i=new Set;return e.forEach((e=>{const s=Zf(t,e,n);s&&s.size>0?(s.forEach((t=>{(r.get(t)||new Set).add(e)})),r.set(e,s)):i.add(e)})),{pubkeysToRelays:r,authorsMissingRelays:i}}(t,e,n),h=function(t,e){const n=new Map;return e.forEach((e=>{const r=Zf(t,e);r&&r.forEach((t=>{const e=n.get(t)||0;n.set(t,e+1)}))})),Array.from(n.entries()).sort(((t,e)=>e[1]-t[1])).map((t=>t[0]))}(t,e),l=(t,e)=>{const n=a.get(e)||[];n.push(t),a.set(e,n)};for(const[t,e]of c.entries()){let n=r;for(const r of o)e.has(r.url)&&(l(t,r.url),n--);for(const r of e)a.has(r)&&(l(t,r),n--);if(!(n<=0))for(const r of h){if(n<=0)break;e.has(r)&&(l(t,r),n--)}}for(const t of u)s.permanentAndConnectedRelays().forEach((e=>{const n=a.get(e.url)||[];n.push(t),a.set(e.url,n)}));return a}function Vf(t){try{return Kf(t)}catch{return}}function Kf(t){let e=function(t,e={}){if("string"!=typeof(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e}).defaultProtocol||e.defaultProtocol.endsWith(":")||(e.defaultProtocol=`${e.defaultProtocol}:`),t=t.trim(),/^data:/i.test(t))return Qf(t,e);if(Yf(t))return t;const n=t.startsWith("//");!n&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&"https:"===r.protocol&&(r.protocol="http:"),e.forceHttps&&"http:"===r.protocol&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){const t=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let e=0,n="";for(;;){const i=t.exec(r.pathname);if(!i)break;const s=i[0],o=i.index;n+=r.pathname.slice(e,o).replace(/\/{2,}/g,"/"),n+=s,e=o+s.length}n+=r.pathname.slice(e,r.pathname.length).replace(/\/{2,}/g,"/"),r.pathname=n}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(!0===e.removeDirectoryIndex&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let t=r.pathname.split("/");const n=t[t.length-1];Gf(n,e.removeDirectoryIndex)&&(t=t.slice(0,-1),r.pathname=t.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const t of[...r.searchParams.keys()])Gf(t,e.removeQueryParameters)&&r.searchParams.delete(t);if(Array.isArray(e.keepQueryParameters)||!0!==e.removeQueryParameters||(r.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const t of[...r.searchParams.keys()])Gf(t,e.keepQueryParameters)||r.searchParams.delete(t);if(e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,"")),e.removeExplicitPort&&r.port&&(r.port="");const i=t;return t=r.toString(),e.removeSingleSlash||"/"!==r.pathname||i.endsWith("/")||""!==r.hash||(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||"/"===r.pathname)&&""===r.hash&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),n&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}(t.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function Wf(t){const e=new Set;for(const n of t)try{e.add(Kf(n))}catch{}return Array.from(e)}__webpack_require__(6705);var Gf=(t,e)=>e.some((e=>e instanceof RegExp?e.test(t):e===t)),Jf=new Set(["https:","http:","file:"]),Yf=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!e.includes(".")&&!Jf.has(e)}catch{return!1}},Qf=(t,{stripHash:e})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let r=n.groups?.type??"",i=n.groups?.data??"",s=n.groups?.hash??"";const o=r.split(";");s=e?"":s;let a=!1;"base64"===o[o.length-1]&&(o.pop(),a=!0);const c=o.shift()?.toLowerCase()??"",u=[...o.map((t=>{let[e,n=""]=t.split("=").map((t=>t.trim()));return"charset"===e&&(n=n.toLowerCase(),"us-ascii"===n)?"":`${e}${n?`=${n}`:""}`})).filter(Boolean)];return a&&u.push("base64"),(u.length>0||c&&"text/plain"!==c)&&u.unshift(c),`data:${u.join(";")},${a?i.trim():i}${s?`#${s}`:""}`},Xf=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(t,e,n,r){super(t),this.errors=e,this.publishedToRelays=n,this.intendedRelaySet=r}get relayErrors(){const t=[];for(const[e,n]of this.errors)t.push(`${e.url}: ${n}`);return t.join("\n")}},tp=class t{relays;debug;ndk;pool;constructor(t,e,n){this.relays=t,this.ndk=e,this.pool=n??e.pool,this.debug=e.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map((t=>t.url))}static fromRelayUrls(e,n,r=!0,i){if(!(i=i??n.pool))throw new Error("No pool provided");const s=new Set;for(const t of e){const o=i.relays.get(Kf(t));if(o)o.status<5&&r&&o.connect(),s.add(o);else{const r=new Ip(Kf(t),n?.relayAuthDefaultPolicy,n);i.useTemporaryRelay(r,void 0,"requested from fromRelayUrls "+e),s.add(r)}}return new t(new Set(s),n,i)}async publish(t,e,n=1){const r=new Set,i=new Map,s=t.isEphemeral();t.publishStatus="pending";const o=Array.from(this.relays).map((n=>new Promise((o=>{n.publish(t,e).then((t=>{r.add(n),o()})).catch((t=>{s||i.set(n,t),o()}))}))));if(await Promise.all(o),r.size<n){if(!s){const e=new Xf("Not enough relays received the event",i,r,this);throw t.publishStatus="error",t.publishError=e,this.ndk.emit("event:publish-failed",t,e,this.relayUrls),e}}else t.emit("published",{relaySet:this,publishedToRelays:r});return r}get size(){return this.relays.size}},ep=ao("ndk:outbox:calculate");function np(t,e,n){return function(t,e,n){const r=new Map,i=new Set;if(e.forEach((t=>{t.authors&&t.authors.forEach((t=>i.add(t)))})),i.size>0){const n=function(t,e,n=2){return Hf(t,e,"write",{count:n})}(t,Array.from(i));for(const t of n.keys())r.set(t,[]);for(const t of e)if(t.authors)for(const[e,i]of n.entries()){const n=t.authors.filter((t=>i.includes(t)));r.set(e,[...r.get(e),{...t,authors:n}])}else for(const e of n.keys())r.set(e,[...r.get(e),t])}else t.explicitRelayUrls&&t.explicitRelayUrls.forEach((t=>{r.set(t,e)}));return 0===r.size&&n.permanentAndConnectedRelays().slice(0,5).forEach((t=>{r.set(t.url,e)})),r}(t,e,n)}async function rp(t){return""}function ip(){if(void 0===this.kind)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function sp(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function op(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var ap,cp="nip44";async function up(t,e,n=cp){if(!this.ndk)throw new Error("No NDK instance found!");if(e||(await this.ndk.assertSigner(),e=this.ndk.signer),!t){const e=this.getMatchingTags("p");if(1!==e.length)throw new Error("No recipient could be determined and no explicit recipient was provided");t=this.ndk.getUser({pubkey:e[0][1]})}this.content=await(e?.encrypt(t,this.content,n))}async function hp(t,e,n){if(!this.ndk)throw new Error("No NDK instance found!");e||(await this.ndk.assertSigner(),e=this.ndk.signer),t||(t=this.author),n||(n=this.content.match(/\?iv=/)?"nip04":"nip44"),this.content=await(e?.decrypt(t,this.content,n))}function lp(t=2){let e=[];return this.onRelays.length>0?e=this.onRelays.map((t=>t.url)):this.relay&&(e=[this.relay.url]),e.length>t&&(e=e.slice(0,t)),this.isParamReplaceable()?td.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?td.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):td.noteEncode(this.tagId())}async function dp(t=!0,e){if(!e&&t){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const n=new Ap(this.ndk,{kind:(r=this,1===r.kind?6:16)});var r;return n.content=JSON.stringify(this.rawEvent()),n.tag(this),1!==this.kind&&n.tags.push(["k",`${this.kind}`]),e&&await n.sign(e),t&&await n.publish(),n}function fp(t){return t.getMatchingTags("e").some((t=>t[3]))}async function pp(t,e){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(t,e);if(0===n.length)return;const[r,i,s]=n[0];return await this.ndk.fetchEvent(i,{},void 0)}async function yp(t){if(!this.ndk)throw new Error("NDK instance not found");const e=function(t,e){e??=t.tagType();const n=t.tags.find((t=>"root"===t[3]));if(!n){if(fp(t))return;const n=t.getMatchingTags(e);if(n.length<3)return n[0]}return n}(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}async function gp(t){if(!this.ndk)throw new Error("NDK instance not found");const e=function(t,e){e??=t.tagType();let n=t.tags.find((t=>"reply"===t[3]));if(n)return n;if(n||(n=t.tags.find((t=>"root"===t[3]))),!n){if(fp(t))return;const n=t.getMatchingTags(e);if(1===n.length)return n[0];if(2===n.length)return n[1]}}(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}function mp(t=!1,e=!1){const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return t&&n.push(this.sig),e&&n.push(this.id),JSON.stringify(n)}var wp={},bp=/^[a-f0-9]{64}$/;function vp(){if("number"!=typeof this.kind)return!1;if("string"!=typeof this.content)return!1;if("number"!=typeof this.created_at)return!1;if("string"!=typeof this.pubkey)return!1;if(!this.pubkey.match(bp))return!1;if(!Array.isArray(this.tags))return!1;for(let t=0;t<this.tags.length;t++){const e=this.tags[t];if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if("object"==typeof e[t])return!1}return!0}var _p=new qf.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function Ep(t){if("boolean"==typeof this.signatureVerified)return this.signatureVerified;const e=_p.get(this.id);if(null!==e)return this.signatureVerified=!!e;try{if(!this.ndk?.asyncSigVerification){const t=_((new TextEncoder).encode(this.serialize())),e=vn.verify(this.sig,t,this.pubkey);return e?_p.set(this.id,this.sig):_p.set(this.id,!1),this.signatureVerified=e}(async function(t){return new Promise((e=>{const n=t.serialize();let r=!1;wp[t.id]||(wp[t.id]={event:t,resolves:[]},r=!0),wp[t.id].resolves.push(e),r&&ap.postMessage({serialized:n,id:t.id,sig:t.sig,pubkey:t.pubkey})}))})(this).then((e=>{t&&(this.signatureVerified=e,e&&_p.set(this.id,this.sig)),e||(this.ndk.emit("event:invalid-sig",this),_p.set(this.id,!1))}))}catch(t){return this.signatureVerified=!1}}function kp(){return t=this.serialize(),u(_((new TextEncoder).encode(t)));var t}var xp=[3],Ap=class t extends oo.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(e,n){super(),this.ndk=e,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof t&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(e,n){return new t(e,function(t){const e=JSON.parse(t),n={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};return e.length>=7&&(n.sig=e[6]),e.length>=8&&(n.id=e[7]),n}(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,e,n){let r=["i"],i=["k"];switch(e){case"url":const n=new URL(t);n.hash="",r.push(n.toString()),i.push(`${n.protocol}//${n.host}`);break;case"hashtag":r.push(`#${t.toLowerCase()}`),i.push("#");break;case"geohash":r.push(`geo:${t.toLowerCase()}`),i.push("geo");break;case"isbn":r.push(`isbn:${t.replace(/-/g,"")}`),i.push("isbn");break;case"podcast:guid":r.push(`podcast:guid:${t}`),i.push("podcast:guid");break;case"podcast:item:guid":r.push(`podcast:item:guid:${t}`),i.push("podcast:item:guid");break;case"podcast:publisher:guid":r.push(`podcast:publisher:guid:${t}`),i.push("podcast:publisher:guid");break;case"isan":r.push(`isan:${t.split("-").slice(0,4).join("-")}`),i.push("isan");break;case"doi":r.push(`doi:${t.toLowerCase()}`),i.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${e}`)}n&&r.push(n),this.tags.push(r),this.tags.push(i)}tag(e,n,r,i){let s=[];if(void 0!==e.fetchProfile){i??="p";const t=[i,e.pubkey];n&&t.push("",n),s.push(t)}else if(e instanceof t){const t=e;r??=t?.pubkey===this.pubkey,s=t.referenceTags(n,r,i);for(const e of t.getMatchingTags("p"))e[1]!==this.pubkey&&(this.tags.find((t=>"p"===t[0]&&t[1]===e[1]))||this.tags.push(["p",e[1]]))}else{if(!Array.isArray(e))throw new Error("Invalid argument",e);s=[e]}this.tags=function(t,e){const n=new Map,r=(t,e)=>t.every(((t,n)=>t===e[n]));return t.concat(e).forEach((t=>{for(const[e,i]of n)if(r(i,t)||r(t,i))return void(t.length>=i.length&&n.set(e,t));n.set((t=>t.join(","))(t),t)})),Array.from(n.values())}(this.tags,s)}async toNostrEvent(t){if(!t&&""===this.pubkey){const t=await(this.ndk?.signer?.user());this.pubkey=t?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:e,tags:n}=await this.generateTags();this.content=e||"",this.tags=n;try{this.id=this.getEventHash()}catch(t){}return this.rawEvent()}serialize=mp.bind(this);getEventHash=kp.bind(this);validate=vp.bind(this);verifySignature=Ep.bind(this);isReplaceable=ip.bind(this);isEphemeral=sp.bind(this);isParamReplaceable=op.bind(this);encode=lp.bind(this);encrypt=up.bind(this);decrypt=hp.bind(this);getMatchingTags(t,e){const n=this.tags.filter((e=>e[0]===t));return void 0===e?n:n.filter((t=>t[3]===e))}hasTag(t,e){return this.tags.some((n=>n[0]===t&&(!e||n[3]===e)))}tagValue(t){const e=this.getMatchingTags(t);if(0!==e.length)return e[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t){const e=Array.isArray(t)?t:[t];this.tags=this.tags.filter((t=>!e.includes(t[0])))}async sign(t){t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk.signer);const e=await this.toNostrEvent();return this.sig=await t.sign(e),this.sig}async publishReplaceable(t,e,n){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,e,n)}async publish(t,e,n){if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if(t||(t=this.ndk.devWriteRelaySet||await async function(t,e){const n=new Set,r=await async function(t,e,n="write"){if(t.outboxTracker)return t.outboxTracker.data.has(e)||await t.outboxTracker.trackUsers([e]),Zf(t,e,n)}(t,e.pubkey);r&&r.forEach((e=>{const r=t.pool?.getRelay(e);r&&n.add(r)}));let i=e.tags.filter((t=>["a","e"].includes(t[0]))).map((t=>t[2])).filter((t=>t&&t.startsWith("wss://"))).filter((t=>{try{return new URL(t),!0}catch{return!1}})).map((t=>Kf(t)));i=Array.from(new Set(i)).slice(0,5),i.forEach((e=>{const r=t.pool?.getRelay(e,!0,!0);r&&(ep("Adding relay hint %s",e),n.add(r))}));const s=e.getMatchingTags("p").map((t=>t[1]));return s.length<5?Array.from(Hf(t,s,"read",{preferredRelays:new Set(r)}).keys()).forEach((e=>{const r=t.pool?.getRelay(e,!1,!0);r&&(ep("Adding p-tagged relay %s",e),n.add(r))})):ep("Too many p-tags to consider %d",s.length),t.pool?.permanentAndConnectedRelays().forEach((t=>n.add(t))),new tp(n,t)}(this.ndk,this)),5===this.kind&&this.ndk.cacheAdapter?.deleteEventIds){const t=this.getMatchingTags("e").map((t=>t[1]));this.ndk.cacheAdapter.deleteEventIds(t)}const r=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent)try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(t){console.error("Error adding unpublished event to cache",t)}5===this.kind&&this.ndk.cacheAdapter?.deleteEventIds&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map((t=>t[1]))),this.ndk.subManager.dispatchEvent(r,void 0,!0);const i=await t.publish(this,e,n);return i.forEach((t=>this.ndk?.subManager.seenEvent(this.id,t))),i}async generateTags(){let t=[];const e=await async function(t,e=[]){const n=[],r=t=>{e.find((e=>["q",t[0]].includes(e[0])&&e[1]===t[1]))||e.push(t)};return t=t.replace(/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,(t=>{try{const e=t.split(/(@|nostr:)/)[2],{type:i,data:s}=td.decode(e);let o;switch(i){case"npub":o=["p",s];break;case"nprofile":o=["p",s.pubkey];break;case"note":n.push(new Promise((async t=>{r(["e",s,await rp(),"mention"]),t()})));break;case"nevent":n.push(new Promise((async t=>{const{id:e,author:n}=s;let{relays:i}=s;i&&0!==i.length||(i=[await rp()]),r(["e",e,i[0],"mention"]),n&&r(["p",n]),t()})));break;case"naddr":n.push(new Promise((async t=>{const e=[s.kind,s.pubkey,s.identifier].join(":");let n=s.relays??[];0===n.length&&(n=[await rp()]),r(["a",e,n[0],"mention"]),r(["p",s.pubkey]),t()})));break;default:return t}return o&&r(o),`nostr:${e}`}catch(e){return t}})),await Promise.all(n),{content:t=t.replace(/(?<=\s|^)(#[^\s!@#$%^&*()=+./,[{\]};:'"?><]+)/g,((t,n)=>{const r=["t",n.slice(1)];return e.find((t=>t[0]===r[0]&&t[1]===r[1]))||e.push(r),t})),tags:e}}(this.content,this.tags),n=e.content;if(t=e.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const e=this.tagValue("title");let n=[...Array(e?6:16)].map((()=>Math.random().toString(36)[2])).join("");e&&e.length>0&&(n=e.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+n),t.push(["d",n])}if(this.shouldAddClientTag){const e=["client",this.ndk.clientName??""];this.ndk.clientNip89&&e.push(this.ndk.clientNip89),t.push(e)}else t=t.filter((t=>"client"!==t[0]));return{content:n||"",tags:t}}get shouldAddClientTag(){return!(!this.ndk?.clientName&&!this.ndk?.clientNip89||xp.includes(this.kind)||this.isEphemeral()||this.hasTag("client"))}muted(){const t=this.ndk?.mutedIds.get(this.pubkey);if(t&&"p"===t)return"author";const e=this.tagReference(),n=this.ndk?.mutedIds.get(e[1]);return n&&n===e[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return 0===this.kind||3===this.kind||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");const t=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${t}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let e;return e=this.isParamReplaceable()?["a",this.tagAddress()]:["e",this.tagId()],this.relay?e.push(this.relay.url):e.push(""),e.push(t??""),this.isParamReplaceable()||e.push(this.pubkey),e}referenceTags(t,e,n){let r=[];return r=this.isParamReplaceable()?[[n??"a",this.tagAddress()],[n??"e",this.id]]:[[n??"e",this.id]],r=r.map((e=>("e"===e[0]||t?e.push(this.relay?.url??""):this.relay?.url&&e.push(this.relay?.url),e))),r.forEach((e=>{"e"===e[0]?(e.push(t??""),e.push(this.pubkey)):t&&e.push(t)})),r=[...r,...this.getMatchingTags("h")],e||r.push(...this.author.referenceTags()),r}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async delete(e,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new t(this.ndk,{kind:5,content:e||""});return r.tag(this,void 0,!0),r.tags.push(["k",this.kind.toString()]),n&&(this.emit("deleted"),await r.publish()),r}fetchTaggedEvent=pp.bind(this);fetchRootEvent=yp.bind(this);fetchReplyEvent=gp.bind(this);repost=dp.bind(this);async react(e,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new t(this.ndk,{kind:7,content:e});return r.tag(this),n?await r.publish():await r.sign(),r}get isValid(){return this.validate()}reply(){const e=new t(this.ndk);if(1===this.kind)e.kind=1,this.hasTag("e")?e.tags=[...e.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply")]:e.tag(this,"root");else{e.kind=1111;const t=["A","E","I","P"],n=this.tags.filter((e=>t.includes(e[0])));if(n.length>0){const t=this.tagValue("K");e.tags.push(...n),t&&e.tags.push(["K",t]);const[r,i,s,...o]=this.tagReference(),a=[r,i,...o];e.tags.push(a)}else{const[t,n,r,i]=this.tagReference(),s=[t,n,i??""];"e"===t&&s.push(this.pubkey),e.tags.push(s);const o=[...s];o[0]=o[0].toUpperCase(),e.tags.push(o),e.tags.push(["K",this.kind.toString()]),e.tags.push(["P",this.pubkey])}e.tags.push(["k",this.kind.toString()]),e.tags.push(...this.getMatchingTags("p")),e.tags.push(["p",this.pubkey])}return e}},Sp=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;serial=0;baseEoseTimeout=4400;constructor(t,e){this.ndkRelay=t,this._status=1;const n=Math.floor(1e3*Math.random());this.debug=this.ndkRelay.debug.extend("connectivity"+n),this.ndk=e}async connect(t,e=!0){if(2!==this._status&&1!==this._status||this.reconnectTimeout)this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);else{this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??=this.timeoutMs,!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout((()=>this.onConnectionError(e)),this.timeoutMs));try{this.updateConnectionStats.attempt(),1===this._status?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(t){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,t),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",1728e5),t}}}disconnect(){this._status=0;try{this.ws?.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),5===this._status&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(t){this.netDebug?.(t.data,this.ndkRelay,"recv");try{const e=JSON.parse(t.data),[n,r,...i]=e;switch(n){case"EVENT":{const t=this.openSubs.get(r),n=e[2];return t?void t.onevent(n):void this.debug(`Received event for unknown subscription ${r}`)}case"COUNT":{const t=e[2],n=this.openCountRequests.get(r);return void(n&&(n.resolve(t.count),this.openCountRequests.delete(r)))}case"EOSE":{const t=this.openSubs.get(r);if(!t)return;return void t.oneose(r)}case"OK":{const t=e[2],n=e[3],i=this.openEventPublishes.get(r),s=i?.pop();return i&&s?(t?s.resolve(n):s.reject(new Error(n)),void(0===i.length?this.openEventPublishes.delete(r):this.openEventPublishes.set(r,i))):void this.debug("Received OK for unknown event publish",r)}case"CLOSED":{const t=this.openSubs.get(r);if(!t)return;return void t.onclosed(e[2])}case"NOTICE":return void this.onNotice(e[1]);case"AUTH":return void this.onAuthRequested(e[1])}}catch(t){return void this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t?.stack)}}async onAuthRequested(t){const e=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!e}),7!==this._status)if(this._status=6,e){if(this._status>=5){let n;this._status=7;try{n=await e(this.ndkRelay,t)}catch(t){this.debug("Authentication policy threw an error",t),n=!1}if(this.debug("Authentication policy returned",!!n),n instanceof Ap||!0===n){n instanceof Ap&&await this.auth(n);const e=async()=>{if(this._status>=5&&this._status<8){const e=new Ap(this.ndk);e.kind=22242,e.tags=[["relay",this.ndkRelay.url],["challenge",t]],await e.sign(),this.auth(e).then((()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")})).catch((t=>{this._status=6,this.ndkRelay.emit("auth:failed",t),this.debug("Authentication failed",t)}))}else this.debug("Authentication failed, it changed status, status is %d",this._status)};!0===n&&(this.ndk?.signer?e().catch((t=>{console.error("Error authenticating",t)})):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",e))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t);else this.debug("Already authenticating, ignoring")}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return 5===this._status}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!=0)return!1;const e=t.reduce(((t,e)=>t+e),0)/t.length,n=t.map((t=>Math.pow(t-e,2))).reduce(((t,e)=>t+e),0)/t.length;return Math.sqrt(n)<1e3}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping())return this.ndkRelay.emit("flapping",this._connectionStats),void(this._status=3);const e=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch((e=>{t<5?setTimeout((()=>{this.handleReconnection(t+1)}),1e3*(t+1)^4):this.debug("Reconnect failed")}))}),e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(t){this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(t),this.netDebug?.(t,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status)}async auth(t){const e=new Promise(((e,n)=>{const r=this.openEventPublishes.get(t.id)??[];r.push({resolve:e,reject:n}),this.openEventPublishes.set(t.id,r)}));return this.send('["AUTH",'+JSON.stringify(t.rawEvent())+"]"),e}async publish(t){const e=new Promise(((e,n)=>{const r=this.openEventPublishes.get(t.id)??[];r.length>0&&console.warn("Duplicate event publishing detected, you are publishing event "+t.id+" twice"),r.push({resolve:e,reject:n}),this.openEventPublishes.set(t.id,r)}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((t,e)=>{this.openCountRequests.set(n,{resolve:t,reject:e})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}close(t,e){this.send('["CLOSE","'+t+'"]');const n=this.openSubs.get(t);this.openSubs.delete(t),n&&n.onclose(e)}req(t){this.send('["REQ","'+t.subId+'",'+JSON.stringify(t.executeFilters).substring(1)),this.openSubs.set(t.subId,t)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}},Cp=class{ndkRelay;debug;constructor(t){this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,e=2500){let n;const r=()=>new Promise(((e,n)=>{try{this.publishEvent(t).then((n=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),e(!0)})).catch(n)}catch(t){n(t)}})),i=new Promise(((t,r)=>{n=setTimeout((()=>{n=void 0,r(new Error("Timeout: "+e+"ms"))}),e)})),s=()=>{r().then((t=>o(t))).catch((t=>a(t)))};let o,a;const c=e=>{throw this.ndkRelay.debug("Publish failed",e,t.id),this.ndkRelay.emit("publish:failed",t,e),t.emit("relay:publish:failed",this.ndkRelay,e),e},u=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",s)};return this.ndkRelay.status>=5?Promise.race([r(),i]).catch(c).finally(u):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise(((t,e)=>{o=t,a=e,this.ndkRelay.once("connect",s)})),i]).catch(c).finally(u))}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function Op(t){const e=[],n={};return t.filter((t=>!!t.limit)).forEach((t=>e.push(t))),0===(t=t.filter((t=>!t.limit))).length?e:(t.forEach((t=>{Object.entries(t).forEach((([t,e])=>{Array.isArray(e)?void 0===n[t]?n[t]=[...e]:n[t]=Array.from(new Set([...n[t],...e])):n[t]=e}))})),[...e,n])}var Tp=class{fingerprint;items=new Map;topSubManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(t,e,n){this.relay=t,this.topSubManager=n,this.debug=t.debug.extend("subscription-"+this.id),this.fingerprint=e||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId||(this._subId=this.fingerprint.slice(0,15)),this._subId}subIdParts=new Set;addSubIdPart(t){this.subIdParts.add(t)}addItem(t,e){if(this.debug("Adding item",{filters:e,internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,items:this.items,itemsSize:this.items.size}),!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:e}),3!==this.status&&t.subId&&(!this._subId||this._subId.length<48)&&(0!==this.status&&1!==this.status||this.addSubIdPart(t.subId)),this.status){case 0:case 1:this.evaluateExecutionPlan(t);break;case 3:console.log("BUG: This should not happen: This subscription needs to catch up with a subscription that was already running",e);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",t,e),new Error("Cannot add new items to a closed subscription")}}removeItem(t){if(this.items.delete(t.internalId),0===this.items.size){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(4===this.status)return;const t=this.status;if(this.status=4,3===t)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(t){if(!t.isGroupable())return this.status=1,void this.execute();if(t.filters.find((t=>!!t.limit))&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10))return this.status=1,void this.execute();const e=t.groupableDelay,n=t.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(0===this.status)this.schedule(e,n);else{const t=this.delayType,r=this.fireTime-Date.now();if("at-least"===t&&"at-least"===n)r<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if("at-least"===t&&"at-most"===n)r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if("at-most"===t&&"at-most"===n)r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else{if("at-most"!==t||"at-least"!==n)throw new Error("Unknown delay type combination "+t+" "+n);r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n))}}}schedule(t,e){this.status=1;const n=Date.now();this.fireTime=n+t,this.delayType=e;const r=setTimeout(this.execute.bind(this),t);"at-least"===e&&(this.executionTimer=r)}executeOnRelayReady=()=>{if(2===this.status){if(0===this.items.size)return this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size,id:this.id,subId:this.subId}),void this.cleanup();this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.status=1,this.execute()}};finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+="-"+Math.random().toString(36).substring(2,7)}reExecuteAfterAuth=(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:t}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s 👉 %s",t,this.subId)}).bind(this);execute(){if(1===this.status){if(!this.relay.connected)return this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),void this.relay.once("ready",this.executeOnRelayReady);this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){this.topSubManager.dispatchEvent(t,this.relay)}oneose(t){if(this.eosed=!0,t!==this.subId)return this.debug("Received EOSE for an abandoned subscription",t,this.subId),void this.relay.close(t);0===this.items.size&&this.close();for(const{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:t.filters,internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.removeItem(t))}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,t)}compileFilters(){const t=[],e=Array.from(this.items.values()).map((t=>t.filters));if(!e[0])return this.debug("👀 No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const n=e[0].length;for(let r=0;r<n;r++){const n=e.map((t=>t[r]));t.push(...Op(n))}return t}},Rp=class{relay;subscriptions;generalSubManager;constructor(t,e){this.relay=t,this.subscriptions=new Map,this.generalSubManager=e}addSubscription(t,e){let n;if(t.isGroupable()){const r=function(t,e){const n=[];for(const e of t){const t=Object.entries(e||{}).map((([t,e])=>["since","until"].includes(t)?t+":"+e:t)).sort().join("-");n.push(t)}let r=e?"+":"";return r+=n.join("|"),r}(e,t.closeOnEose);r&&(n=(this.subscriptions.get(r)||[]).find((t=>t.status<3))),n??=this.createSubscription(t,e,r)}else n=this.createSubscription(t,e);n.addItem(t,e)}createSubscription(t,e,n){const r=new Tp(this.relay,n||null,this.generalSubManager);r.onClose=this.onRelaySubscriptionClose.bind(this);const i=this.subscriptions.get(r.fingerprint)??[];return this.subscriptions.set(r.fingerprint,[...i,r]),r}onRelaySubscriptionClose(t){let e=this.subscriptions.get(t.fingerprint)??[];e?1===e.length?this.subscriptions.delete(t.fingerprint):(e=e.filter((e=>e.id!==t.id)),this.subscriptions.set(t.fingerprint,e)):console.warn("Unexpectedly did not find a subscription with fingerprint",t.fingerprint)}},Ip=class t extends oo.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(t,e,n)=>{if(void 0===t.lowestValidationRatio||void 0===t.targetValidationRatio)return 1;let r=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const n=e/100;r=Math.max(t.lowestValidationRatio,t.validationRatio-n)}return r<t.validationRatio?r:t.validationRatio};constructor(e,n,r){super(),this.url=Kf(e),this.scores=new Map,this.debug=ao(`ndk:relay:${e}`),this.connectivity=new Sp(this,r),this.connectivity.netDebug=r?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new Rp(this,r.subManager),this.publisher=new Cp(this),this.authPolicy=n,this.targetValidationRatio=r?.initialValidationRatio,this.lowestValidationRatio=r?.lowestValidationRatio,this.validationRatioFn=(r?.validationRatioFn??t.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),r||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout((()=>{this.updateValidationRatio()}),3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,e=!0){return this.connectivity.connect(t,e)}disconnect(){1!==this.status&&this.connectivity.disconnect()}subscribe(t,e){this.subs.addSubscription(t,e)}async publish(t,e=2500){return this.publisher.publish(t,e)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return 0===this.nonValidatedEventCount?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return!this.trusted&&(void 0===this.targetValidationRatio||this.validationRatio<this.targetValidationRatio)}get connected(){return this.connectivity.connected}req;close},Np=class extends oo.EventEmitter{_relays=new Map;autoConnectRelays=new Set;blacklistRelayUrls;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;constructor(t=[],e=[],n,r){super(),this.debug=r??n.debug.extend("pool"),this.ndk=n,this.relayUrls=t,this.blacklistRelayUrls=new Set(e)}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const e of t){const t=new Ip(e,void 0,this.ndk);t.connectivity.netDebug=this.ndk.netDebug,this.addRelay(t,!1)}}set name(t){this.debug=this.debug.extend(t)}useTemporaryRelay(t,e=3e4,n){const r=this.relays.has(t.url);r||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,n));const i=this.temporaryRelayTimers.get(t.url);if(i&&clearTimeout(i),!r||i){const n=setTimeout((()=>{this.ndk.explicitRelayUrls?.includes(t.url)||this.removeRelay(t.url)}),e);this.temporaryRelayTimers.set(t.url,n)}}addRelay(t,e=!0){const n=this.relays.has(t.url),r=this.blacklistRelayUrls?.has(t.url),i=t.url.includes("/npub1");let s=!0;const o=t.url;if(n)return;if(r)return void this.debug(`Refusing to add relay ${o}: blacklisted`);if(i)return void this.debug(`Refusing to add relay ${o}: is a filter relay`);if(this.ndk.cacheAdapter?.getRelayStatus){const n=this.ndk.cacheAdapter.getRelayStatus(o);if(n&&n.dontConnectBefore){if(n.dontConnectBefore>Date.now()){const r=n.dontConnectBefore-Date.now();return this.debug(`Refusing to add relay ${o}: delayed connect for ${r}ms`),void setTimeout((()=>{this.addRelay(t,e)}),r)}s=!1}}const a=e=>this.emit("notice",t,e),c=()=>this.handleRelayConnect(o),u=()=>this.handleRelayReady(t),h=()=>this.emit("relay:disconnect",t),l=()=>this.handleFlapping(t),d=e=>this.emit("relay:auth",t,e),f=()=>this.emit("relay:authed",t);t.off("notice",a),t.off("connect",c),t.off("ready",u),t.off("disconnect",h),t.off("flapping",l),t.off("auth",d),t.off("authed",f),t.on("notice",a),t.on("connect",c),t.on("ready",u),t.on("disconnect",h),t.on("flapping",l),t.on("auth",d),t.on("authed",f),t.on("delayed-connect",(e=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+e})})),this.relays.set(o,t),e&&this.autoConnectRelays.add(o),e&&(this.emit("relay:connecting",t),t.connect(void 0,s).catch((t=>{this.debug(`Failed to connect to relay ${o}`,t)})))}removeRelay(t){const e=this.relays.get(t);if(e)return e.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",e),!0;const n=this.temporaryRelayTimers.get(t);return n&&(clearTimeout(n),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const e=Kf(t),n=this.relays.get(e);return!!n&&5===n.status}getRelay(t,e=!0,n=!1,r){let i=this.relays.get(Kf(t));return i||(i=new Ip(t,void 0,this.ndk),i.connectivity.netDebug=this.ndk.netDebug,n?this.useTemporaryRelay(i,3e4,r):this.addRelay(i,e)),i}handleRelayConnect(t){const e=this.relays.get(t);e?(this.emit("relay:connect",e),this.stats().connected===this.relays.size&&this.emit("connect")):console.error("NDK BUG: relay not found in pool",{relayUrl:t})}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){const e=[];this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}...`:""}`);const n=new Set(this.autoConnectRelays.keys());this.ndk.explicitRelayUrls?.forEach((t=>{const e=Kf(t);n.add(e)}));for(const r of n){const n=this.relays.get(r);if(!n)continue;const i=new Promise(((e,r)=>(this.emit("relay:connecting",n),n.connect(t).then(e).catch(r))));if(t){const r=new Promise(((e,n)=>{setTimeout((()=>n(`Timed out after ${t}ms`)),t)}));e.push(Promise.race([i,r]).catch((t=>{this.debug(`Failed to connect to relay ${n.url}: ${t??"No reason specified"}`)})))}else e.push(i)}t&&setTimeout((()=>{const t=this.stats().connected===this.relays.size,e=this.stats().connected>0;!t&&e&&this.emit("connect")}),t),await Promise.all(e)}checkOnFlappingRelays(){if(this.flappingRelays.size/this.relays.size>=.8)for(const t of this.flappingRelays)this.backoffTimes.set(t,0)}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let e=this.backoffTimes.get(t.url)||5e3;e*=2,this.backoffTimes.set(t.url,e),this.debug(`Backoff time for ${t.url} is ${e}ms`),setTimeout((()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()}),e),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const e of this.relays.values())t.total++,5===e.status?t.connected++:1===e.status?t.disconnected++:4===e.status&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter((t=>t.status>=5))}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter((t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url)))}urls(){return Array.from(this.relays.keys())}};function Up(t){return!(!t.filter.ids||!function(t){const e=t.filter.ids;return!!e&&e.length===t.eventFirstSeen.size}(t))}function Pp(t){let e;if(t.match(Lp)){const[e,n,r]=t.split(":"),i={authors:[n],kinds:[parseInt(e)]};return r&&(i["#d"]=[r]),i}if(t.match(Bp))try{switch(e=td.decode(t),e.type){case"nevent":{const t={ids:[e.data.id]};return e.data.author&&(t.authors=[e.data.author]),e.data.kind&&(t.kinds=[e.data.kind]),t}case"note":return{ids:[e.data]};case"naddr":const t={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(t["#d"]=[e.data.identifier]),t}}catch(e){console.error("Error decoding",t,e)}return{ids:[t]}}var Lp=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,Bp=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;var Mp={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},jp=class extends oo.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;internalId;closeOnEose;poolMonitor;skipOptimisticPublishEvent=!1;constructor(t,e,n,r,i){if(super(),this.ndk=t,this.pool=n?.pool||t.pool,this.opts={...Mp,...n||{}},this.filters=e instanceof Array?e:[e],this.subId=i||n?.subId,this.internalId=Math.random().toString(36).substring(7),this.relaySet=r,this.debug=t.debug.extend(`subscription[${n?.subId??this.internalId}]`),this.skipVerification=n?.skipVerification||!1,this.skipValidation=n?.skipValidation||!1,this.closeOnEose=n?.closeOnEose||!1,this.skipOptimisticPublishEvent=n?.skipOptimisticPublishEvent||!1,"ONLY_CACHE"===this.opts.cacheUsage&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters.keys()).filter((t=>!this.eosesSeen.has(this.pool.getRelay(t,!1,!1)))):[]}get filter(){return this.filters[0]}get groupableDelay(){if(this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return"ONLY_RELAY"!==this.opts?.cacheUsage}shouldQueryRelays(){return"ONLY_CACHE"!==this.opts?.cacheUsage}shouldWaitForCache(){return this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&"PARALLEL"!==this.opts.cacheUsage}async start(){let t;this.shouldQueryCache()&&(t=this.startWithCache(),this.shouldWaitForCache()&&(await t,Up(this)))?this.emit("eose",this):this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=t=>{this.relayFilters?.has(t.url)||np(this.ndk,this.filters,this.pool).get(t.url)&&(this.relayFilters?.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}onStopped;stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.removeAllListeners(),this.onStopped?.()}hasAuthorsFilter(){return this.filters.some((t=>t.authors?.length))}async startWithCache(){if(this.ndk.cacheAdapter?.query){const t=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await t}}startWithRelays(){if(this.relaySet&&0!==this.relaySet.relays.size){this.relayFilters=new Map;for(const t of this.relaySet.relays)this.relayFilters.set(t.url,this.filters)}else this.relayFilters=np(this.ndk,this.filters,this.pool);if(this.relayFilters&&0!==this.relayFilters.size)for(const[t,e]of this.relayFilters)this.pool.getRelay(t,!0,!0,e).subscribe(this,e)}eventReceived(t,e,n=!1,r=!1){const i=t.id,s=this.eventFirstSeen.has(i);let o;if(t instanceof Ap&&(o=t),s){const n=Date.now()-(this.eventFirstSeen.get(i)||0);if(this.emit("event:dup",i,e,n,this),e){const n=_p.get(i);n&&"string"==typeof n&&t.sig===n&&e.addValidatedEvent()}}else{if(o??=new Ap(this.ndk,t),o.ndk=this.ndk,o.relay=e,!n&&!r){if(!this.skipValidation&&!o.isValid)return void this.debug("Event failed validation %s from relay %s",i,e?.url);if(e)if(!1!==e?.shouldValidateEvent()){if(!this.skipVerification){if(!o.verifySignature(!0)&&!this.ndk.asyncSigVerification)return void this.debug("Event failed signature validation",t);e&&e.addValidatedEvent()}}else e.addNonValidatedEvent();this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(o,this.filters,e)}!n&&e&&this.ndk.emit("event",o,e),r&&!0===this.skipOptimisticPublishEvent||(this.emit("event",o,e,this),this.eventFirstSeen.set(i,Date.now()))}this.lastEventReceivedAt=Date.now()}closedReceived(t,e){this.emit("closed",t,e)}eoseTimeout;eosed=!1;eoseReceived(t){this.debug("EOSE received from %s",t.url),this.eosesSeen.add(t);let e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const n=this.eosesSeen.size===this.relayFilters?.size,r=Up(this),i=t=>{this.debug("Performing EOSE: %s %d",t,this.eosed),this.eosed||(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0)};if(r||n)i("query filled or seen all");else if(this.relayFilters){let t=1e3;const n=new Set(this.pool.connectedRelays().map((t=>t.url))),r=Array.from(this.relayFilters.keys()).filter((t=>n.has(t)));if(0===r.length)return;const s=this.eosesSeen.size/r.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:s,seen:this.eosesSeen.size,total:r.length}),this.eosesSeen.size>=2&&s>=.5){if(t*=1-s,0===t)return void i("time to wait was 0");this.eoseTimeout&&clearTimeout(this.eoseTimeout);const n=()=>{e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,void 0!==e&&e<20?this.eoseTimeout=setTimeout(n,t):i("send eose timeout: "+t)};this.eoseTimeout=setTimeout(n,t)}}}};async function Fp(t,e,n=3){if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},t||{groupable:!1});if(r){const t=new Set;return r.tags.forEach((e=>{"p"===e[0]&&t.add(e[1])})),e&&this.ndk?.outboxTracker?.trackUsers(Array.from(t)),[...t].reduce(((t,e)=>{const n=new Kp({pubkey:e});return n.ndk=this.ndk,t.add(n),t}),new Set)}return new Set}function $p(t){const e={};let n;try{n=JSON.parse(t.content)}catch(t){throw new Error(`Failed to parse profile event: ${t}`)}return e.created_at=t.created_at,e.profileEvent=JSON.stringify(t.rawEvent()),Object.keys(n).forEach((t=>{switch(t){case"name":e.name=n.name;break;case"display_name":e.displayName=n.display_name;break;case"image":case"picture":e.image=n.picture||n.image;break;case"banner":e.banner=n.banner;break;case"bio":e.bio=n.bio;break;case"nip05":e.nip05=n.nip05;break;case"lud06":e.lud06=n.lud06;break;case"lud16":e.lud16=n.lud16;break;case"about":e.about=n.about;break;case"zapService":e.zapService=n.zapService;break;case"website":e.website=n.website;break;default:e[t]=n[t]}})),e}function Dp(t){const e={};for(const[n,r]of Object.entries(t))switch(n){case"username":case"name":e.name=r;break;case"displayName":e.display_name=r;break;case"image":case"picture":e.picture=r;break;case"bio":case"about":e.about=r;break;default:e[n]=r}return JSON.stringify(e)}var zp=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function qp(t,e,n=fetch,r={}){return await t.queuesNip05.add({id:e,func:async()=>{if(t.cacheAdapter&&t.cacheAdapter.loadNip05){const n=await t.cacheAdapter.loadNip05(e);if("missing"!==n){if(n){const e=new Kp({pubkey:n.pubkey,relayUrls:n.relays,nip46Urls:n.nip46});return e.ndk=t,e}if("no-cache"!==r.cache)return null}}const i=e.match(zp);if(!i)return null;const[s,o="_",a]=i;try{const i=await n(`https://${a}/.well-known/nostr.json?name=${o}`,r),{names:s,relays:c,nip46:u}=function(t){const e={names:{}};for(const[n,r]of Object.entries(t.names))"string"==typeof n&&"string"==typeof r&&(e.names[n.toLowerCase()]=r);if(t.relays){e.relays={};for(const[n,r]of Object.entries(t.relays))"string"==typeof n&&Array.isArray(r)&&(e.relays[n]=r.filter((t=>"string"==typeof t)))}if(t.nip46){e.nip46={};for(const[n,r]of Object.entries(t.nip46))"string"==typeof n&&Array.isArray(r)&&(e.nip46[n]=r.filter((t=>"string"==typeof t)))}return e}(await i.json()),h=s[o.toLowerCase()];let l=null;return h&&(l={pubkey:h,relays:c?.[h],nip46:u?.[h]}),t?.cacheAdapter&&t.cacheAdapter.saveNip05&&t.cacheAdapter.saveNip05(e,l),l}catch(n){return t?.cacheAdapter&&t.cacheAdapter.saveNip05&&t?.cacheAdapter.saveNip05(e,null),console.error("Failed to fetch NIP05 for",e,n),null}}})}var Zp=class t extends Ap{static kind=10019;static kinds=[10019];_p2pk;constructor(t,e){super(t,e),this.kind??=10019}static from(e){return new t(e.ndk,e)}set relays(t){this.tags=this.tags.filter((t=>"relay"!==t[0]));for(const e of t)this.tags.push(["relay",e])}get relays(){const t=[];for(const e of this.tags)"relay"===e[0]&&t.push(e[1]);return t}set mints(t){this.tags=this.tags.filter((t=>"mint"!==t[0]));for(const e of t)this.tags.push(["mint",e])}get mints(){const t=[];for(const e of this.tags)"mint"===e[0]&&t.push(e[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk||(this._p2pk=this.tagValue("pubkey")??this.pubkey),this._p2pk}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return tp.fromRelayUrls(this.relays,this.ndk)}},Hp=ao("ndk:zapper:ln");async function Vp({lud06:t,lud16:e},n){let r;if(e&&!e.startsWith("LNURL")){const[t,n]=e.split("@");r=`https://${n}/.well-known/lnurlp/${t}`}else if(t){const{words:e}=st.decode(t,1e3),n=st.fromWords(e);r=new TextDecoder("utf-8").decode(n)}if(!r)throw Hp("No zap endpoint found %o",{lud06:t,lud16:e}),new Error("No zap endpoint found");try{const t=n.httpFetch||fetch,e=await t(r);if(200!==e.status){const t=await e.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}return await e.json()}catch(t){throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}}var Kp=class t{ndk;profile;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=td.npubEncode(this.pubkey)}return this._npub}get nprofile(){return console.log("encoding with pubkey",this.pubkey),td.nprofileEncode({pubkey:this.pubkey})}set npub(t){this._npub=t}get hexpubkey(){return this.pubkey}set hexpubkey(t){this._pubkey=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=td.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}async getZapInfo(t=!0,e=["nip61","nip57"]){if(!this.ndk)throw new Error("No NDK instance found");const n=[];if(e.includes("nip61")&&n.push(10019),e.includes("nip57")&&n.push(0),0===n.length)return[];let r=await this.ndk.fetchEvents({kinds:n,authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",groupable:!1});r.size<e.length&&(r=await this.ndk.fetchEvents({kinds:n,authors:[this.pubkey]},{cacheUsage:"ONLY_RELAY"}));const i=[],s=Array.from(r).find((t=>10019===t.kind)),o=Array.from(r).find((t=>0===t.kind));if(s){const e=Zp.from(s);if(e.mints.length>0&&i.push({type:"nip61",data:{mints:e.mints,relays:e.relays,p2pk:e.p2pk}}),!t)return i}if(o){const t=$p(o),{lud06:e,lud16:n}=t;try{const t=await Vp({lud06:e,lud16:n},this.ndk);t&&i.push({type:"nip57",data:t})}catch(t){console.error("Error getting NIP-57 zap spec",t)}}return i}async getZapConfiguration(t){if(t??=this.ndk,!t)throw new Error("No NDK instance found");return await t.queuesZapConfig.add({id:this.pubkey,func:async()=>{if(this.ndk?.cacheAdapter?.loadUsersLNURLDoc){const t=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if("missing"!==t){if(null===t)return;if(t)return t}}let e;try{if(await this.fetchProfile({groupable:!1}),this.profile){const{lud06:n,lud16:r}=this.profile;e=await Vp({lud06:n,lud16:r},t)}}catch{}if(this.ndk?.cacheAdapter?.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,e||null),e)return e}})}async getZapperPubkey(){const t=await this.getZapConfiguration();return t?.nostrPubkey}static async fromNip05(e,n,r=!1){if(!n)throw new Error("No NDK instance found");const i={};r&&(i.cache="no-cache");const s=await qp(n,e,n?.httpFetch,i);if(s){const e=new t({pubkey:s.pubkey,relayUrls:s.relays,nip46Urls:s.nip46});return e.ndk=n,e}}async fetchProfile(t,e=!1){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let n=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&"ONLY_RELAY"!==t?.cacheUsage){const t=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(t)return this.profile=t,t}!t&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(n=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),t={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),n&&0!==n.size||(n=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},t));const r=Array.from(n).sort(((t,e)=>t.created_at-e.created_at));if(0===r.length)return null;const i=r[0];return this.profile=$p(i),e&&(this.profile.profileEvent=JSON.stringify(i)),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile}follows=Fp.bind(this);async followSet(t,e,n=3){const r=await this.follows(t,e,n);return new Set(Array.from(r).map((t=>t.pubkey)))}tagReference(){return["p",this.pubkey]}referenceTags(t){const e=[["p",this.pubkey]];return t?(e[0].push("",t),e):e}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner();const t=new Ap(this.ndk,{kind:0,content:Dp(this.profile)});await t.publish()}async follow(t,e,n=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,n)),e.has(t))return!1;e.add(t);const r=new Ap(this.ndk,{kind:n});for(const t of e)r.tag(t);return await r.publish(),!0}async unfollow(t,e,n=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,n));const r=new Set;let i=!1;for(const n of e)n.pubkey!==t.pubkey?r.add(n):i=!0;if(!i)return!1;const s=new Ap(this.ndk,{kind:n});for(const t of r)s.tag(t);return await s.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const e=await qp(this.ndk,t);return null===e?null:e.pubkey===this.pubkey}},Wp=class t extends Ap{_encryptedTags;encryptedTagsLength;constructor(t,e){super(t,e),this.kind??=30001}static from(e){return new t(e.ndk,e)}get title(){return this.tagValue("title")||this.tagValue("name")||(3===this.kind?"Contacts":1e4===this.kind?"Mute":10001===this.kind?"Pinned Notes":10002===this.kind?"Relay Metadata":10003===this.kind?"Bookmarks":10004===this.kind?"Communities":10005===this.kind?"Public Chats":10006===this.kind?"Blocked Relays":10007===this.kind?"Search Relays":10050===this.kind?"Direct Message Receive Relays":10015===this.kind?"Interests":10030===this.kind?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!(!this._encryptedTags||this.encryptedTagsLength!==this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const e=await this.ndk.signer.user();try{if(this.content.length>0)try{const t=await this.ndk.signer.decrypt(e,this.content),n=JSON.parse(t);return n&&n[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=n):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch(t){console.log(`error decrypting ${this.content}`)}}catch(t){}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter((e=>e[0]===t))}get items(){return this.tags.filter((t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0])))}async addItem(t,e=void 0,n=!1,r="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let i;if(t instanceof Ap)i=[t.tagReference(e)];else if(t instanceof Kp)i=t.referenceTags();else if(t instanceof Ip)i=t.referenceTags();else{if(!Array.isArray(t))throw new Error("Invalid object type");i=[t]}if(e&&i[0].push(e),n){const t=await this.ndk.signer.user(),e=await this.encryptedTags();"top"===r?e.unshift(...i):e.push(...i),this._encryptedTags=e,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(e),await this.encrypt(t)}else"top"===r?this.tags.unshift(...i):this.tags.push(...i);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,e=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=this.tags.findIndex((e=>e[1]===t));n>=0&&this.tags.splice(n,1);const r=await this.ndk.signer.user(),i=await this.encryptedTags(),s=i.findIndex((e=>e[1]===t));if(s>=0&&(i.splice(s,1),this._encryptedTags=i,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(i),await this.encrypt(r)),e)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,e){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(e){const e=await this.ndk.signer.user(),n=await this.encryptedTags();n.splice(t,1),this._encryptedTags=n,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(n),await this.encrypt(e)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some((e=>e[1]===t))}filterForItems(){const t=new Set,e=new Map,n=[];for(const n of this.items)if("e"===n[0]&&n[1])t.add(n[1]);else if("a"===n[0]&&n[1]){const[t,r,i]=n[1].split(":");if(!t||!r)continue;const s=`${t}:${r}`,o=e.get(s)||[];o.push(i||""),e.set(s,o)}if(t.size>0&&n.push({ids:Array.from(t)}),e.size>0)for(const[t,r]of e.entries()){const[e,i]=t.split(":");n.push({kinds:[parseInt(e)],authors:[i],"#d":r})}return n}},Gp="read",Jp="write",Yp=class t extends Ap{constructor(t,e){super(t,e),this.kind??=10002}static from(e){return new t(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2]||t[2]&&t[2]===Gp)).map((t=>Vf(t[1]))).filter((t=>!!t))}set readRelayUrls(t){for(const e of t)this.tags.push(["r",e,Gp])}get writeRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2]||t[2]&&t[2]===Jp)).map((t=>Vf(t[1]))).filter((t=>!!t))}set writeRelayUrls(t){for(const e of t)this.tags.push(["r",e,Jp])}get bothRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2])).map((t=>t[1]))}set bothRelayUrls(t){for(const e of t)this.tags.push(["r",e])}get relays(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).map((t=>t[1]))}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new tp(new Set(this.relays.map((t=>this.ndk.pool.getRelay(t)))),this.ndk)}};function Qp(t,e){try{const n=JSON.parse(e.content),r=new Yp(t),i=new Set,s=new Set;for(let[t,e]of Object.entries(n)){try{t=Kf(t)}catch{continue}if(e){const n=e;n.write&&s.add(t),n.read&&i.add(t)}else i.add(t),s.add(t)}return r.readRelayUrls=Array.from(i),r.writeRelayUrls=Array.from(s),r}catch{}}(class t extends Ap{debug;_proofs=[];static kind=9321;static kinds=[t.kind];constructor(t,e){super(t,e),this.kind??=9321,this.debug=t?.debug.extend("nutzap")??ao("ndk:nutzap"),this.alt||(this.alt="This is a nutzap")}static from(t){const e=new this(t.ndk,t);try{const t=e.getMatchingTags("proof");t.length?e._proofs=t.map((t=>JSON.parse(t[1]))):e._proofs=JSON.parse(e.content)}catch{return}if(e._proofs&&e._proofs.length)return e}set comment(t){this.content=t??""}get comment(){return this.tagValue("comment")||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter((t=>"proof"!==t[0]));for(const e of t)this.tags.push(["proof",JSON.stringify(e)]);this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()])}get proofs(){return this._proofs}get p2pk(){const t=this.proofs[0];try{const e=JSON.parse(t.secret);let n={};if("string"==typeof e?(n=JSON.parse(e),this.debug("stringified payload",t.secret)):"object"==typeof e&&(n=e),"P2PK"===n[0]&&n[1]?.data){const t=n[1].data.slice(2,-1);if(t)return t}}catch(t){this.debug("error parsing p2pk pubkey",t,this.proofs[0])}}get mint(){return this.tagValue("u")}set mint(t){this.removeTag("u"),this.tag(["u",t])}get unit(){return this.tagValue("unit")??"msat"}set unit(t){this.removeTag("unit"),t&&this.tag(["unit",t])}get amount(){return 1e3*this.proofs.reduce(((t,e)=>t+e.amount),0)}sender=this.author;set target(t){this.tags=this.tags.filter((t=>"p"!==t[0])),t instanceof Ap&&this.tags.push(t.tagReference())}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new Kp({pubkey:t})}get isValid(){let t=0,e=0;for(const n of this.tags)"p"===n[0]&&t++,"u"===n[0]&&e++;return 1===t&&1===e&&this.proofs.length>0}});async function Xp(t,e,n,r,i,s){try{await t.sign(n),i(t)}catch(n){r(`Failed to publish auth event to relay ${e.url}`,n),s(t)}}var ty=function({ndk:t,signer:e,debug:n}={}){return n??=ao("ndk:auth-policies:signIn"),async(r,i)=>{n(`Relay ${r.url} requested authentication, signing in`);const s=new Ap(t);return s.kind=22242,s.tags=[["relay",r.url],["challenge",i]],e??=t?.signer,new Promise((async(i,o)=>{e?await Xp(s,r,e,n,i,o):t?.once("signer:ready",(async t=>{await Xp(s,r,t,n,i,o)}))}))}},ey=class t{_user;_privateKey;constructor(t){if(t){if("string"==typeof t)if(t.startsWith("nsec1")){const{type:e,data:n}=td.decode(t);"nsec"===e&&(this._privateKey=n)}else{if(64!==t.length)throw new Error("Invalid private key provided.");this._privateKey=function(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,i=0;e<n;e++,i+=2){const n=h(t.charCodeAt(i)),s=h(t.charCodeAt(i+1));if(void 0===n||void 0===s){const e=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+i)}r[e]=16*n+s}return r}(t)}else this._privateKey=t;this._privateKey&&(this._user=new Kp({pubkey:fh(this._privateKey)}))}}get privateKey(){if(this._privateKey)return u(this._privateKey)}static generate(){const e=dh();return new t(e)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return ph(t,this._privateKey).sig}getConversationKey(t){if(!this._privateKey)throw Error("Attempted to get conversation key without a private key");const e=t.pubkey;return ef.getConversationKey(this._privateKey,e)}async nip44Encrypt(t,e){const n=this.getConversationKey(t);return await ef.encrypt(e,n)}async nip44Decrypt(t,e){const n=this.getConversationKey(t);return await ef.decrypt(e,n)}async encrypt(t,e,n=cp){return"nip44"===n?this.nip44Encrypt(t,e):this.nip04Encrypt(t,e)}async decrypt(t,e,n=cp){return"nip44"===n?this.nip44Decrypt(t,e):this.nip04Decrypt(t,e)}async nip04Encrypt(t,e){if(!this._privateKey)throw Error("Attempted to encrypt without a private key");const n=t.pubkey;return await yd.encrypt(this._privateKey,n,e)}async nip04Decrypt(t,e){if(!this._privateKey)throw Error("Attempted to decrypt without a private key");const n=t.pubkey;return await yd.decrypt(this._privateKey,n,e)}};oo.EventEmitter;async function ny(t,e,n=!1){const r=e.outboxPool||e.pool,i=new Set;for(const t of r.relays.values())i.add(t);const s=new Map,o=new Map,a=new tp(i,e);if(e.cacheAdapter?.locking&&!n){const n=await e.fetchEvents({kinds:[3,10002],authors:t},{cacheUsage:"ONLY_CACHE"});for(const t of n)10002===t.kind&&s.set(t.pubkey,Yp.from(t));for(const t of n)if(3===t.kind){if(s.has(t.pubkey))continue;const n=Qp(e,t);n&&o.set(t.pubkey,n)}t=t.filter((t=>!s.has(t)&&!o.has(t)))}if(0===t.length)return s;const c=new Map,u=new Map;return new Promise((async n=>{const i=e.subscribe({kinds:[3,10002],authors:t},{closeOnEose:!0,pool:r,groupable:!0,cacheUsage:"ONLY_RELAY",subId:"ndk-relay-list-fetch"},a,!1);i.on("event",(t=>{if(10002===t.kind){const e=c.get(t.pubkey);if(e&&e.created_at>t.created_at)return;c.set(t.pubkey,t)}else if(3===t.kind){const e=u.get(t.pubkey);if(e&&e.created_at>t.created_at)return;u.set(t.pubkey,t)}})),i.on("eose",(()=>{for(const t of c.values())s.set(t.pubkey,Yp.from(t));for(const n of t){if(s.has(n))continue;const t=u.get(n);if(!t)continue;const r=Qp(e,t);r&&s.set(n,r)}n(s)})),i.start()}))}oo.EventEmitter;var ry=class{type;relayUrlScores;readRelays;writeRelays;constructor(t){this.type=t,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},iy=class extends oo.EventEmitter{data;ndk;debug;constructor(t){super(),this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new qf.LRUCache({maxSize:1e5,entryExpirationTimeInMS:12e4})}async trackUsers(t,e=!1){const n=[];for(let r=0;r<t.length;r+=400){const i=t.slice(r,r+400).map((t=>sy(t))).filter((t=>!this.data.has(t)));if(0!==i.length){for(const t of i)this.data.set(t,new ry("user"));n.push(new Promise((t=>{ny(i,this.ndk,e).then((t=>{for(const[e,n]of t){let t=this.data.get(e);if(t??=new ry("user"),n){t.readRelays=new Set(Wf(n.readRelayUrls)),t.writeRelays=new Set(Wf(n.writeRelayUrls));for(const e of t.readRelays)this.ndk.pool.blacklistRelayUrls.has(e)&&t.readRelays.delete(e);for(const e of t.writeRelays)this.ndk.pool.blacklistRelayUrls.has(e)&&t.writeRelays.delete(e);this.data.set(e,t)}}})).finally(t)})))}}return Promise.all(n)}track(t,e,n=!0){const r=sy(t);e??=function(t){return t instanceof Kp?"user":"kind"}(t);let i=this.data.get(r);return i||(i=new ry(e),t instanceof Kp&&this.trackUsers([t])),i}};function sy(t){return t instanceof Kp?t.pubkey:t}function oy(t){if(!t||""===t)return!1;try{return new URL(t),!0}catch(t){return!1}}async function ay(t,e,n,r={type:"timeout"}){const i=this.debug.extend("fetch-event-from-tag"),[s,o,a]=t;i("fetching event from tag",t,n={},r);const c=Zf(this,e.pubkey);if(c&&c.size>0){i("fetching event from author relays %o",Array.from(c));const t=tp.fromRelayUrls(Array.from(c),this),e=await this.fetchEvent(o,n,t);if(e)return e}else i("no author relays found for %s",e.pubkey,e);const u=np(this,[{ids:[o]}],this.pool);i("fetching event without relay hint",u);const h=await this.fetchEvent(o,n);if(h)return h;if(a&&""!==a){const t=await this.fetchEvent(o,n,this.pool.getRelay(a,!0,!0,[{ids:[o]}]));if(t)return t}let l;const d=oy(a)?this.pool.getRelay(a,!1,!0,[{ids:[o]}]):void 0,f=new Promise((t=>{this.fetchEvent(o,n,d).then(t)}));if(!oy(a)||"none"===r.type)return f;const p=new Promise((async t=>{const e=r.relaySet,s=r.timeout??1500,a=new Promise((t=>setTimeout(t,s)));"timeout"===r.type&&await a,l?t(l):(i("fallback fetch triggered"),t(await this.fetchEvent(o,n,e)))}));switch(r.type){case"timeout":return Promise.race([f,p]);case"eose":return l=await f,l||p}}var cy=class{ndk;spec;url;nip98Required=!1;constructor(t,e){this.url=`https://${t}/.well-known/nostr/nip96.json`,this.ndk=e}async prepareUpload(t,e="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let n={};return this.nip98Required&&(n={Authorization:await this.generateNip98Header(this.spec.api_url,e,t)}),{url:this.spec.api_url,headers:n}}async xhrUpload(t,e){const n="POST",{url:r,headers:i}=await this.prepareUpload(e,n);t.open(n,r,!0),i.Authorization&&t.setRequestHeader("Authorization",i.Authorization);const s=new FormData;return s.append("file",e),new Promise(((e,n)=>{t.onload=function(){t.status>=200&&t.status<300?e(JSON.parse(t.responseText)):n(new Error(t.statusText))},t.onerror=function(){n(new Error("Network Error"))},t.send(s)}))}async upload(t){const e="POST",{url:n,headers:r}=await this.prepareUpload(t,e),i=new FormData;i.append("file",t);const s=await this.ndk.httpFetch(this.spec.api_url,{method:e,headers:r,body:i});if(200!==s.status)throw new Error(`Failed to upload file to ${n}`);const o=await s.json();if("success"!==o.status)throw new Error(o.message);return o}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();const t=await this.ndk.httpFetch(this.url);if(200!==t.status)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);const e=await t.json();if(!e)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=e,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(t,e,n){const r=new Ap(this.ndk,{kind:27235,tags:[["u",t],["method",e]]});if(["POST","PUT","PATCH"].includes(e)){const t=await this.calculateSha256(n);r.tags.push(["payload",t])}return await r.sign(),`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(t){const e=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}},uy=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(t,e){this.maxConcurrency=e}add(t){if(this.promises.has(t.id))return this.promises.get(t.id);const e=new Promise(((e,n)=>{this.queue.push({...t,func:()=>t.func().then((t=>(e(t),t)),(t=>{throw n(t),t}))}),this.process()}));return this.promises.set(t.id,e),e.finally((()=>{this.promises.delete(t.id),this.processing.delete(t.id),this.process()})),e}process(){if(this.processing.size>=this.maxConcurrency||0===this.queue.length)return;const t=this.queue.shift();t&&!this.processing.has(t.id)&&(this.processing.add(t.id),t.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},hy=class{subscriptions;seenEvents=new Map;debug;constructor(t){this.subscriptions=new Map,this.debug=t.extend("sub-manager")}add(t){this.subscriptions.set(t.internalId,t),t.onStopped&&console.log("SUB-MANAGER BUG: Subscription already had onStopped! 🤔",t.internalId),t.onStopped=()=>{this.subscriptions.delete(t.internalId)},t.on("close",(()=>{this.subscriptions.delete(t.internalId)}))}seenEvent(t,e){const n=this.seenEvents.get(t)||[];n.push(e),this.seenEvents.set(t,n)}filterMatchingTime=0;filterMatchingCount=0;dispatchEvent(t,e,n=!1){e&&this.seenEvent(t.id,e);const r=this.subscriptions.values(),i=[],s=Date.now();for(const e of r)Vl(e.filters,t)&&i.push(e);this.filterMatchingTime+=Date.now()-s,this.filterMatchingCount+=i.length;for(const e of i)e.eventReceived(t,void 0,!1,n)}},ly=ao("ndk:active-user");async function dy(t){if(!this.autoConnectUserRelays)return;const e=await async function(t,e){return(await ny([t],e)).get(t)}(t.pubkey,this);if(e){for(const t of e.relays){let e=this.pool.relays.get(t);e||(e=new Ip(t,this.relayAuthDefaultPolicy,this),this.pool.addRelay(e))}return e}}async function fy(t){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?py.call(this,t):e.once("connect",(()=>{py.call(this,t)}))}async function py(t){const e=await dy.call(this,t),n=[{kinds:[10006],authors:[t.pubkey]}];this.autoFetchUserMutelist&&n[0].kinds.push(1e4);const r=e?e.relaySet:void 0,i=this.subscribe(n,{subId:"active-user-settings",closeOnEose:!0},r,!1),s=new Map;i.on("event",(t=>{const e=s.get(t.kind);e&&e.created_at>=t.created_at||s.set(t.kind,t)})),i.on("eose",(()=>{for(const t of s.values())yy.call(this,t)})),i.start()}async function yy(t){10006===t.kind?gy.call(this,t):1e4===t.kind&&my.call(this,t)}function gy(t){const e=Wp.from(t);for(const t of e.items)this.pool.blacklistRelayUrls.add(t[0]);ly("Added %d relays to relay blacklist",e.items.length)}function my(t){const e=Wp.from(t);for(const t of e.items)this.mutedIds.set(t[1],t[0]);ly("Added %d users to mute list",e.items.length)}var wy=["wss://purplepag.es/","wss://nos.lol/"],by=["wss://brb.io/","wss://nostr.mutinywallet.com/"],vy=class extends oo.EventEmitter{_explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;mutedIds;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=1;validationRatioFn;subManager;publishingFailureHandled=!1;relayAuthDefaultPolicy;httpFetch;netDebug;autoConnectUserRelays=!0;autoFetchUserMutelist=!0;walletConfig;constructor(t={}){super(),this.debug=t.debug||ao("ndk"),this.netDebug=t.netDebug,this._explicitRelayUrls=t.explicitRelayUrls||[],this.subManager=new hy(this.debug),this.pool=new Np(t.explicitRelayUrls||[],t.blacklistRelayUrls||by,this),this.pool.name="main",this.pool.on("relay:auth",(async(t,e)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,e)})),this.autoConnectUserRelays=t.autoConnectUserRelays??!0,this.autoFetchUserMutelist=t.autoFetchUserMutelist??!0,this.clientName=t.clientName,this.clientNip89=t.clientNip89,this.relayAuthDefaultPolicy=t.relayAuthDefaultPolicy,t.enableOutboxModel&&(this.outboxPool=new Np(t.outboxRelayUrls||wy,t.blacklistRelayUrls||by,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new iy(this)),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.mutedIds=t.mutedIds||new Map,t.devWriteRelayUrls&&(this.devWriteRelaySet=tp.fromRelayUrls(t.devWriteRelayUrls,this)),this.queuesZapConfig=new uy("zaps",3),this.queuesNip05=new uy("nip05",10),this.signatureVerificationWorker=t.signatureVerificationWorker,this.initialValidationRatio=t.initialValidationRatio||1,this.lowestValidationRatio=t.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(t){this._explicitRelayUrls=t,this.pool.relayUrls=t}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(t){this.asyncSigVerification=!!t,t&&((ap=t).onmessage=t=>{const[e,n]=t.data,r=wp[e];if(r){delete wp[e];for(const t of r.resolves)t(n)}else console.error("No record found for event",e)})}addExplicitRelay(t,e,n=!0){let r;return r="string"==typeof t?new Ip(t,e,this):t,this.pool.addRelay(r,n),this.explicitRelayUrls.push(r.url),r}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(t){const e=this._activeUser?.pubkey!==t?.pubkey;this._activeUser=t,t&&e?fy.call(this,t):t||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(t){this._signer=t,t&&this.emit("signer:ready",t),t?.user().then((t=>{t.ndk=this,this.activeUser=t}))}async connect(t){this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await(this._signer.relays?.(this))),this._signer.relays)&&(await this._signer.relays(this)).forEach((t=>this.pool.addRelay(t)));const e=[this.pool.connect(t)];return this.outboxPool&&e.push(this.outboxPool.connect(t)),this.debug("Connecting to relays %o",{timeoutMs:t}),Promise.allSettled(e).then((()=>{}))}getUser(t){const e=new Kp(t);return e.ndk=this,e}async getUserFromNip05(t,e=!1){return Kp.fromNip05(t,this,e)}subscribe(t,e,n,r=!0){const i=new jp(this,t,e,n);this.subManager.add(i);const s=e?.pool??this.pool;if(n)for(const t of n.relays)s.useTemporaryRelay(t,void 0,i.filters);if(this.outboxPool&&i.hasAuthorsFilter()){const t=i.filters.filter((t=>t.authors&&t.authors?.length>0)).map((t=>t.authors)).flat();this.outboxTracker?.trackUsers(t)}return r&&setTimeout((()=>i.start()),0),i}async publish(t,e,n){return this.debug("Deprecated: Use `event.publish()` instead"),t.publish(e,n)}fetchEventFromTag=ay.bind(this);async fetchEvent(t,e,n){let r,i;if(n instanceof Ip?i=new tp(new Set([n]),this):n instanceof tp&&(i=n),!n&&"string"==typeof t&&null===t.match(Lp)){const e=function(t,e){try{const n=td.decode(t);if(["naddr","nevent"].includes(n?.type)){const t=n.data;if(t?.relays)return t.relays.map((t=>new Ip(t,e.relayAuthDefaultPolicy,e)))}}catch(t){}return[]}(t,this);e.length>0&&(i=new tp(new Set(e),this),i=function(t,e){const n=e.connectedRelays();if(!Array.from(t.relays).some((t=>n.map((t=>t.url)).includes(t.url))))for(const e of n)t.addRelay(e);if(0===n.length)for(const n of e.relays.values())t.addRelay(n);return t}(i,this.pool))}if(r="string"==typeof t?[Pp(t)]:Array.isArray(t)?t:[t],0===r.length)throw new Error(`Invalid filter: ${JSON.stringify(t)}`);return new Promise((t=>{let n=null;const s=this.subscribe(r,{...e||{},closeOnEose:!0},i,!1),o=setTimeout((()=>{s.stop(),t(n)}),1e4);s.on("event",(e=>{e.ndk=this,e.isReplaceable()?(!n||n.created_at<e.created_at)&&(n=e):(clearTimeout(o),t(e))})),s.on("eose",(()=>{clearTimeout(o),t(n)})),s.start()}))}async fetchEvents(t,e,n){return new Promise((r=>{const i=new Map,s=this.subscribe(t,{...e||{},closeOnEose:!0},n,!1);s.on("event",(t=>{t instanceof Ap||(t=new Ap(void 0,t));const e=t.deduplicationKey(),n=i.get(e);var r,s;n&&(s=t,t=(r=n).created_at>s.created_at?r:s),t.ndk=this,i.set(e,t)})),s.on("eose",(()=>{r(new Set(i.values()))})),s.start()}))}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(t){return new cy(t,this)}set wallet(t){console.log("setting wallet",{lnPay:t?.lnPay,cashuPay:t?.cashuPay}),t?(this.walletConfig??={},this.walletConfig.lnPay=t?.lnPay?.bind(t),this.walletConfig.cashuPay=t?.cashuPay?.bind(t)):this.walletConfig=void 0}};ao("ndk:zapper");oo.EventEmitter,__webpack_require__(2388);const{NODE_CONFIG:_y,SUB_CONFIG:Ey}=ur;nostr_p2p = ( relays, seckey ) => new class{constructor(t,e,n={}){this._filter=t=>{const e=io(t);return null!==e?e:this.is_peer(t.pubkey)?this.is_recip(t)?e:"pubkey not in recipient list":"author not in peer list"},this._handler=t=>{const e=function(t,e){const n=JSON.parse(t),r=no.event.envelope.parse(n),[i,s,o]=r;return{ctx:e,dat:o,id:s,tag:i}}(function(t,e){if(io(t),!cr(t,er(e)))throw new Error("pubkey not in peers list");return function(t,e){const[n,r]=e.split("?iv="),i=bt.b64url(n),s=bt.hex(t),o=bt.b64url(r),a=tr(s,o).decrypt(i);return new bt(a).str}(nr(e,t.pubkey),t.content)}(t,this._seckey.hex),t);this.event.emit("message",e),this.inbox.emit(e.id,e),this.rpc.emit(e.tag,e)},this._publish=async t=>new Ap(this.client,t).publish().then((t=>[...t].map((t=>t.url))));const r=new ey(e);this._seckey=new bt(e),this._config={..._y(),...n},this._client=new vy({explicitRelayUrls:t,signer:r}),this._event=new so,this._inbox=new so,this._peers=this.config.peer_pks.filter((t=>t!==this.pubkey)),this._relays=t,this._rpc=new so;const i={kinds:this.config.kinds,"#p":[this.pubkey],since:rr()-this.config.now_offset};0!==this.peers.length&&(i.authors=this.peers),this.event.emit("info",["filter:",JSON.stringify(i,null,2)]),this._sub=this.client.subscribe(i),this._sub.on("event",(t=>{try{const e=function(t){const{content:e,created_at:n,id:r,kind:i,pubkey:s,sig:o,tags:a}=t;return ir.exists(n),ir.exists(i),ir.exists(o),{content:e,created_at:n,id:r,kind:i,pubkey:s,sig:o,tags:a}}(t),n=this._filter(e);null!==n?this.event.emit("filter",[e.id,n]):this._handler(e)}catch(e){console.error(e),this.event.emit("error",[t.id,or(e)])}}))}get client(){return this._client}get config(){return this._config}get event(){return this._event}get inbox(){return this._inbox}get peers(){return this._peers}get pubkey(){return er(this._seckey.hex)}get relays(){return this._relays}get rpc(){return this._rpc}async connect(t){return await this.client.connect(t),await this._sub.start(),await((t=1e3)=>new Promise((e=>setTimeout(e,t))))(this.config.start_delay),this.event.emit("init",this),this}is_peer(t){return 0===this.peers.length||this.peers.includes(t)}is_recip(t){return cr(t,this.pubkey)}async relay(t,e,n,r){r=r??sr();const i=[];for(const s of n)i.push(this.send(t,e,s,r));return Promise.all(i).then((t=>function(t){const e=new Set;for(const n of t)for(const t of n)e.add(t);return[...e]}(t)))}async req(t,e,n,r={}){const{id:i=sr()}=r,s=this.sub({...r,id:i,peers:n});return this.relay(t,e,n,i),s}async send(t,e,n,r=bt.random(16).hex){const i=function(t,e,n=bt.random(16).hex){return JSON.stringify([t,n,e])}(t,e,r),s=function(t,e,n){const r=er(n),i=function(t,e){const n=bt.str(e),r=bt.hex(t),i=bt.random(24),s=tr(r,i).encrypt(n);return new bt(s).b64url+"?iv="+i.b64url}(nr(n,e),t),s={...ro(),pubkey:r,content:i};return s.tags.push(["p",e]),function(t,e){const n=ar(e),r=function(t,e){const n=vn.sign(e,t);return new bt(n).hex}(t,n);return{...e,id:n,sig:r}}(n,s)}(i,n,this._seckey.hex);return this._publish(s)}async sub(t){const e={...Ey(),...t},n=e.peers.length>0;return new Promise((t=>{const{id:r,peers:i,tag:s,strict:o,timeout:a}=e,c=new Set,u=new Set,h=setTimeout((()=>{if(n&&o){const e=i.filter((t=>!c.has(t)));t({ok:!1,blame:e,err:"timeout"})}else t({ok:!0,data:[...u]})}),a),l=e=>{c.add(e.ctx.pubkey),u.add(e),n&&i.every((t=>c.has(t)))&&(clearTimeout(h),t({ok:!0,data:[...u]}))};"string"==typeof r&&this.inbox.within(r,(t=>l(t)),a),"string"==typeof s&&this.rpc.within(s,(t=>l(t)),a)}))} }( relays, seckey )})()})();